{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/auth/2fa/verify/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { prisma } from \"@/lib/db\"\r\nimport { authenticator } from \"otplib\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\n// POST /api/auth/2fa/verify - Verify TOTP during login\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json()\r\n        const { email, code, tempToken } = body as { email?: string; code?: string; tempToken?: string }\r\n\r\n        if (!email || !code) {\r\n            return NextResponse.json({ error: \"Email and code are required\" }, { status: 400 })\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: email.toLowerCase().trim() },\r\n            select: { id: true, totpSecret: true, totpEnabled: true, role: true },\r\n        })\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"User not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (!user.totpEnabled || !user.totpSecret) {\r\n            return NextResponse.json({ error: \"2FA is not enabled for this user\" }, { status: 400 })\r\n        }\r\n\r\n        const isValid = authenticator.verify({ token: code, secret: user.totpSecret })\r\n        if (!isValid) {\r\n            return NextResponse.json({ error: \"Invalid verification code\" }, { status: 401 })\r\n        }\r\n\r\n        // 2FA verified - return success flag\r\n        // The actual session creation is handled by NextAuth, this just validates the code\r\n        return NextResponse.json({\r\n            ok: true,\r\n            verified: true,\r\n            userId: user.id,\r\n            role: user.role,\r\n            message: \"2FA verification successful\"\r\n        })\r\n    } catch (err) {\r\n        return NextResponse.json({ error: \"2FA verification failed\", detail: String(err) }, { status: 500 })\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;QAEnC,IAAI,CAAC,SAAS,CAAC,MAAM;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,OAAO,MAAM,WAAW,GAAG,IAAI;YAAG;YAC3C,QAAQ;gBAAE,IAAI;gBAAM,YAAY;gBAAM,aAAa;gBAAM,MAAM;YAAK;QACxE;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,IAAI,CAAC,KAAK,WAAW,IAAI,CAAC,KAAK,UAAU,EAAE;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,MAAM,UAAU,kJAAa,CAAC,MAAM,CAAC;YAAE,OAAO;YAAM,QAAQ,KAAK,UAAU;QAAC;QAC5E,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,qCAAqC;QACrC,mFAAmF;QACnF,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,IAAI;YACJ,UAAU;YACV,QAAQ,KAAK,EAAE;YACf,MAAM,KAAK,IAAI;YACf,SAAS;QACb;IACJ,EAAE,OAAO,KAAK;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA2B,QAAQ,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACtG;AACJ","debugId":null}}]
}