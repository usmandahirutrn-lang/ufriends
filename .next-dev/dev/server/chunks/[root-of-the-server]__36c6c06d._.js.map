{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/security.ts"],"sourcesContent":["import arcjet, { shield, validateEmail, detectBot, fixedWindow } from \"@arcjet/next\"\n\ntype AJInstance = ReturnType<typeof arcjet> | null\n\n// Create a shared Arcjet instance with common rules.\n// In development, ARCJET_KEY may be missing, so we fail open.\nexport const aj: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n    key: process.env.ARCJET_KEY!,\n    rules: [\n      shield({ mode: \"LIVE\" }),\n      detectBot({ mode: \"LIVE\", allow: [\"CATEGORY:SEARCH_ENGINE\", \"CATEGORY:MONITOR\", \"CATEGORY:PREVIEW\"] }),\n      fixedWindow({ mode: \"LIVE\", window: \"60s\", max: 100 }),\n    ],\n  })\n  : null\n\n// Email-validation instance for routes that need email context\nexport const ajWithEmail: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n    key: process.env.ARCJET_KEY!,\n    rules: [\n      shield({ mode: \"LIVE\" }),\n      detectBot({ mode: \"LIVE\", allow: [\"CATEGORY:SEARCH_ENGINE\", \"CATEGORY:MONITOR\", \"CATEGORY:PREVIEW\"] }),\n      fixedWindow({ mode: \"LIVE\", window: \"60s\", max: 100 }),\n      validateEmail({ mode: \"LIVE\", deny: [\"DISPOSABLE\", \"INVALID\", \"NO_MX_RECORDS\"] }),\n    ],\n  })\n  : null\n\nexport async function protect(req: Request, opts?: { email?: string }) {\n  if (!aj) return { allowed: true }\n  try {\n    const decision = await (opts?.email && ajWithEmail\n      ? (ajWithEmail as any).protect(req as any, { email: opts.email })\n      : (aj as any).protect(req as any))\n    if (decision?.isDenied?.()) return { allowed: false }\n    return { allowed: true }\n  } catch {\n    // Fail open in dev\n    return { allowed: true }\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAMO,MAAM,KAAiB,QAAQ,GAAG,CAAC,UAAU,GAChD,IAAA,sKAAM,EAAC;IACP,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,8IAAS,EAAC;YAAE,MAAM;YAAQ,OAAO;gBAAC;gBAA0B;gBAAoB;aAAmB;QAAC;QACpG,IAAA,gJAAW,EAAC;YAAE,MAAM;YAAQ,QAAQ;YAAO,KAAK;QAAI;KACrD;AACH,KACE;AAGG,MAAM,cAA0B,QAAQ,GAAG,CAAC,UAAU,GACzD,IAAA,sKAAM,EAAC;IACP,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,8IAAS,EAAC;YAAE,MAAM;YAAQ,OAAO;gBAAC;gBAA0B;gBAAoB;aAAmB;QAAC;QACpG,IAAA,gJAAW,EAAC;YAAE,MAAM;YAAQ,QAAQ;YAAO,KAAK;QAAI;QACpD,IAAA,kJAAa,EAAC;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAc;gBAAW;aAAgB;QAAC;KAChF;AACH,KACE;AAEG,eAAe,QAAQ,GAAY,EAAE,IAAyB;IACnE,IAAI,CAAC,IAAI,OAAO;QAAE,SAAS;IAAK;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,CAAC,MAAM,SAAS,cACnC,AAAC,YAAoB,OAAO,CAAC,KAAY;YAAE,OAAO,KAAK,KAAK;QAAC,KAC7D,AAAC,GAAW,OAAO,CAAC,IAAW;QACnC,IAAI,UAAU,cAAc,OAAO;YAAE,SAAS;QAAM;QACpD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAM;QACN,mBAAmB;QACnB,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/validation.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { ZodXssSanitizer, ACTION_LEVELS } from \"zod-xss-sanitizer\"\n\n// Shared XSS sanitizer instance\nexport const sanitizer = ZodXssSanitizer.sanitizer({ actionLevel: ACTION_LEVELS.SANITIZE })\n\nexport function sanitizeEmail(input: string) {\n  return sanitizer.parse(z.string().trim().toLowerCase().email().parse(input))\n}\n\nexport function sanitizeString(input: string) {\n  return sanitizer.parse(z.string().trim().min(1).parse(input))\n}\n\nexport function sanitizePhone(input: string) {\n  const schema = z.string().trim().regex(/^\\+?[0-9]{10,15}$/i, { message: \"Invalid phone\" })\n  return sanitizer.parse(schema.parse(input))\n}\n\nexport function isValidUrl(input: string) {\n  const res = z.string().url().safeParse(input)\n  return res.success\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,YAAY,8KAAe,CAAC,SAAS,CAAC;IAAE,aAAa,4KAAa,CAAC,QAAQ;AAAC;AAElF,SAAS,cAAc,KAAa;IACzC,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,WAAW,GAAG,KAAK,GAAG,KAAK,CAAC;AACvE;AAEO,SAAS,eAAe,KAAa;IAC1C,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG,KAAK,CAAC;AACxD;AAEO,SAAS,cAAc,KAAa;IACzC,MAAM,SAAS,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,KAAK,CAAC,sBAAsB;QAAE,SAAS;IAAgB;IACxF,OAAO,UAAU,KAAK,CAAC,OAAO,KAAK,CAAC;AACtC;AAEO,SAAS,WAAW,KAAa;IACtC,MAAM,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,GAAG,SAAS,CAAC;IACvC,OAAO,IAAI,OAAO;AACpB","debugId":null}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}\n\nexport async function sign2FAProof(payload: { sub: string }, expiresInSeconds = 5 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function verify2FAProof(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as { sub: string };\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,aAAa,OAAwB,EAAE,mBAAmB,IAAI,EAAE;IACpF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\nimport crypto from \"crypto\"\nimport { protect } from \"@/lib/security\"\nimport { z } from \"zod\"\nimport { sanitizer } from \"@/lib/validation\"\nimport { signAccessToken, signRefreshToken } from \"@/lib/jwt\"\n\n// Arcjet protection via shared helper (with email context)\n\nconst loginSchema = z.object({\n  email: z.string().trim().toLowerCase().email(),\n  password: z.string().min(6),\n  twoFactorProof: z.string().optional(),\n})\n\nexport async function POST(req: Request) {\n  try {\n    const raw = await req.json()\n    const parsed = loginSchema.safeParse(raw)\n    if (!parsed.success) {\n      return NextResponse.json({ error: \"Invalid input\", details: parsed.error.flatten() }, { status: 422 })\n    }\n\n    const email = sanitizer.parse(parsed.data.email)\n    const password = parsed.data.password\n\n    // Arcjet protections via shared helper\n    const sec = await protect(req as any, { email })\n    if (!sec.allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n    }\n\n    const user = await prisma.user.findUnique({ where: { email } })\n    if (!user) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    const ok = await bcrypt.compare(password, user.passwordHash)\n    if (!ok) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    if (user.status === \"suspended\") {\n      return NextResponse.json({ error: \"Your account has been suspended. Please contact support.\" }, { status: 403 })\n    }\n\n    // ENFORCE 2FA: If enabled, require proof.\n    if (user.totpEnabled) {\n      if (!parsed.data.twoFactorProof) {\n        return NextResponse.json({\n          ok: true,\n          requires2FA: true,\n          email: user.email,\n          message: \"2FA verification required\"\n        })\n      }\n\n      // Verify the proof\n      try {\n        const { verify2FAProof } = await import(\"@/lib/jwt\")\n        const proofPayload = await verify2FAProof(parsed.data.twoFactorProof)\n        if (proofPayload.sub !== user.id) {\n          return NextResponse.json({ error: \"Invalid 2FA proof\" }, { status: 401 })\n        }\n      } catch (e) {\n        return NextResponse.json({ error: \"Expired or invalid 2FA proof\" }, { status: 401 })\n      }\n    }\n\n    // Create tokens\n    const jti = crypto.randomUUID()\n    const access = await signAccessToken({ sub: user.id, email: user.email, role: user.role })\n    const refresh = await signRefreshToken({ sub: user.id, email: user.email, role: user.role, jti })\n\n    // Persist refresh token metadata for revocation tracking\n    const refreshTTLDays = parseInt(process.env.REFRESH_TOKEN_TTL_DAYS || \"7\", 10)\n    const expiresAt = new Date(Date.now() + refreshTTLDays * 24 * 60 * 60 * 1000)\n    try {\n      await prisma.refreshToken.create({\n        data: {\n          userId: user.id,\n          tokenId: jti,\n          expiresAt,\n          ip: (req as any).ip || undefined,\n          userAgent: (req as any).headers?.get?.(\"user-agent\") || undefined,\n        },\n      })\n    } catch { }\n\n    return NextResponse.json({\n      user: { id: user.id, email: user.email, role: user.role },\n      tokens: { accessToken: access, refreshToken: refresh },\n      expiresIn: { accessSeconds: 15 * 60, refreshDays: refreshTTLDays },\n    })\n  } catch (err) {\n    return NextResponse.json({ error: \"Login failed\", detail: String(err) }, { status: 500 })\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA,2DAA2D;AAE3D,MAAM,cAAc,yKAAC,CAAC,MAAM,CAAC;IAC3B,OAAO,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,WAAW,GAAG,KAAK;IAC5C,UAAU,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,gBAAgB,yKAAC,CAAC,MAAM,GAAG,QAAQ;AACrC;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,MAAM,MAAM,IAAI,IAAI;QAC1B,MAAM,SAAS,YAAY,SAAS,CAAC;QACrC,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAiB,SAAS,OAAO,KAAK,CAAC,OAAO;YAAG,GAAG;gBAAE,QAAQ;YAAI;QACtG;QAEA,MAAM,QAAQ,gIAAS,CAAC,KAAK,CAAC,OAAO,IAAI,CAAC,KAAK;QAC/C,MAAM,WAAW,OAAO,IAAI,CAAC,QAAQ;QAErC,uCAAuC;QACvC,MAAM,MAAM,MAAM,IAAA,4HAAO,EAAC,KAAY;YAAE;QAAM;QAC9C,IAAI,CAAC,IAAI,OAAO,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACjE;QAEA,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC7D,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,KAAK,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,YAAY;QAC3D,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,IAAI,KAAK,MAAM,KAAK,aAAa;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2D,GAAG;gBAAE,QAAQ;YAAI;QAChH;QAEA,0CAA0C;QAC1C,IAAI,KAAK,WAAW,EAAE;YACpB,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc,EAAE;gBAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;oBACvB,IAAI;oBACJ,aAAa;oBACb,OAAO,KAAK,KAAK;oBACjB,SAAS;gBACX;YACF;YAEA,mBAAmB;YACnB,IAAI;gBACF,MAAM,EAAE,cAAc,EAAE,GAAG;gBAC3B,MAAM,eAAe,MAAM,eAAe,OAAO,IAAI,CAAC,cAAc;gBACpE,IAAI,aAAa,GAAG,KAAK,KAAK,EAAE,EAAE;oBAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;oBAAoB,GAAG;wBAAE,QAAQ;oBAAI;gBACzE;YACF,EAAE,OAAO,GAAG;gBACV,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAA+B,GAAG;oBAAE,QAAQ;gBAAI;YACpF;QACF;QAEA,gBAAgB;QAChB,MAAM,MAAM,gHAAM,CAAC,UAAU;QAC7B,MAAM,SAAS,MAAM,IAAA,+HAAe,EAAC;YAAE,KAAK,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC;QACxF,MAAM,UAAU,MAAM,IAAA,gIAAgB,EAAC;YAAE,KAAK,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;YAAE;QAAI;QAE/F,yDAAyD;QACzD,MAAM,iBAAiB,SAAS,QAAQ,GAAG,CAAC,sBAAsB,IAAI,KAAK;QAC3E,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,iBAAiB,KAAK,KAAK,KAAK;QACxE,IAAI;YACF,MAAM,qHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC/B,MAAM;oBACJ,QAAQ,KAAK,EAAE;oBACf,SAAS;oBACT;oBACA,IAAI,AAAC,IAAY,EAAE,IAAI;oBACvB,WAAW,AAAC,IAAY,OAAO,EAAE,MAAM,iBAAiB;gBAC1D;YACF;QACF,EAAE,OAAM,CAAE;QAEV,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;gBAAE,IAAI,KAAK,EAAE;gBAAE,OAAO,KAAK,KAAK;gBAAE,MAAM,KAAK,IAAI;YAAC;YACxD,QAAQ;gBAAE,aAAa;gBAAQ,cAAc;YAAQ;YACrD,WAAW;gBAAE,eAAe,KAAK;gBAAI,aAAa;YAAe;QACnE;IACF,EAAE,OAAO,KAAK;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAgB,QAAQ,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACzF;AACF","debugId":null}}]
}