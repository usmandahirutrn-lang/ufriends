{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/security.ts"],"sourcesContent":["import arcjet, { shield, validateEmail } from \"@arcjet/next\"\n\ntype AJInstance = ReturnType<typeof arcjet> | null\n\n// Create a shared Arcjet instance with common rules.\n// In development, ARCJET_KEY may be missing, so we fail open.\nexport const aj: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n      ],\n    })\n  : null\n\n// Email-validation instance for routes that need email context\nexport const ajWithEmail: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n        validateEmail({ mode: \"LIVE\", deny: [\"DISPOSABLE\", \"INVALID\", \"NO_MX_RECORDS\"] }),\n      ],\n    })\n  : null\n\nexport async function protect(req: Request, opts?: { email?: string }) {\n  if (!aj) return { allowed: true }\n  try {\n    const decision = await (opts?.email && ajWithEmail\n      ? (ajWithEmail as any).protect(req as any, { email: opts.email })\n      : (aj as any).protect(req as any))\n    if (decision?.isDenied?.()) return { allowed: false }\n    return { allowed: true }\n  } catch {\n    // Fail open in dev\n    return { allowed: true }\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAMO,MAAM,KAAiB,QAAQ,GAAG,CAAC,UAAU,GAChD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;KACvB;AACH,KACA;AAGG,MAAM,cAA0B,QAAQ,GAAG,CAAC,UAAU,GACzD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,kJAAa,EAAC;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAc;gBAAW;aAAgB;QAAC;KAChF;AACH,KACA;AAEG,eAAe,QAAQ,GAAY,EAAE,IAAyB;IACnE,IAAI,CAAC,IAAI,OAAO;QAAE,SAAS;IAAK;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,CAAC,MAAM,SAAS,cACnC,AAAC,YAAoB,OAAO,CAAC,KAAY;YAAE,OAAO,KAAK,KAAK;QAAC,KAC7D,AAAC,GAAW,OAAO,CAAC,IAAW;QACnC,IAAI,UAAU,cAAc,OAAO;YAAE,SAAS;QAAM;QACpD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAM;QACN,mBAAmB;QACnB,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/auth/refresh/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport crypto from \"crypto\"\nimport { prisma } from \"@/lib/db\"\nimport { protect } from \"@/lib/security\"\nimport { z } from \"zod\"\nimport { verifyRefreshToken, signAccessToken, signRefreshToken } from \"@/lib/jwt\"\n\n// Arcjet protection via shared helper\n\nconst schema = z.object({ refreshToken: z.string().min(10) })\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    const parsed = schema.safeParse(body)\n    if (!parsed.success) {\n      return NextResponse.json({ error: \"Invalid input\", details: parsed.error.flatten() }, { status: 422 })\n    }\n\n    const sec = await protect(req as any)\n    if (!sec.allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n    }\n\n    // Verify refresh token\n    let payload: any\n    try {\n      payload = await verifyRefreshToken(parsed.data.refreshToken)\n    } catch (e) {\n      return NextResponse.json({ error: \"Invalid or expired token\" }, { status: 401 })\n    }\n\n    const jti = payload.jti as string | undefined\n    const userId = payload.sub as string | undefined\n    if (!jti || !userId) {\n      return NextResponse.json({ error: \"Malformed token\" }, { status: 400 })\n    }\n\n    // Check token record\n    const record = await prisma.refreshToken.findUnique({ where: { tokenId: jti } })\n    if (!record || record.userId !== userId) {\n      return NextResponse.json({ error: \"Token not recognized\" }, { status: 401 })\n    }\n    if (record.revokedAt) {\n      return NextResponse.json({ error: \"Token revoked\" }, { status: 401 })\n    }\n    if (record.expiresAt < new Date()) {\n      return NextResponse.json({ error: \"Token expired\" }, { status: 401 })\n    }\n\n    // Rotate: revoke old and issue new refresh + access\n    const newJti = crypto.randomUUID()\n    const accessToken = await signAccessToken({ sub: userId, email: payload.email, role: payload.role })\n    const refreshToken = await signRefreshToken({ sub: userId, email: payload.email, role: payload.role, jti: newJti })\n\n    const refreshTTLDays = parseInt(process.env.REFRESH_TOKEN_TTL_DAYS || \"7\", 10)\n    const newExpiresAt = new Date(Date.now() + refreshTTLDays * 24 * 60 * 60 * 1000)\n\n    // Persist rotation in a transaction\n    try {\n      await prisma.$transaction([\n        prisma.refreshToken.update({ where: { tokenId: jti }, data: { revokedAt: new Date() } }),\n        prisma.refreshToken.create({\n          data: {\n            userId,\n            tokenId: newJti,\n            expiresAt: newExpiresAt,\n            ip: (req as any).ip || undefined,\n            userAgent: (req as any).headers?.get?.(\"user-agent\") || undefined,\n          },\n        }),\n      ])\n    } catch {}\n\n    return NextResponse.json({\n      tokens: { accessToken, refreshToken },\n      expiresIn: { accessSeconds: 15 * 60, refreshDays: refreshTTLDays },\n    })\n  } catch (err) {\n    return NextResponse.json({ error: \"Refresh failed\", detail: String(err) }, { status: 500 })\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}