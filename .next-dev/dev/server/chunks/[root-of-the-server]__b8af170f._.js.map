{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}\n\nexport async function sign2FAProof(payload: { sub: string }, expiresInSeconds = 5 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function verify2FAProof(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as { sub: string };\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,gKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,gKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,aAAa,OAAwB,EAAE,mBAAmB,IAAI,EAAE;IACpF,OAAO,IAAI,gKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/proxy.ts"],"sourcesContent":["import { NextResponse, NextRequest } from \"next/server\"\nimport { getToken } from \"next-auth/jwt\"\nimport { verifyAccessToken } from \"@/lib/jwt\"\nimport arcjet, { shield, detectBot } from \"@arcjet/next\"\n\nconst aj = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n        detectBot({ mode: \"LIVE\", allow: [] }),\n      ],\n    })\n  : null\n\nexport async function proxy(req: NextRequest) {\n  const { pathname, search } = req.nextUrl\n\n  // First apply Arcjet protections\n  if (aj) {\n    try {\n      const decision: any = await aj.protect(req)\n      if (decision?.isDenied?.()) {\n        return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n      }\n    } catch {}\n  }\n\n  // NextAuth token (for page guards and accepted for APIs)\n  const secret = process.env.NEXTAUTH_SECRET\n  const sessionToken = await getToken({ req, secret }).catch(() => null)\n\n  // Page guards: admin and dashboard require NextAuth session\n  if (pathname.startsWith(\"/admin\") || pathname.startsWith(\"/dashboard\")) {\n    if (sessionToken) return NextResponse.next()\n    const loginUrl = new URL(\"/login\", req.url)\n    // Preserve destination\n    loginUrl.searchParams.set(\"next\", `${pathname}${search}`)\n    return NextResponse.redirect(loginUrl)\n  }\n\n  // API guards: require NextAuth session OR Bearer access token\n  if (pathname.startsWith(\"/api/admin\") || pathname.startsWith(\"/api/wallet\")) {\n    if (sessionToken) return NextResponse.next()\n    const authHeader = req.headers.get(\"authorization\") || \"\"\n    const [, bearer] = authHeader.split(\" \")\n    if (authHeader.toLowerCase().startsWith(\"bearer \") && bearer) {\n      try {\n        await verifyAccessToken(bearer)\n        return NextResponse.next()\n      } catch {}\n    }\n    return NextResponse.json({ error: \"Authentication required\", code: \"UNAUTHORIZED\" }, { status: 401 })\n  }\n\n  // Otherwise pass through\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\n    \"/api/:path*\",\n    \"/login\",\n    \"/signup\",\n    \"/dashboard/:path*\",\n    \"/admin/:path*\",\n  ],\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAEA,MAAM,KAAK,QAAQ,GAAG,CAAC,UAAU,GAC7B,IAAA,oKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,yIAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,4IAAS,EAAC;YAAE,MAAM;YAAQ,OAAO,EAAE;QAAC;KACrC;AACH,KACA;AAEG,eAAe,MAAM,GAAgB;IAC1C,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,OAAO;IAExC,iCAAiC;IACjC,IAAI,IAAI;QACN,IAAI;YACF,MAAM,WAAgB,MAAM,GAAG,OAAO,CAAC;YACvC,IAAI,UAAU,cAAc;gBAC1B,OAAO,8IAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAY,GAAG;oBAAE,QAAQ;gBAAI;YACjE;QACF,EAAE,OAAM,CAAC;IACX;IAEA,yDAAyD;IACzD,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,MAAM,eAAe,MAAM,IAAA,wJAAQ,EAAC;QAAE;QAAK;IAAO,GAAG,KAAK,CAAC,IAAM;IAEjE,4DAA4D;IAC5D,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,UAAU,CAAC,eAAe;QACtE,IAAI,cAAc,OAAO,8IAAY,CAAC,IAAI;QAC1C,MAAM,WAAW,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1C,uBAAuB;QACvB,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ,GAAG,WAAW,QAAQ;QACxD,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,8DAA8D;IAC9D,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,UAAU,CAAC,gBAAgB;QAC3E,IAAI,cAAc,OAAO,8IAAY,CAAC,IAAI;QAC1C,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;QACvD,MAAM,GAAG,OAAO,GAAG,WAAW,KAAK,CAAC;QACpC,IAAI,WAAW,WAAW,GAAG,UAAU,CAAC,cAAc,QAAQ;YAC5D,IAAI;gBACF,MAAM,IAAA,+HAAiB,EAAC;gBACxB,OAAO,8IAAY,CAAC,IAAI;YAC1B,EAAE,OAAM,CAAC;QACX;QACA,OAAO,8IAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA2B,MAAM;QAAe,GAAG;YAAE,QAAQ;QAAI;IACrG;IAEA,yBAAyB;IACzB,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;KACD;AACH","debugId":null}}]
}