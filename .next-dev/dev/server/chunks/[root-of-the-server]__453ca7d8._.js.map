{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/mailer.ts"],"sourcesContent":["import nodemailer from \"nodemailer\"\n\nconst host = process.env.EMAIL_SERVER_HOST\nconst port = Number(process.env.EMAIL_SERVER_PORT || 465)\nconst user = process.env.EMAIL_SERVER_USER\nconst pass = process.env.EMAIL_SERVER_PASSWORD\nconst from = process.env.EMAIL_FROM || \"UFriends IT <no-reply@ufriends.com>\"\n\nexport const mailer = nodemailer.createTransport({\n  host,\n  port,\n  secure: port === 465,\n  auth: user && pass ? { user, pass } : undefined,\n})\n\nexport interface EmailParams {\n  to: string\n  subject: string\n  text?: string\n  html: string\n}\n\nexport async function sendEmail({ to, subject, text, html }: EmailParams) {\n  try {\n    await mailer.sendMail({ from, to, subject, text, html })\n    return { success: true }\n  } catch (error) {\n    console.error(\"Email sending failed:\", error)\n    return { success: false, error }\n  }\n}\n\nexport async function sendOtpEmail(to: string, code: string) {\n  const subject = \"Your UFriends verification code\"\n  const text = `Your verification code is ${code}. It expires in 5 minutes.`\n  const html = `<p>Your verification code is <strong>${code}</strong>.</p><p>It expires in 5 minutes.</p>`\n  return sendEmail({ to, subject, text, html })\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,OAAO,QAAQ,GAAG,CAAC,iBAAiB;AAC1C,MAAM,OAAO,OAAO,QAAQ,GAAG,CAAC,iBAAiB,IAAI;AACrD,MAAM,OAAO,QAAQ,GAAG,CAAC,iBAAiB;AAC1C,MAAM,OAAO,QAAQ,GAAG,CAAC,qBAAqB;AAC9C,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEhC,MAAM,SAAS,4JAAU,CAAC,eAAe,CAAC;IAC/C;IACA;IACA,QAAQ,SAAS;IACjB,MAAM,QAAQ,OAAO;QAAE;QAAM;IAAK,IAAI;AACxC;AASO,eAAe,UAAU,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAe;IACtE,IAAI;QACF,MAAM,OAAO,QAAQ,CAAC;YAAE;YAAM;YAAI;YAAS;YAAM;QAAK;QACtD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF;AAEO,eAAe,aAAa,EAAU,EAAE,IAAY;IACzD,MAAM,UAAU;IAChB,MAAM,OAAO,CAAC,0BAA0B,EAAE,KAAK,0BAA0B,CAAC;IAC1E,MAAM,OAAO,CAAC,qCAAqC,EAAE,KAAK,6CAA6C,CAAC;IACxG,OAAO,UAAU;QAAE;QAAI;QAAS;QAAM;IAAK;AAC7C","debugId":null}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/notifications.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\"\r\nimport { sendEmail } from \"@/lib/mailer\"\r\n\r\ninterface NotificationParams {\r\n    userId: string\r\n    type: string\r\n    title: string\r\n    body: string\r\n    email?: {\r\n        subject: string\r\n        html: string\r\n        text?: string\r\n    }\r\n}\r\n\r\nexport async function sendNotification({ userId, type, title, body, email }: NotificationParams) {\r\n    try {\r\n        // 1. Create In-App Notification\r\n        const notification = await prisma.notification.create({\r\n            data: {\r\n                userId,\r\n                type,\r\n                title,\r\n                body,\r\n            },\r\n        })\r\n\r\n        // 2. Send Email Notification if requested\r\n        if (email) {\r\n            const user = await prisma.user.findUnique({\r\n                where: { id: userId },\r\n                select: { email: true },\r\n            })\r\n\r\n            if (user?.email) {\r\n                // We don't await email to prevent blocking the main flow, \r\n                // but it's already handled in sendEmail with catch\r\n                sendEmail({\r\n                    to: user.email,\r\n                    subject: email.subject,\r\n                    html: email.html,\r\n                    text: email.text || body,\r\n                })\r\n            }\r\n        }\r\n\r\n        return notification\r\n    } catch (error) {\r\n        console.error(\"Failed to send notification:\", error)\r\n        return null\r\n    }\r\n}\r\n\r\nexport async function sendAdminNotification({ type, title, body, email }: Omit<NotificationParams, \"userId\">) {\r\n    try {\r\n        // Find all admins\r\n        const admins = await prisma.user.findMany({\r\n            where: { role: \"ADMIN\" },\r\n            select: { id: true, email: true },\r\n        })\r\n\r\n        const results = await Promise.all(\r\n            admins.map(async (admin: { id: string; email: string }) => {\r\n                // Create In-App Notification for each admin\r\n                const notif = await prisma.notification.create({\r\n                    data: {\r\n                        userId: admin.id,\r\n                        type,\r\n                        title,\r\n                        body,\r\n                    },\r\n                })\r\n\r\n                // Send Email to each admin\r\n                if (email) {\r\n                    sendEmail({\r\n                        to: admin.email,\r\n                        subject: email.subject,\r\n                        html: email.html,\r\n                        text: email.text || body,\r\n                    })\r\n                }\r\n\r\n                return notif\r\n            })\r\n        )\r\n\r\n        return results\r\n    } catch (error) {\r\n        console.error(\"Failed to send admin notification:\", error)\r\n        return null\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAcO,eAAe,iBAAiB,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAsB;IAC3F,IAAI;QACA,gCAAgC;QAChC,MAAM,eAAe,MAAM,qHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YAClD,MAAM;gBACF;gBACA;gBACA;gBACA;YACJ;QACJ;QAEA,0CAA0C;QAC1C,IAAI,OAAO;YACP,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBACtC,OAAO;oBAAE,IAAI;gBAAO;gBACpB,QAAQ;oBAAE,OAAO;gBAAK;YAC1B;YAEA,IAAI,MAAM,OAAO;gBACb,2DAA2D;gBAC3D,mDAAmD;gBACnD,IAAA,4HAAS,EAAC;oBACN,IAAI,KAAK,KAAK;oBACd,SAAS,MAAM,OAAO;oBACtB,MAAM,MAAM,IAAI;oBAChB,MAAM,MAAM,IAAI,IAAI;gBACxB;YACJ;QACJ;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACX;AACJ;AAEO,eAAe,sBAAsB,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAsC;IACxG,IAAI;QACA,kBAAkB;QAClB,MAAM,SAAS,MAAM,qHAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACtC,OAAO;gBAAE,MAAM;YAAQ;YACvB,QAAQ;gBAAE,IAAI;gBAAM,OAAO;YAAK;QACpC;QAEA,MAAM,UAAU,MAAM,QAAQ,GAAG,CAC7B,OAAO,GAAG,CAAC,OAAO;YACd,4CAA4C;YAC5C,MAAM,QAAQ,MAAM,qHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC3C,MAAM;oBACF,QAAQ,MAAM,EAAE;oBAChB;oBACA;oBACA;gBACJ;YACJ;YAEA,2BAA2B;YAC3B,IAAI,OAAO;gBACP,IAAA,4HAAS,EAAC;oBACN,IAAI,MAAM,KAAK;oBACf,SAAS,MAAM,OAAO;oBACtB,MAAM,MAAM,IAAI;oBAChB,MAAM,MAAM,IAAI,IAAI;gBACxB;YACJ;YAEA,OAAO;QACX;QAGJ,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO;IACX;AACJ","debugId":null}}]
}