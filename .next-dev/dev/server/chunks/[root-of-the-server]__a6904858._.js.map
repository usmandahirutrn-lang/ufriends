{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/security.ts"],"sourcesContent":["import arcjet, { shield, validateEmail } from \"@arcjet/next\"\n\ntype AJInstance = ReturnType<typeof arcjet> | null\n\n// Create a shared Arcjet instance with common rules.\n// In development, ARCJET_KEY may be missing, so we fail open.\nexport const aj: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n      ],\n    })\n  : null\n\n// Email-validation instance for routes that need email context\nexport const ajWithEmail: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n        validateEmail({ mode: \"LIVE\", deny: [\"DISPOSABLE\", \"INVALID\", \"NO_MX_RECORDS\"] }),\n      ],\n    })\n  : null\n\nexport async function protect(req: Request, opts?: { email?: string }) {\n  if (!aj) return { allowed: true }\n  try {\n    const decision = await (opts?.email && ajWithEmail\n      ? (ajWithEmail as any).protect(req as any, { email: opts.email })\n      : (aj as any).protect(req as any))\n    if (decision?.isDenied?.()) return { allowed: false }\n    return { allowed: true }\n  } catch {\n    // Fail open in dev\n    return { allowed: true }\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAMO,MAAM,KAAiB,QAAQ,GAAG,CAAC,UAAU,GAChD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;KACvB;AACH,KACA;AAGG,MAAM,cAA0B,QAAQ,GAAG,CAAC,UAAU,GACzD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,kJAAa,EAAC;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAc;gBAAW;aAAgB;QAAC;KAChF;AACH,KACA;AAEG,eAAe,QAAQ,GAAY,EAAE,IAAyB;IACnE,IAAI,CAAC,IAAI,OAAO;QAAE,SAAS;IAAK;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,CAAC,MAAM,SAAS,cACnC,AAAC,YAAoB,OAAO,CAAC,KAAY;YAAE,OAAO,KAAK,KAAK;QAAC,KAC7D,AAAC,GAAW,OAAO,CAAC,IAAW;QACnC,IAAI,UAAU,cAAc,OAAO;YAAE,SAAS;QAAM;QACpD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAM;QACN,mBAAmB;QACnB,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 339, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/validation.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { ZodXssSanitizer, ACTION_LEVELS } from \"zod-xss-sanitizer\"\n\n// Shared XSS sanitizer instance\nexport const sanitizer = ZodXssSanitizer.sanitizer({ actionLevel: ACTION_LEVELS.SANITIZE })\n\nexport function sanitizeEmail(input: string) {\n  return sanitizer.parse(z.string().trim().toLowerCase().email().parse(input))\n}\n\nexport function sanitizeString(input: string) {\n  return sanitizer.parse(z.string().trim().min(1).parse(input))\n}\n\nexport function sanitizePhone(input: string) {\n  const schema = z.string().trim().regex(/^\\+?[0-9]{10,15}$/i, { message: \"Invalid phone\" })\n  return sanitizer.parse(schema.parse(input))\n}\n\nexport function isValidUrl(input: string) {\n  const res = z.string().url().safeParse(input)\n  return res.success\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,YAAY,8KAAe,CAAC,SAAS,CAAC;IAAE,aAAa,4KAAa,CAAC,QAAQ;AAAC;AAElF,SAAS,cAAc,KAAa;IACzC,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,WAAW,GAAG,KAAK,GAAG,KAAK,CAAC;AACvE;AAEO,SAAS,eAAe,KAAa;IAC1C,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG,KAAK,CAAC;AACxD;AAEO,SAAS,cAAc,KAAa;IACzC,MAAM,SAAS,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,KAAK,CAAC,sBAAsB;QAAE,SAAS;IAAgB;IACxF,OAAO,UAAU,KAAK,CAAC,OAAO,KAAK,CAAC;AACtC;AAEO,SAAS,WAAW,KAAa;IACtC,MAAM,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,GAAG,SAAS,CAAC;IACvC,OAAO,IAAI,OAAO;AACpB","debugId":null}},
    {"offset": {"line": 378, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\nimport type { NextAuthOptions } from \"next-auth\"\nimport Credentials from \"next-auth/providers/credentials\"\nimport { prisma } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\nimport { protect } from \"@/lib/security\"\nimport Joi from \"joi\"\nimport { sanitizer } from \"@/lib/validation\"\n\nconst isProd = process.env.NODE_ENV === \"production\"\n\nexport const authOptions: NextAuthOptions = {\n  session: { strategy: \"jwt\" },\n  providers: [\n    Credentials({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, req) {\n        // Basic input validation with Joi\n        const schema = Joi.object({\n          // Allow non-public TLDs (e.g., .local) in development; enforce strict in production\n          email: isProd\n            ? Joi.string().email().required()\n            : Joi.string().email({ tlds: { allow: false } }).required(),\n          password: Joi.string().min(6).required(),\n        })\n        const { error, value } = schema.validate({\n          email: credentials?.email,\n          password: credentials?.password,\n        })\n        if (error) return null\n\n        // Sanitize email using shared sanitizer\n        const safeEmail = sanitizer.parse(value.email.trim().toLowerCase())\n\n        // Centralized protection: Shield/email validation handled by shared helper\n        try {\n          const sec = await protect(req as any, { email: safeEmail })\n          if (!sec.allowed) return null\n        } catch {\n          // Fail open to avoid login lockouts if Arcjet fails\n        }\n\n        // Credentials auth\n        const user = await prisma.user.findUnique({ where: { email: safeEmail } })\n        if (!user) return null\n        const ok = await bcrypt.compare(value.password, user.passwordHash)\n        if (!ok) return null\n        return { id: user.id, email: user.email, role: user.role }\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        ;(token as any).id = (user as any).id\n        ;(token as any).role = (user as any).role\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        ;(session.user as any).id = (token as any).id\n        ;(session.user as any).role = (token as any).role\n      }\n      return session\n    },\n  },\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,MAAM,SAAS,oDAAyB;AAEjC,MAAM,cAA+B;IAC1C,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,IAAA,qKAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,GAAG;gBAC9B,kCAAkC;gBAClC,MAAM,SAAS,gJAAG,CAAC,MAAM,CAAC;oBACxB,oFAAoF;oBACpF,OAAO,sCACH,0BACA,gJAAG,CAAC,MAAM,GAAG,KAAK,CAAC;wBAAE,MAAM;4BAAE,OAAO;wBAAM;oBAAE,GAAG,QAAQ;oBAC3D,UAAU,gJAAG,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;gBACxC;gBACA,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,OAAO,QAAQ,CAAC;oBACvC,OAAO,aAAa;oBACpB,UAAU,aAAa;gBACzB;gBACA,IAAI,OAAO,OAAO;gBAElB,wCAAwC;gBACxC,MAAM,YAAY,gIAAS,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,GAAG,WAAW;gBAEhE,2EAA2E;gBAC3E,IAAI;oBACF,MAAM,MAAM,MAAM,IAAA,4HAAO,EAAC,KAAY;wBAAE,OAAO;oBAAU;oBACzD,IAAI,CAAC,IAAI,OAAO,EAAE,OAAO;gBAC3B,EAAE,OAAM;gBACN,oDAAoD;gBACtD;gBAEA,mBAAmB;gBACnB,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,OAAO;oBAAU;gBAAE;gBACxE,IAAI,CAAC,MAAM,OAAO;gBAClB,MAAM,KAAK,MAAM,8IAAM,CAAC,OAAO,CAAC,MAAM,QAAQ,EAAE,KAAK,YAAY;gBACjE,IAAI,CAAC,IAAI,OAAO;gBAChB,OAAO;oBAAE,IAAI,KAAK,EAAE;oBAAE,OAAO,KAAK,KAAK;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAC3D;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;;gBACN,MAAc,EAAE,GAAG,AAAC,KAAa,EAAE;gBACnC,MAAc,IAAI,GAAG,AAAC,KAAa,IAAI;YAC3C;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;;gBACd,QAAQ,IAAI,CAAS,EAAE,GAAG,AAAC,MAAc,EAAE;gBAC3C,QAAQ,IAAI,CAAS,IAAI,GAAG,AAAC,MAAc,IAAI;YACnD;YACA,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 479, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt-auth.ts"],"sourcesContent":["import { verifyAccessToken } from \"./jwt\"\nimport { getServerSession } from \"next-auth\"\nimport { authOptions } from \"@/lib/auth\"\n\nexport type AuthUser = { id: string; email?: string | null; role?: string | null }\n\nexport async function getAuthUser(req: Request): Promise<AuthUser | null> {\n  // Prefer Authorization: Bearer access token\n  const authHeader = (req as any).headers?.get?.(\"authorization\") || \"\"\n  const [, token] = authHeader.split(\" \")\n  if (authHeader.toLowerCase().startsWith(\"bearer \") && token) {\n    try {\n      const payload: any = await verifyAccessToken(token)\n      return { id: payload.sub, email: payload.email, role: payload.role }\n    } catch {}\n  }\n\n  // Fallback to NextAuth session\n  try {\n    const session = await getServerSession(authOptions)\n    if (session?.user?.id) {\n      return { id: (session.user as any).id, email: session.user.email, role: (session.user as any).role }\n    }\n  } catch {}\n\n  return null\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,eAAe,YAAY,GAAY;IAC5C,4CAA4C;IAC5C,MAAM,aAAa,AAAC,IAAY,OAAO,EAAE,MAAM,oBAAoB;IACnE,MAAM,GAAG,MAAM,GAAG,WAAW,KAAK,CAAC;IACnC,IAAI,WAAW,WAAW,GAAG,UAAU,CAAC,cAAc,OAAO;QAC3D,IAAI;YACF,MAAM,UAAe,MAAM,IAAA,iIAAiB,EAAC;YAC7C,OAAO;gBAAE,IAAI,QAAQ,GAAG;gBAAE,OAAO,QAAQ,KAAK;gBAAE,MAAM,QAAQ,IAAI;YAAC;QACrE,EAAE,OAAM,CAAC;IACX;IAEA,+BAA+B;IAC/B,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,4HAAW;QAClD,IAAI,SAAS,MAAM,IAAI;YACrB,OAAO;gBAAE,IAAI,AAAC,QAAQ,IAAI,CAAS,EAAE;gBAAE,OAAO,QAAQ,IAAI,CAAC,KAAK;gBAAE,MAAM,AAAC,QAAQ,IAAI,CAAS,IAAI;YAAC;QACrG;IACF,EAAE,OAAM,CAAC;IAET,OAAO;AACT","debugId":null}},
    {"offset": {"line": 520, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/require-auth.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { getAuthUser, AuthUser } from \"@/lib/jwt-auth\"\n\nexport type RequireAuthOptions = {\n  roles?: Array<string>\n}\n\nexport type RequireAuthResult = {\n  ok: true\n  user: AuthUser\n} | {\n  ok: false\n  response: NextResponse\n}\n\nexport async function requireAuth(req: Request, options: RequireAuthOptions = {}): Promise<RequireAuthResult> {\n  const user = await getAuthUser(req)\n  if (!user?.id) {\n    return { ok: false, response: NextResponse.json({ error: \"Unauthorized\" }, { status: 401 }) }\n  }\n  if (options.roles && user.role && !options.roles.includes(user.role)) {\n    return { ok: false, response: NextResponse.json({ error: \"Forbidden\" }, { status: 403 }) }\n  }\n  return { ok: true, user }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,eAAe,YAAY,GAAY,EAAE,UAA8B,CAAC,CAAC;IAC9E,MAAM,OAAO,MAAM,IAAA,mIAAW,EAAC;IAC/B,IAAI,CAAC,MAAM,IAAI;QACb,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC9F;IACA,IAAI,QAAQ,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,CAAC,QAAQ,CAAC,KAAK,IAAI,GAAG;QACpE,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC3F;IACA,OAAO;QAAE,IAAI;QAAM;IAAK;AAC1B","debugId":null}},
    {"offset": {"line": 559, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/templates/resolve/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { requireAuth } from \"@/lib/require-auth\"\nimport { prisma } from \"@/lib/db\"\n\nfunction titleCase(s: string) {\n  return s.replace(/(^|\\s)([a-z])/g, (m) => m.toUpperCase())\n}\n\nfunction nameFor(action: string, slipType?: string) {\n  const t = (slipType || \"\").toLowerCase()\n  switch (action) {\n    case \"nin.slip\":\n      return `NIN Slip - ${titleCase(t || \"Basic\")}`\n    case \"nin.printout\":\n      return t ? `NIN Printout - ${titleCase(t)}` : `NIN Printout - Basic Data Slip`\n    case \"bvn.advanced\":\n      return `BVN Advanced Slip`\n    case \"bvn.printout\":\n      return t === \"plastic\" ? `BVN Plastic Slip` : `BVN Printout`\n    case \"bvn.retrieval_phone\":\n      return t === \"plastic\" ? `BVN Plastic Slip` : `BVN Printout`\n    case \"cac.info\":\n      return `CAC Info Slip`\n    case \"cac.status\":\n      return `CAC Status Certificate`\n    case \"tin.verify\":\n      return t === \"certificate\" ? `TIN Certificate` : `TIN Slip - ${titleCase(t || \"Basic\")}`\n    case \"passport.verify\":\n      return `Passport Slip`\n    case \"drivers_license.verify\":\n      return `Drivers License Slip`\n    case \"phone.verify_advanced\":\n      return `Phone Slip`\n    case \"plate.verify\":\n      return `Plate Slip`\n    case \"voters.verify\":\n      return `Voters Card Slip - ${titleCase(t || \"Basic\")}`\n    default:\n      return `${action} Slip`\n  }\n}\n\nfunction htmlFor(action: string, name: string, slipType?: string) {\n  if (action === \"voters.verify\") {\n    const t = String(slipType || \"basic\").toLowerCase()\n    if (t === \"full\") {\n      const frontBg = \"/assets/voters-card-front.jpg\"\n      const backBg = \"/assets/voters-card-back.jpg\"\n      const base = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      html, body { margin:0; padding:0; }\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 1024px; margin: 0 auto; }\n      .card { position: relative; width: 1024px; height: 640px; margin: 12px 0; }\n      .bg { position:absolute; inset:0; width:100%; height:100%; object-fit: cover; }\n      .txt { position:absolute; color:#000; font-weight:700; }\n      .small { font-weight:600; font-size: 20px; }\n      .med { font-weight:700; font-size: 26px; }\n      .big { font-weight:800; font-size: 32px; }\n      .vin { left: 360px; top: 96px; }\n      .name { left: 360px; top: 200px; }\n      .dob { left: 360px; top: 260px; }\n      .gender { left: 760px; top: 260px; }\n      .addr { left: 360px; top: 360px; width: 580px; }\n      .delim { left: 360px; top: 150px; }\n      .code { left: 64px; top: 96px; }\n      .photo { position:absolute; left: 64px; top: 160px; width: 260px; height: 320px; object-fit: cover; border: 2px solid #333; background: #fff; }\n      .footer { text-align:center; font-size:12px; color:#333; margin: 4px 0 8px; }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='footer'>Generated: {{generated_at}}</div>\n      <div class='card'>\n        <img class='bg' src='${frontBg}' alt='Front'>\n        <div class='txt small code'>CODE: {{code}}</div>\n        <div class='txt small delim'>DELIM: {{lga}} | {{state}}</div>\n        <div class='txt med vin'>VIN: {{number}}{{vin}}</div>\n        <div class='txt big name'>{{full_name}}{{first_name}} {{last_name}}</div>\n        <div class='txt small dob'>DATE OF BIRTH {{dob}}</div>\n        <div class='txt small gender'>GENDER {{gender}}</div>\n        <div class='txt small addr'>ADDRESS {{address}}</div>\n        <img class='photo' src='{{photo}}' alt='Photo' onerror='this.style.display=\"none\"'>\n      </div>\n      <div class='card'>\n        <img class='bg' src='${backBg}' alt='Back'>\n      </div>\n    </div>\n  </body>\n</html>`\n      return base\n    }\n  }\n\n  if (action === \"bvn.printout\" || action === \"bvn.retrieval_phone\") {\n    const t = String(slipType || \"basic\").toLowerCase()\n    if (t === \"plastic\") {\n      const bg = `/assets/bvn-plastic.jpeg?v=${new Date().getTime()}`\n      const plastic = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      html, body { margin:0; padding:0; }\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 794px; margin: 0 auto; }\n      .header-text { text-align:center; font-size: 18px; color:#333; margin: 12px 0 12px; }\n      \n      /* Card Layout */\n      .stack { position: relative; width: 85.6mm; height: calc(53.98mm * 2); margin: 0 auto; border: 2px solid #000; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); background: #fff; }\n      .inner { position:absolute; left:0; top:0; width: 1011px; height: 639px; transform: scale(0.32); transform-origin: top left; }\n      .card { position:absolute; left:0; width:1011px; height:639px; }\n      .top { top:0; }\n      .bottom { top:650px; background:#fff; }\n      .bg-layer { position:absolute; left:0; top:0; width:100%; height:100%; background-image: url('${bg}'); background-size: 100% auto; background-repeat: no-repeat; }\n      .front-bg { background-position: top center; }\n      .back-bg { background-position: bottom center; }\n      \n      /* Text Styles */\n      .txt { position:absolute; font-weight: 800; color: #000; text-transform: uppercase; z-index: 10; }\n      .lbl { position:absolute; font-weight: 700; color: #000; font-size: 18px; text-transform: uppercase; z-index: 10; }\n      \n      /* Header Brand */\n      .brand-box { position:absolute; left: 40px; top: 40px; }\n      .brand-title { color: #2a3375; font-weight: 800; font-size: 24px; line-height: 1.1; font-family: sans-serif; }\n\n      /* Photo */\n      .photo { \n        position:absolute; \n        left: 40px; \n        top: 150px; \n        width: 220px; \n        height: 280px; \n        object-fit: cover; \n        border-radius: 4px;\n        background: #eee;\n      }\n      \n      /* Fields */\n      .l-surname { left: 290px; top: 155px; }\n      .v-surname { left: 290px; top: 180px; font-size: 32px; color: #000; }\n      \n      .l-firstname { left: 290px; top: 235px; }\n      .v-firstname { left: 290px; top: 260px; font-size: 32px; color: #000; }\n      \n      .l-dob { left: 290px; top: 315px; }\n      .v-dob { left: 290px; top: 340px; font-size: 28px; color: #000; }\n      \n      .l-gender { left: 560px; top: 315px; }\n      .v-gender { left: 560px; top: 340px; font-size: 28px; color: #000; }\n      \n      .l-issued { left: 780px; top: 375px; font-size: 18px; text-align: center; width: 150px; }\n      .v-issued { left: 780px; top: 398px; font-size: 22px; text-align: center; width: 150px; font-weight: 800; }\n      \n      /* Fingerprint/NGA */\n      .nga {\n        position: absolute;\n        left: 790px;\n        top: 300px;\n        font-size: 42px;\n        font-weight: 900;\n        color: #009933;\n        text-align: center;\n        width: 140px;\n      }\n\n      /* BVN Footer */\n      .bvn-title {\n        position: absolute;\n        left: 0;\n        right: 0;\n        bottom: 120px;\n        text-align: center;\n        font-size: 22px;\n        color: #2a3375;\n        font-weight: 700;\n        text-transform: uppercase;\n      }\n      .bvn-val { \n        position:absolute; \n        left: 0;\n        right: 0;\n        bottom: 40px; \n        text-align: center;\n        font-size: 64px; \n        font-weight: 800; \n        letter-spacing: 4px;\n        color: #000;\n        font-family: monospace;\n      }\n\n      .qr[src=\"\"], .photo[src=\"\"] { display:none }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='header-text'>Please find below your BVN Plastic Slip</div>\n      <div class='stack'>\n        <div class='inner'>\n          <!-- Front -->\n          <div class='card top'>\n            <div class='bg-layer front-bg'></div>\n            \n            <img class='photo' src='{{image}}' alt='' onerror='this.style.display=\"none\"'>\n            \n            <div class='lbl l-surname'>SURNAME</div>\n            <div class='txt v-surname'>{{surname}}</div>\n            \n            <div class='lbl l-firstname'>FIRSTNAME/OTHER NAMES</div>\n            <div class='txt v-firstname'>{{first_name}} {{middle_name}}</div>\n            \n            <div class='lbl l-dob'>DATE OF BIRTH</div>\n            <div class='txt v-dob'>{{dob}}</div>\n            \n            <div class='lbl l-gender'>GENDER</div>\n            <div class='txt v-gender'>{{gender}}</div>\n            \n            <div class='lbl l-issued'>ISSUE DATE</div>\n            <div class='txt v-issued'>{{issue_date}}</div>\n            \n            <div class='nga'>NGA</div>\n            \n            <div class='bvn-title'>BANK VERIFICATION NUMBER (BVN)</div>\n            <div class='bvn-val'>{{bvn}}</div>\n          </div>\n          \n          <div class='card bottom'>\n             <div class='bg-layer back-bg'></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </body>\n</html>`\n      return plastic\n    }\n    const logo = '/assets/bvn-printout.png'\n    const base = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 794px; margin: 0 auto; }\n      .header { border: 2px solid #777; padding: 0; display: grid; grid-template-columns: 230px 1fr; align-items: center; min-height: 64px; }\n      .brand { display: flex; align-items: stretch; height: 100%; width: 100%; }\n      .brand img { height: 100%; width: 100%; object-fit: contain; display: block; margin: 0; }\n      .msg { text-align: center; font-size: 13px; }\n      .date { text-align: right; font-size: 12px; margin: 4px 0; }\n      .grid { display: grid; grid-template-columns: 360px 1fr; gap: 16px; margin-top: 12px; }\n      .photo { width: 360px; height: 320px; border: 1px solid #b3b3b3; object-fit: cover; }\n      .card { border: 1px solid #8f8f8f; }\n      .card-title { background: #f1f1f1; padding: 6px; text-align: center; font-weight: 600; border-bottom: 2px solid #8f8f8f; font-size: 13px; }\n      table { width: 100%; border-collapse: collapse; }\n      td { border: 1px solid #a8a8a8; padding: 6px 8px; font-size: 12px; }\n      .label { width: 42%; }\n      .caps { text-transform: uppercase; }\n      .note { margin-top: 10px; font-size: 12px; }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='header'>\n        <div class='brand'>\n          <img src='${logo}' alt='Bank Verification Number'>\n        </div>\n        <div class='msg'>The Bank Verification Number has successfully been verified.</div>\n      </div>\n      <div class='grid'>\n        <img class='photo' src='{{image}}' alt='Photo'>\n        <div>\n          <div class='date'>Date: {{generated_at}}</div>\n          <div class='card'>\n            <div class='card-title'>Personal Information</div>\n            <table>\n              <tr><td class='label'>BVN</td><td>{{bvn}}</td></tr>\n              <tr><td class='label'>NIN</td><td>{{nin}}</td></tr>\n              <tr><td class='label'>First Name</td><td class='caps'>{{first_name}}</td></tr>\n              <tr><td class='label'>Last Name</td><td class='caps'>{{last_name}}</td></tr>\n              <tr><td class='label'>Middle Name</td><td class='caps'>{{middle_name}}</td></tr>\n              <tr><td class='label'>Phone</td><td>{{phone_number}}</td></tr>\n              <tr><td class='label'>Email</td><td>{{email}}</td></tr>\n              <tr><td class='label'>Date of birth</td><td>{{dob}}</td></tr>\n              <tr><td class='label'>Gender</td><td class='caps'>{{gender}}</td></tr>\n              <tr><td class='label'>Enrollment Bank</td><td>{{enrollment_bank}}</td></tr>\n              <tr><td class='label'>Enrollment Branch</td><td>{{enrollment_branch}}</td></tr>\n              <tr><td class='label'>Registration Date</td><td>{{registration_date}}</td></tr>\n              <tr><td class='label'>Address</td><td>{{residential_address}}</td></tr>\n              <tr><td class='label'>State</td><td>{{state_of_residence}}</td></tr>\n            </table>\n          </div>\n        </div>\n      </div>\n      <div class='note'>NOTE: ..</div>\n    </div>\n  </body>\n</html>`\n    return base\n  }\n\n  if (action === \"nin.printout\" || action === \"nin.advanced\" || action === \"nin.slip\") {\n    const t = String(slipType || \"basic\").toLowerCase()\n    if (t === \"premium\") {\n      const bg = \"/assets/premium-blank.jpg\"\n      const premium = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      html, body { margin:0; padding:0; }\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 794px; margin: 0 auto; }\n      .header-text { text-align:center; font-size: 18px; color:#333; margin: 12px 0 12px; }\n      /* ID-1 physical card size: 85.60mm Ã— 53.98mm */\n      .stack { position: relative; width: 85.6mm; height: calc(53.98mm * 2); margin: 0 auto; border: 2px solid #000; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); background: #fff; }\n      .inner { position:absolute; left:0; top:0; width: 1080px; height: 1388px; transform: scale(0.299); transform-origin: top left; }\n      .card { position:absolute; left:0; width:1080px; height:674px; }\n      .top { top:0; }\n      .bottom { top:714px; background:#fff; }\n      .bg { position:absolute; left:0; top:0; width:100%; height:100%; object-fit: cover; }\n      .value { position:absolute; font-size: 26px; font-weight: 700; text-transform: uppercase; color:#222; }\n      .label { position:absolute; font-size: 26px; color:#5a5a5a }\n      .header { position:absolute; left: 38px; top: 18px; color:#0a7a43; font-weight: 800; font-size: 45px; letter-spacing:1px }\n      .subheader { position:absolute; left: 38px; top: 68px; color:#0a7a43; font-weight: 600; font-size: 30px }\n      .photo { position:absolute; left: 46px; top: 120px; width: 260px; height: 320px; object-fit: cover; border:0; }\n      .qr { position:absolute; left: 748px; top: 84px; width: 236px; height: 236px; object-fit: contain; }\n      .nga { position:absolute; left: 748px; top: 342px; width: 236px; text-align: center; font-weight: 800; font-size: 45px; letter-spacing:2px; }\n      .lab-issue { position:absolute; left: 748px; top: 400px; width: 236px; text-align: center; font-size: 27px; font-weight: 700; color:#5a5a5a; z-index: 2 }\n      .issue { position:absolute; left: 748px; top: 440px; width: 236px; text-align: center; font-size: 27px; font-weight: 800; letter-spacing:1px; z-index: 2 }\n      .lab-surname { left: 320px; top: 150px }\n      .lab-given { left: 320px; top: 229px }\n      .lab-dob { left: 320px; top: 313px }\n      .lab-gender { left: 577px; top: 318px }\n      .surname { left: 320px; top: 187px }\n      .given { left: 320px; top: 266px }\n      .dob { left: 320px; top: 350px }\n      .gender { left: 577px; top: 355px }\n      .nin-label { position:absolute; left: 0; right: 0; bottom: 118px; text-align: center; font-size: 34px; font-weight: 700; color:#333 }\n      .nin { position:absolute; left: 0; right: 0; bottom: 36px; text-align: center; font-size: 72px; font-weight: 800; letter-spacing:7.2px }\n      .disc-wrap { position:absolute; inset:0; display:flex; align-items:center; justify-content:center }\n      .disc { width: 880px; color:#222; transform: rotate(180deg); }\n      .disc h3 { text-align:center; font-size: 42px; font-weight: 800; margin: 0 0 8px }\n      .disc h4 { text-align:center; font-size: 26px; font-weight: 600; margin: 0 0 12px; font-style: italic }\n      .disc p { font-size: 26px; line-height: 1.45; margin: 8px 0 }\n      .disc .caution { text-align:center; font-size: 26px; font-weight: 800; margin: 10px 0 }\n      .qr[src=\"\"], .photo[src=\"\"] { display:none }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='header-text'>Please find below your Improved NIN Slip</div>\n      <div class='header-text'>You may cut it out of the paper, fold and laminate as desired.</div>\n      <div class='header-text'>For your security & privacy, please DO NOT permit others to make photocopies of this slip.</div>\n      <div class='stack'>\n      <div class='inner'>\n      <div class='card top'>\n        <img class='bg' src='${bg}' alt='NIN Premium Slip Background'>\n        <div class='header'>FEDERAL REPUBLIC OF NIGERIA</div>\n        <div class='subheader'>DIGITAL NIN SLIP</div>\n        <img class='photo' src='{{image}}' alt='' onerror='this.style.display=\"none\"'>\n        <img class='qr' src='{{qr_code}}' alt='' onerror='this.style.display=\"none\"'>\n      <div class='value nga'>NGA</div>\n      <div class='label lab-issue'>ISSUE DATE</div>\n        <div class='issue'>{{issue_date}}</div>\n        <div class='label lab-surname'>SURNAME/NOM</div>\n        <div class='label lab-given'>GIVEN NAMES/PRENOMS</div>\n        <div class='label lab-dob'>DATE OF BIRTH</div>\n        <div class='label lab-gender'>SEX/SEXE</div>\n        <div class='value surname'>{{surname}}</div>\n        <div class='value given'>{{given_names}},</div>\n        <div class='value dob'>{{dob}}</div>\n        <div class='value gender'>{{gender}}</div>\n        <div class='nin-label'>National Identification Number (NIN)</div>\n        <div class='nin'>{{nin_spaced}}</div>\n      </div>\n      <div class='card bottom'>\n        <div class='disc-wrap'>\n          <div class='disc'>\n            <h3>DISCLAIMER</h3>\n            <h4>Trust, but verify</h4>\n            <p>Kindly ensure each time this ID is presented, that you verify the credentials using a Government APPROVED verification resource.</p>\n            <p>The details on the front of this NIN Slip must EXACTLY match the verification result.</p>\n            <div class='caution'>CAUTION!</div>\n            <p>If this NIN was not issued to the person on the front of this document, please DO NOT attempt to scan, photocopy or replicate the personal data contained herein.</p>\n            <p>You are only permitted to scan the barcode for the purpose of identity verification.</p>\n            <p>The FEDERAL GOVERNMENT OF NIGERIA assumes no responsibility if you accept any variance on the scan result or do not scan the 2D barcode overleaf.</p>\n      </div>\n      </div>\n    </div>\n    </div>\n  </body>\n</html>`\n      return premium\n    }\n    if (t === \"standard\") {\n      const bg = \"/assets/standard-blank.jpg\"\n      const standard = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      html, body { margin:0; padding:0; }\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 794px; margin: 0 auto; }\n      .header-text { text-align:center; font-size: 18px; color:#333; margin: 12px 0 12px; }\n      .stack { position: relative; width: 85.6mm; height: calc(53.98mm * 2); margin: 0 auto; border: 2px solid #000; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); background: #fff; }\n      .inner { position:absolute; left:0; top:0; width: 1080px; height: 1388px; transform: scale(0.299); transform-origin: top left; }\n      .card { position:absolute; left:0; width:1080px; height:674px; }\n      .top { top:0; }\n      .bottom { top:714px; background:#fff; }\n      .bg { position:absolute; left:0; top:0; width:100%; height:100%; object-fit: cover; }\n      .value { position:absolute; font-size: 24px; font-weight: 700; text-transform: uppercase; color:#222; }\n      .label { position:absolute; font-size: 24px; color:#5a5a5a }\n      .photo { position:absolute; left: 48px; top: 140px; width: 240px; height: 300px; object-fit: cover; border:0; }\n      .qr { position:absolute; left: 756px; top: 120px; width: 216px; height: 216px; object-fit: contain; }\n      .nga { position:absolute; left: 756px; top: 356px; width: 216px; text-align: center; font-weight: 800; font-size: 45px; letter-spacing:2px; }\n      .lab-issue { position:absolute; left: 756px; top: 412px; width: 216px; text-align: center; font-size: 26px; font-weight: 700; color:#5a5a5a }\n      .issue { position:absolute; left: 756px; top: 455px; width: 216px; text-align: center; font-size: 26px; font-weight: 800 }\n      .lab-surname { left: 322px; top: 160px; font-size: 22px; color:#666 }\n      .lab-given { left: 322px; top: 230px; font-size: 22px; color:#666 }\n      .lab-dob { left: 322px; top: 300px; font-size: 22px; color:#666 }\n      .lab-gender { left: 560px; top: 305px; font-size: 22px; color:#666 }\n      .surname { left: 322px; top: 193px }\n      .given { left: 322px; top: 263px }\n      .dob { left: 322px; top: 333px }\n      .gender { left: 560px; top: 338px }\n      .nin-label { position:absolute; left: 0; right: 0; bottom: 132px; text-align: center; font-size: 30px; font-weight: 700; color:#333 }\n      .nin { position:absolute; left: 0; right: 0; bottom: 58px; text-align: center; font-size: 68px; font-weight: 800; letter-spacing:6.8px }\n      .nin-note { position:absolute; left:0; right:0; bottom: 52px; text-align:center; font-size: 18px; font-style: italic; color:#666 }\n      .disc-wrap { position:absolute; inset:0; display:flex; align-items:center; justify-content:center }\n      .disc { width: 880px; color:#222; transform: rotate(180deg); }\n      .disc h3 { text-align:center; font-size: 42px; font-weight: 800; margin: 0 0 8px }\n      .disc h4 { text-align:center; font-size: 26px; font-weight: 600; margin: 0 0 12px; font-style: italic }\n      .disc p { font-size: 22px; line-height: 1.45; margin: 8px 0 }\n      .disc .caution { text-align:center; font-size: 26px; font-weight: 800; margin: 10px 0 }\n      .qr[src=\"\"], .photo[src=\"\"] { display:none }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='header-text'>Please find below your Improved NIN Slip</div>\n      <div class='header-text'>You may cut it out of the paper, fold and laminate as desired.</div>\n      <div class='header-text'>For your security & privacy, please DO NOT permit others to make photocopies of this slip.</div>\n      <div class='stack'>\n      <div class='inner'>\n      <div class='card top'>\n        <img class='bg' src='${bg}' alt='NIN Standard Slip Background'>\n        <img class='photo' src='{{image}}' alt='' onerror='this.style.display=\"none\"'>\n        <img class='qr' src='{{qr_code}}' alt='' onerror='this.style.display=\"none\"'>\n        <div class='value nga'>NGA</div>\n        <div class='label lab-issue'>ISSUE DATE</div>\n        <div class='issue'>{{issue_date}}</div>\n        <div class='label lab-surname'>Surname/Nom</div>\n        <div class='label lab-given'>Given Names/Prenoms</div>\n        <div class='label lab-dob'>Date of Birth</div>\n        <div class='label lab-gender'>Sex/Sexe</div>\n        <div class='value surname'>{{surname}}</div>\n        <div class='value given'>{{given_names}}</div>\n        <div class='value dob'>{{dob}}</div>\n        <div class='value gender'>{{gender}}</div>\n        <div class='nin-label'>National Identification Number (NIN)</div>\n        <div class='nin'>{{nin_spaced}}</div>\n        <div class='nin-note'>Kindly ensure you scan the barcode to verify the credentials.</div>\n      </div>\n      <div class='card bottom'>\n        <div class='disc-wrap'>\n          <div class='disc'>\n            <h3>DISCLAIMER</h3>\n            <h4>Trust, but verify</h4>\n            <p>Kindly ensure each time this ID is presented, that you verify the credentials using a Government APPROVED verification resource.</p>\n            <p>The details on the front of this NIN Slip must EXACTLY match the verification result.</p>\n            <div class='caution'>CAUTION!</div>\n            <p>If this NIN was not issued to the person on the front of this document, please DO NOT attempt to scan, photocopy or replicate the personal data contained herein.</p>\n            <p>You are only permitted to scan the barcode for the purpose of identity verification.</p>\n            <p>The FEDERAL GOVERNMENT OF NIGERIA assumes no responsibility if you accept any variance on the scan result or do not scan the 2D barcode overleaf.</p>\n          </div>\n        </div>\n      </div>\n      </div>\n    </div>\n  </body>\n</html>`\n      return standard\n    }\n    if (t === \"regular\") {\n      const bg = \"/assets/regular-blank.jpg\"\n      const regular = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      @page { size: 1024px 478px; margin: 0; }\n      html, body { margin:0; padding:0; }\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .page { position: relative; width: 1024px; height: 478px; }\n      .bg { position:absolute; left:0; top:0; width:100%; height:100%; object-fit: cover; }\n      /* Header elements are part of background image; no extra overlays */\n\n      .panel { position:absolute; left: 40px; right: 40px; top: 120px; height: 260px; display:grid; grid-template-columns: 320px 320px 1fr; grid-template-rows: 64px 64px 64px 64px; }\n      .cell { position: relative; display:flex; align-items:center; padding: 0 12px; font-size: 15px; }\n      .cell.lab { font-weight: 500; color:#222 }\n      .cell.val { font-weight: 500; color:#222 }\n      .cell.val.name-val { text-transform: uppercase }\n      .cell.val.meta { position:absolute; right: 12px; bottom: 8px; }\n      .cell.lab.meta { position:absolute; right: 12px; top: 8px; }\n      .pair { display:flex; align-items:center; justify-content:flex-start; padding: 0 12px; }\n      .pair .lab { margin-left: 0; transform: translateX(-85px) }\n      .pair .val { margin-left: 0; margin-right: 0; transform: translateX(-69px); text-transform: uppercase }\n      .c4 .val { transform: translateX(-59px) }\n      /* lines are provided by background image; no extra borders */\n\n      /* Assign cells to grid */\n      .t-lab { grid-column: 1; grid-row: 1; margin-top: 22px; padding-left: 2px }\n      .t-val { grid-column: 2; grid-row: 1; margin-top: 22px }\n      .c1 { grid-column: 2; grid-row: 1; margin-top: 22px }\n\n      .nin-lab { grid-column: 1; grid-row: 2; padding-left: 2px }\n      .nin-val { grid-column: 2; grid-row: 2; font-size: 15px; font-weight: 500; letter-spacing: 0.3px; margin-left: -240px }\n      .t-val, .issue-val { margin-left: -240px }\n      .c2 { grid-column: 2; grid-row: 2 }\n\n      .issue-lab { grid-column: 1; grid-row: 3; margin-top: -30px; padding-left: 2px }\n      .issue-val { grid-column: 2; grid-row: 3; margin-top: -30px }\n      .c3 { grid-column: 2; grid-row: 3; margin-top: -30px }\n\n      .c4 { grid-column: 2; grid-row: 4; margin-top: -70px }\n\n      .addr { grid-column: 3; grid-row: 1 / span 3; padding: 12px; font-size: 14px; position: relative; }\n      .addr .lab { font-weight: 700; margin-top: 10px; color:#222 }\n      .addr .lines { margin-top: 9px; margin-right: 160px }\n      .addr .lines div { margin: 6px 0; font-weight: 600; text-transform: uppercase; font-size: 12px; color:#222 }\n      .addr .lines div:nth-child(2) { margin-top: 58px }\n      .addr .lines div:nth-child(3) { margin-top: 18px }\n      .addr .addr-photo { position:absolute; right: 12px; top: 19px; width: 140px; height: 188px; border: 1px solid #777; object-fit: cover; transform: translateX(15px) }\n\n      /* Bottom text/icons are present in background image; avoid overlays */\n      .qr[src=\"\"], .photo[src=\"\"] { display:none }\n    </style>\n  </head>\n  <body>\n    <div class='page'>\n      <img class='bg' src='${bg}' alt='NIN Regular Slip Background'>\n      <div class='panel'>\n        <div class='cell lab t-lab'>Tracking ID</div>\n        <div class='cell val t-val col2'>{{tracking_id}}</div>\n\n        <div class='cell lab nin-lab row2'>NIN</div>\n        <div class='cell val nin-val row2 col2'>{{nin}}</div>\n\n        <div class='cell lab issue-lab row3'>Issue Date</div>\n        <div class='cell val issue-val row3 col2'>{{issue_date}}</div>\n\n        <div class='cell pair c1'><div class='lab'>Surname</div><div class='val name-val'>{{surname}}</div></div>\n\n        <div class='cell pair c2 row2'><div class='lab'>First Name</div><div class='val name-val'>{{first_name}}</div></div>\n\n        <div class='cell pair c3 row3'><div class='lab'>Middle Name</div><div class='val name-val'>{{middle_name}}</div></div>\n\n        <div class='cell pair c4 row4'><div class='lab'>Gender</div><div class='val'>{{gender}}</div></div>\n\n        <div class='addr col3'>\n            <div class='lab'>Address:</div>\n          <div class='lines'>\n            <div>{{residence_address}}{{address}}</div>\n            <div>{{residence_town}}</div>\n            <div>{{residence_state}}</div>\n          </div>\n          <img class='addr-photo' src='{{image}}' alt='Photo' onerror='this.style.display=\"none\"'>\n        </div>\n      </div>\n      \n    </div>\n  </body>\n</html>`\n      return regular\n    }\n    const coat = '/assets/coat-of-arms.png'\n    const nimc = '/assets/nimc-logo.png'\n    const base = `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset='utf-8'>\n    <style>\n      body { font-family: Segoe UI, Arial, sans-serif; color: #000; }\n      .wrap { width: 794px; margin: 0 auto; }\n      .head { display: grid; grid-template-columns: 140px 1fr 160px; align-items: center; margin-top: 8px; }\n      .head img { object-fit: contain; display: block; }\n      .title { text-align: center; }\n      .title .top { font-weight: 600; font-size: 18px; }\n      .title .sub { font-weight: 600; font-size: 16px; }\n      .verified { color: #1f7a36; font-size: 24px; font-weight: 600; margin-top: 12px; }\n      .grid { display: grid; grid-template-columns: 1fr 280px; gap: 16px; margin-top: 16px; }\n      .photo { width: 120px; height: 140px; border: 1px solid #999; object-fit: cover; }\n      .labels { font-size: 13px; }\n      .labels .row { display: grid; grid-template-columns: 180px 1fr; gap: 8px; margin: 6px 0; }\n      .labels .name { font-weight: 600; }\n      .right { font-size: 12px; color: #333; }\n      .right .note { margin-top: 8px; }\n      .right ul { margin: 8px 0 0 16px; }\n      .right ul li { margin: 4px 0; }\n      .red { color: #d32f2f; font-weight: 600; }\n    </style>\n  </head>\n  <body>\n    <div class='wrap'>\n      <div class='head'>\n        <img src='${coat}' alt='Coat of Arms' style='height: 64px;'>\n        <div class='title'>\n          <div class='top'>Federal Republic of Nigeria</div>\n          <div class='sub'>Verified NIN Details</div>\n        </div>\n        <img src='${nimc}' alt='NIMC' style='height: 48px;'>\n      </div>\n\n      <div class='grid'>\n        <div>\n          <div class='labels'>\n            <div class='row'><div class='name'>First Name:</div><div>{{first_name}}</div></div>\n            <div class='row'><div class='name'>Middle Name:</div><div>{{middle_name}}</div></div>\n            <div class='row'><div class='name'>Last Name:</div><div>{{surname}}</div></div>\n            <div class='row'><div class='name'>Date of birth:</div><div>{{dob}}{{dateOfBirth}}</div></div>\n            <div class='row'><div class='name'>Gender:</div><div>{{gender}}</div></div>\n            <div class='row'><div class='name'>NIN Number:</div><div>{{nin}}</div></div>\n            <div class='row'><div class='name'>Tracking ID:</div><div>{{tracking_id}}{{trackingId}}</div></div>\n            <div class='row'><div class='name'>Phone Number:</div><div>{{phone_number}}</div></div>\n            <div class='row'><div class='name'>Email:</div><div>{{email}}</div></div>\n            <div class='row'><div class='name'>Employment Status:</div><div>{{employment_status}}</div></div>\n            <div class='row'><div class='name'>Marital Status:</div><div>{{marital_status}}</div></div>\n            <div class='row'><div class='name'>Education Level:</div><div>{{educational_level}}</div></div>\n            <div class='row'><div class='name'>Residence State:</div><div>{{residence_state}}</div></div>\n            <div class='row'><div class='name'>Residence LGA/Town:</div><div>{{residence_town}}</div></div>\n            <div class='row'><div class='name'>Birth State:</div><div>{{birth_state}}</div></div>\n            <div class='row'><div class='name'>Birth LGA:</div><div>{{birth_lga}}</div></div>\n            <div class='row'><div class='name'>Birth Country:</div><div>{{birth_country}}</div></div>\n            <div class='row'><div class='name'>Height:</div><div>{{height}}</div></div>\n            <div class='row'><div class='name'>Parent First Name:</div><div>{{parent_first_name}}</div></div>\n            <div class='row'><div class='name'>Spoken Language:</div><div>{{spoken_language}}</div></div>\n            <div class='row'><div class='name'>Central ID:</div><div>{{central_id}}</div></div>\n            <div class='row'><div class='name'>Address:</div><div>{{address}}</div></div>\n            <div class='row'><div class='name'>NOK First Name:</div><div>{{nok_firstname}}</div></div>\n            <div class='row'><div class='name'>NOK Middle Name:</div><div>{{nok_middlename}}</div></div>\n            <div class='row'><div class='name'>NOK Surname:</div><div>{{nok_surname}}</div></div>\n            <div class='row'><div class='name'>NOK Address 1:</div><div>{{nok_address1}}</div></div>\n            <div class='row'><div class='name'>NOK Address 2:</div><div>{{nok_address2}}</div></div>\n            <div class='row'><div class='name'>NOK State:</div><div>{{nok_state}}</div></div>\n            <div class='row'><div class='name'>NOK LGA/Town:</div><div>{{nok_lga_town}}</div></div>\n            <div class='row'><div class='name'>NOK Postal Code:</div><div>{{nok_postalcode}}</div></div>\n          </div>\n          <img class='photo' src='{{image}}' alt='Photo' />\n        </div>\n        <div class='right'>\n          <div class='verified'>Verified</div>\n          <div class='note'>This is a property of National Identity Management Commission (NIMC), Nigeria.\n            If found, please return to the nearest NIMC's office or contact +234 815 769 1214, +234 815 769 1071\n          </div>\n          <ul>\n            <li>This NIN slip remains the property of the Federal Republic of Nigeria, and MUST be surrendered on demand;</li>\n            <li>This NIN slip does not imply nor confer citizenship of the Federal Republic of Nigeria on the individual the document is issued to;</li>\n            <li>This NIN slip is valid for the lifetime of the holder and <span class='red'>DOES NOT EXPIRE.</span></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </body>\n</html>`\n    return base\n  }\n  const base = `<div style='font-family:Arial,sans-serif;padding:24px'>\n  <h2 style='text-align:center;margin:0;'>UFriends Information Technology</h2>\n  <h3 style='text-align:center;margin:8px 0;'>${name}</h3>\n  <div style='margin-top:16px;font-size:12px;'>\n    <div>Date: {{date_of_birth}}{{dob}}</div>\n    <div>Name: {{full_name}}{{first_name}} {{last_name}}</div>\n    <div>NIN: {{nin}}</div>\n    <div>BVN: {{bvn}}</div>\n    <div>Passport No: {{passport_number}}</div>\n    <div>Driver License: {{licenseNumber}}{{license_number}}</div>\n    <div>Phone: {{phoneNumber}}{{phone}}</div>\n    <div>Plate: {{plate_number}}{{plateNumber}}</div>\n    <div>VIN: {{number}}{{vin}}</div>\n    <div>RC/BN: {{rc_number}}{{rcNumber}}</div>\n    <div>Entity: {{company_name}}{{name}}</div>\n    <div>TIN: {{tin}}</div>\n  </div>\n  <div style='position:fixed;bottom:24px;font-size:10px;'>Note: Generated by UFriends.com.ng</div>\n</div>`\n  return `<!DOCTYPE html><html><head><meta charset='utf-8'></head><body>${base}</body></html>`\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const auth = await requireAuth(req, { roles: [\"ADMIN\", \"AGENT\", \"USER\"] })\n    if (!auth.ok) return auth.response\n\n    const body = await req.json().catch(() => ({}))\n    const action = String(body?.action || \"\").trim()\n    const slipType = String(body?.slipType || \"\").trim() || undefined\n    if (!action) return NextResponse.json({ error: \"Missing action\" }, { status: 400 })\n\n    const name = nameFor(action, slipType)\n    const existing = await prisma.ninTemplate.findFirst({ where: { name } })\n    const html = htmlFor(action, name, slipType)\n    const matches = Array.from(html.matchAll(/\\{\\{\\s*([a-zA-Z0-9_\\.]+)\\s*\\}\\}/g)).map((m) => `{{${m[1]}}}`)\n    const placeholders = [...new Set(matches)]\n    if (existing && existing.isActive) {\n      const updated = await prisma.ninTemplate.update({\n        where: { id: existing.id },\n        data: { templateContent: html, placeholders }\n      })\n      return NextResponse.json({ ok: true, templateId: updated.id, name })\n    }\n\n    const created = await prisma.ninTemplate.upsert({\n      where: { id: existing?.id || \"\" },\n      update: { name, type: \"digital\", templateContent: html, placeholders, isActive: true },\n      create: { name, type: \"digital\", templateContent: html, placeholders, isActive: true, createdBy: auth.user.id },\n    })\n    return NextResponse.json({ ok: true, templateId: created.id, name })\n  } catch (err: any) {\n    return NextResponse.json({ error: String(err?.message || err) }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}