{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/security.ts"],"sourcesContent":["import arcjet, { shield, validateEmail } from \"@arcjet/next\"\n\ntype AJInstance = ReturnType<typeof arcjet> | null\n\n// Create a shared Arcjet instance with common rules.\n// In development, ARCJET_KEY may be missing, so we fail open.\nexport const aj: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n      ],\n    })\n  : null\n\n// Email-validation instance for routes that need email context\nexport const ajWithEmail: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n        validateEmail({ mode: \"LIVE\", deny: [\"DISPOSABLE\", \"INVALID\", \"NO_MX_RECORDS\"] }),\n      ],\n    })\n  : null\n\nexport async function protect(req: Request, opts?: { email?: string }) {\n  if (!aj) return { allowed: true }\n  try {\n    const decision = await (opts?.email && ajWithEmail\n      ? (ajWithEmail as any).protect(req as any, { email: opts.email })\n      : (aj as any).protect(req as any))\n    if (decision?.isDenied?.()) return { allowed: false }\n    return { allowed: true }\n  } catch {\n    // Fail open in dev\n    return { allowed: true }\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAMO,MAAM,KAAiB,QAAQ,GAAG,CAAC,UAAU,GAChD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;KACvB;AACH,KACA;AAGG,MAAM,cAA0B,QAAQ,GAAG,CAAC,UAAU,GACzD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,kJAAa,EAAC;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAc;gBAAW;aAAgB;QAAC;KAChF;AACH,KACA;AAEG,eAAe,QAAQ,GAAY,EAAE,IAAyB;IACnE,IAAI,CAAC,IAAI,OAAO;QAAE,SAAS;IAAK;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,CAAC,MAAM,SAAS,cACnC,AAAC,YAAoB,OAAO,CAAC,KAAY;YAAE,OAAO,KAAK,KAAK;QAAC,KAC7D,AAAC,GAAW,OAAO,CAAC,IAAW;QACnC,IAAI,UAAU,cAAc,OAAO;YAAE,SAAS;QAAM;QACpD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAM;QACN,mBAAmB;QACnB,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 339, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/validation.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { ZodXssSanitizer, ACTION_LEVELS } from \"zod-xss-sanitizer\"\n\n// Shared XSS sanitizer instance\nexport const sanitizer = ZodXssSanitizer.sanitizer({ actionLevel: ACTION_LEVELS.SANITIZE })\n\nexport function sanitizeEmail(input: string) {\n  return sanitizer.parse(z.string().trim().toLowerCase().email().parse(input))\n}\n\nexport function sanitizeString(input: string) {\n  return sanitizer.parse(z.string().trim().min(1).parse(input))\n}\n\nexport function sanitizePhone(input: string) {\n  const schema = z.string().trim().regex(/^\\+?[0-9]{10,15}$/i, { message: \"Invalid phone\" })\n  return sanitizer.parse(schema.parse(input))\n}\n\nexport function isValidUrl(input: string) {\n  const res = z.string().url().safeParse(input)\n  return res.success\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,YAAY,8KAAe,CAAC,SAAS,CAAC;IAAE,aAAa,4KAAa,CAAC,QAAQ;AAAC;AAElF,SAAS,cAAc,KAAa;IACzC,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,WAAW,GAAG,KAAK,GAAG,KAAK,CAAC;AACvE;AAEO,SAAS,eAAe,KAAa;IAC1C,OAAO,UAAU,KAAK,CAAC,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG,KAAK,CAAC;AACxD;AAEO,SAAS,cAAc,KAAa;IACzC,MAAM,SAAS,yKAAC,CAAC,MAAM,GAAG,IAAI,GAAG,KAAK,CAAC,sBAAsB;QAAE,SAAS;IAAgB;IACxF,OAAO,UAAU,KAAK,CAAC,OAAO,KAAK,CAAC;AACtC;AAEO,SAAS,WAAW,KAAa;IACtC,MAAM,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,GAAG,SAAS,CAAC;IACvC,OAAO,IAAI,OAAO;AACpB","debugId":null}},
    {"offset": {"line": 378, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\nimport type { NextAuthOptions } from \"next-auth\"\nimport Credentials from \"next-auth/providers/credentials\"\nimport { prisma } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\nimport { protect } from \"@/lib/security\"\nimport Joi from \"joi\"\nimport { sanitizer } from \"@/lib/validation\"\n\nconst isProd = process.env.NODE_ENV === \"production\"\n\nexport const authOptions: NextAuthOptions = {\n  session: { strategy: \"jwt\" },\n  providers: [\n    Credentials({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, req) {\n        console.log(\"AUTH DEBUG: authorize called with\", { email: credentials?.email })\n        // Basic input validation with Joi\n        const schema = Joi.object({\n          // Allow non-public TLDs (e.g., .local) in development; enforce strict in production\n          email: isProd\n            ? Joi.string().email().required()\n            : Joi.string().email({ tlds: { allow: false } }).required(),\n          password: Joi.string().min(6).required(),\n        })\n        const { error, value } = schema.validate({\n          email: credentials?.email,\n          password: credentials?.password,\n        })\n        if (error) {\n          console.log(\"AUTH DEBUG: Joi validation error\", error)\n          return null\n        }\n\n        // Sanitize email using shared sanitizer\n        const safeEmail = sanitizer.parse(value.email.trim().toLowerCase())\n\n        // Centralized protection: Shield/email validation handled by shared helper\n        try {\n          const sec = await protect(req as any, { email: safeEmail })\n          if (!sec.allowed) {\n            console.log(\"AUTH DEBUG: Protected by Arcjet/Security\")\n            return null\n          }\n        } catch {\n          // Fail open to avoid login lockouts if Arcjet fails\n        }\n\n        // Credentials auth\n        const user = await prisma.user.findUnique({ where: { email: safeEmail } })\n        if (!user) {\n          console.log(\"AUTH DEBUG: User not found\", safeEmail)\n          return null\n        }\n        const ok = await bcrypt.compare(value.password, user.passwordHash)\n        if (!ok) {\n          console.log(\"AUTH DEBUG: Password mismatch for\", safeEmail)\n          return null\n        }\n        console.log(\"AUTH DEBUG: Auth successful for\", safeEmail)\n        return { id: user.id, email: user.email, role: user.role }\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        ; (token as any).id = (user as any).id\n          ; (token as any).role = (user as any).role\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        ; (session.user as any).id = (token as any).id\n          ; (session.user as any).role = (token as any).role\n      }\n      return session\n    },\n  },\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,MAAM,SAAS,oDAAyB;AAEjC,MAAM,cAA+B;IAC1C,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,IAAA,qKAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,GAAG;gBAC9B,QAAQ,GAAG,CAAC,qCAAqC;oBAAE,OAAO,aAAa;gBAAM;gBAC7E,kCAAkC;gBAClC,MAAM,SAAS,gJAAG,CAAC,MAAM,CAAC;oBACxB,oFAAoF;oBACpF,OAAO,sCACH,0BACA,gJAAG,CAAC,MAAM,GAAG,KAAK,CAAC;wBAAE,MAAM;4BAAE,OAAO;wBAAM;oBAAE,GAAG,QAAQ;oBAC3D,UAAU,gJAAG,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;gBACxC;gBACA,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,OAAO,QAAQ,CAAC;oBACvC,OAAO,aAAa;oBACpB,UAAU,aAAa;gBACzB;gBACA,IAAI,OAAO;oBACT,QAAQ,GAAG,CAAC,oCAAoC;oBAChD,OAAO;gBACT;gBAEA,wCAAwC;gBACxC,MAAM,YAAY,gIAAS,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,GAAG,WAAW;gBAEhE,2EAA2E;gBAC3E,IAAI;oBACF,MAAM,MAAM,MAAM,IAAA,4HAAO,EAAC,KAAY;wBAAE,OAAO;oBAAU;oBACzD,IAAI,CAAC,IAAI,OAAO,EAAE;wBAChB,QAAQ,GAAG,CAAC;wBACZ,OAAO;oBACT;gBACF,EAAE,OAAM;gBACN,oDAAoD;gBACtD;gBAEA,mBAAmB;gBACnB,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,OAAO;oBAAU;gBAAE;gBACxE,IAAI,CAAC,MAAM;oBACT,QAAQ,GAAG,CAAC,8BAA8B;oBAC1C,OAAO;gBACT;gBACA,MAAM,KAAK,MAAM,8IAAM,CAAC,OAAO,CAAC,MAAM,QAAQ,EAAE,KAAK,YAAY;gBACjE,IAAI,CAAC,IAAI;oBACP,QAAQ,GAAG,CAAC,qCAAqC;oBACjD,OAAO;gBACT;gBACA,QAAQ,GAAG,CAAC,mCAAmC;gBAC/C,OAAO;oBAAE,IAAI,KAAK,EAAE;oBAAE,OAAO,KAAK,KAAK;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAC3D;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;;gBACL,MAAc,EAAE,GAAG,AAAC,KAAa,EAAE;gBACjC,MAAc,IAAI,GAAG,AAAC,KAAa,IAAI;YAC9C;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;;gBACb,QAAQ,IAAI,CAAS,EAAE,GAAG,AAAC,MAAc,EAAE;gBACzC,QAAQ,IAAI,CAAS,IAAI,GAAG,AAAC,MAAc,IAAI;YACtD;YACA,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt-auth.ts"],"sourcesContent":["import { verifyAccessToken } from \"./jwt\"\nimport { getServerSession } from \"next-auth\"\nimport { authOptions } from \"@/lib/auth\"\n\nexport type AuthUser = { id: string; email?: string | null; role?: string | null }\n\nexport async function getAuthUser(req: Request): Promise<AuthUser | null> {\n  // Prefer Authorization: Bearer access token\n  const authHeader = (req as any).headers?.get?.(\"authorization\") || \"\"\n  const [, token] = authHeader.split(\" \")\n  if (authHeader.toLowerCase().startsWith(\"bearer \") && token) {\n    try {\n      const payload: any = await verifyAccessToken(token)\n      return { id: payload.sub, email: payload.email, role: payload.role }\n    } catch {}\n  }\n\n  // Fallback to NextAuth session\n  try {\n    const session = await getServerSession(authOptions)\n    if (session?.user?.id) {\n      return { id: (session.user as any).id, email: session.user.email, role: (session.user as any).role }\n    }\n  } catch {}\n\n  return null\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,eAAe,YAAY,GAAY;IAC5C,4CAA4C;IAC5C,MAAM,aAAa,AAAC,IAAY,OAAO,EAAE,MAAM,oBAAoB;IACnE,MAAM,GAAG,MAAM,GAAG,WAAW,KAAK,CAAC;IACnC,IAAI,WAAW,WAAW,GAAG,UAAU,CAAC,cAAc,OAAO;QAC3D,IAAI;YACF,MAAM,UAAe,MAAM,IAAA,iIAAiB,EAAC;YAC7C,OAAO;gBAAE,IAAI,QAAQ,GAAG;gBAAE,OAAO,QAAQ,KAAK;gBAAE,MAAM,QAAQ,IAAI;YAAC;QACrE,EAAE,OAAM,CAAC;IACX;IAEA,+BAA+B;IAC/B,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,4HAAW;QAClD,IAAI,SAAS,MAAM,IAAI;YACrB,OAAO;gBAAE,IAAI,AAAC,QAAQ,IAAI,CAAS,EAAE;gBAAE,OAAO,QAAQ,IAAI,CAAC,KAAK;gBAAE,MAAM,AAAC,QAAQ,IAAI,CAAS,IAAI;YAAC;QACrG;IACF,EAAE,OAAM,CAAC;IAET,OAAO;AACT","debugId":null}},
    {"offset": {"line": 536, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/require-auth.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport { getAuthUser, AuthUser } from \"@/lib/jwt-auth\"\n\nexport type RequireAuthOptions = {\n  roles?: Array<string>\n}\n\nexport type RequireAuthResult = {\n  ok: true\n  user: AuthUser\n} | {\n  ok: false\n  response: NextResponse\n}\n\nexport async function requireAuth(req: Request, options: RequireAuthOptions = {}): Promise<RequireAuthResult> {\n  const tokenUser = await getAuthUser(req)\n  if (!tokenUser?.id) {\n    return { ok: false, response: NextResponse.json({ error: \"Unauthorized\" }, { status: 401 }) }\n  }\n\n  // Check DB for status and latest role\n  const user = await prisma.user.findUnique({\n    where: { id: tokenUser.id },\n    select: { id: true, email: true, role: true, status: true }\n  })\n\n  if (!user) {\n    return { ok: false, response: NextResponse.json({ error: \"Unauthorized\" }, { status: 401 }) }\n  }\n\n  if (user.status === \"suspended\") {\n    return { ok: false, response: NextResponse.json({ error: \"Account suspended\" }, { status: 403 }) }\n  }\n\n  // Enforce role check if required\n  if (options.roles && user.role && !options.roles.includes(user.role)) {\n    return { ok: false, response: NextResponse.json({ error: \"Forbidden\" }, { status: 403 }) }\n  }\n\n  // Return the DB user to ensure downstream consumers have up-to-date data\n  return { ok: true, user: { id: user.id, email: user.email, role: user.role } }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAcO,eAAe,YAAY,GAAY,EAAE,UAA8B,CAAC,CAAC;IAC9E,MAAM,YAAY,MAAM,IAAA,mIAAW,EAAC;IACpC,IAAI,CAAC,WAAW,IAAI;QAClB,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC9F;IAEA,sCAAsC;IACtC,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,UAAU,EAAE;QAAC;QAC1B,QAAQ;YAAE,IAAI;YAAM,OAAO;YAAM,MAAM;YAAM,QAAQ;QAAK;IAC5D;IAEA,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC9F;IAEA,IAAI,KAAK,MAAM,KAAK,aAAa;QAC/B,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAAG;IACnG;IAEA,iCAAiC;IACjC,IAAI,QAAQ,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,CAAC,QAAQ,CAAC,KAAK,IAAI,GAAG;QACpE,OAAO;YAAE,IAAI;YAAO,UAAU,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC3F;IAEA,yEAAyE;IACzE,OAAO;QAAE,IAAI;QAAM,MAAM;YAAE,IAAI,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC;IAAE;AAC/E","debugId":null}},
    {"offset": {"line": 615, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/provider-manager.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\"\n\nexport interface ProviderConfig {\n  id: string\n  name: string\n  category: string\n  isActive: boolean\n  priority: number\n  apiBaseUrl: string | null\n  configJson: Record<string, unknown>\n  apiKeys: Array<{\n    id: string\n    keyName: string\n    keyValue: string\n  }>\n}\n\nexport interface ServiceProviderInfo {\n  provider: ProviderConfig | null\n  fallbackProviders: ProviderConfig[]\n  hasActiveProvider: boolean\n}\n\n/**\n * Get the active provider for a specific service category\n */\nexport async function getActiveProvider(category: string): Promise<ServiceProviderInfo> {\n  try {\n    const providers = await prisma.serviceProvider.findMany({\n      where: { category },\n      include: {\n        apiKeys: {\n          select: {\n            id: true,\n            keyName: true,\n            keyValue: true\n          }\n        }\n      },\n      orderBy: [\n        { isActive: \"desc\" },\n        { priority: \"desc\" },\n        { name: \"asc\" }\n      ]\n    })\n\n    const toConfig = (p: typeof providers[number]): ProviderConfig => ({\n      id: p.id,\n      name: p.name,\n      category: p.category,\n      isActive: p.isActive,\n      priority: p.priority,\n      apiBaseUrl: p.apiBaseUrl,\n      configJson: p.configJson as Record<string, unknown>,\n      apiKeys: p.apiKeys\n    })\n\n    const activeProviderRaw = providers.find(p => p.isActive) || null\n    const fallbackProvidersRaw = providers.filter(p => !p.isActive && p.priority > 0)\n\n    return {\n      provider: activeProviderRaw ? toConfig(activeProviderRaw) : null,\n      fallbackProviders: fallbackProvidersRaw.map(toConfig),\n      hasActiveProvider: !!activeProviderRaw\n    }\n  } catch (error) {\n    console.error(`Failed to get active provider for category ${category}:`, error)\n    return {\n      provider: null,\n      fallbackProviders: [],\n      hasActiveProvider: false\n    }\n  }\n}\n\n/**\n * Get API key value by name for a specific provider\n */\nexport async function getProviderApiKey(providerId: string, keyName: string): Promise<string | null> {\n  try {\n    const apiKey = await prisma.providerApiKey.findFirst({\n      where: {\n        providerId,\n        keyName\n      },\n      select: {\n        keyValue: true\n      }\n    })\n\n    return apiKey?.keyValue || null\n  } catch (error) {\n    console.error(`Failed to get API key ${keyName} for provider ${providerId}:`, error)\n    return null\n  }\n}\n\n/**\n * Get all API keys for a provider as a key-value object\n */\nexport async function getProviderApiKeys(providerId: string): Promise<Record<string, string>> {\n  try {\n    const apiKeys = await prisma.providerApiKey.findMany({\n      where: { providerId },\n      select: {\n        keyName: true,\n        keyValue: true\n      }\n    })\n\n    return apiKeys.reduce<Record<string, string>>((acc, key) => {\n      acc[key.keyName] = key.keyValue\n      return acc\n    }, {})\n  } catch (error) {\n    console.error(`Failed to get API keys for provider ${providerId}:`, error)\n    return {}\n  }\n}\n\n/**\n * Check if a provider is available and active\n */\nexport async function isProviderAvailable(category: string): Promise<boolean> {\n  try {\n    const activeProvider = await prisma.serviceProvider.findFirst({\n      where: {\n        category,\n        isActive: true\n      }\n    })\n\n    return !!activeProvider\n  } catch (error) {\n    console.error(`Failed to check provider availability for category ${category}:`, error)\n    return false\n  }\n}\n\n/**\n * Get provider configuration with decrypted API keys\n */\nexport async function getProviderConfig(providerId: string): Promise<ProviderConfig | null> {\n  try {\n    const provider = await prisma.serviceProvider.findUnique({\n      where: { id: providerId },\n      include: {\n        apiKeys: {\n          select: {\n            id: true,\n            keyName: true,\n            keyValue: true\n          }\n        }\n      }\n    })\n\n    if (!provider) return null\n\n    return {\n      id: provider.id,\n      name: provider.name,\n      category: provider.category,\n      isActive: provider.isActive,\n      priority: provider.priority,\n      apiBaseUrl: provider.apiBaseUrl,\n      configJson: provider.configJson as Record<string, unknown>,\n      apiKeys: provider.apiKeys\n    }\n  } catch (error) {\n    console.error(`Failed to get provider config for ${providerId}:`, error)\n    return null\n  }\n}\n\n/**\n * Update provider status (activate/deactivate)\n */\nexport async function updateProviderStatus(providerId: string, isActive: boolean): Promise<boolean> {\n  try {\n    await prisma.serviceProvider.update({\n      where: { id: providerId },\n      data: { \n        isActive,\n        updatedAt: new Date()\n      }\n    })\n    return true\n  } catch (error) {\n    console.error(`Failed to update provider status for ${providerId}:`, error)\n    return false\n  }\n}\n\n/**\n * Get all providers for a category with their status\n */\nexport async function getCategoryProviders(category: string): Promise<ProviderConfig[]> {\n  try {\n    const providers = await prisma.serviceProvider.findMany({\n      where: { category },\n      include: {\n        apiKeys: {\n          select: {\n            id: true,\n            keyName: true,\n            keyValue: true\n          }\n        }\n      },\n      orderBy: [\n        { isActive: \"desc\" },\n        { priority: \"desc\" },\n        { name: \"asc\" }\n      ]\n    })\n\n    return providers.map((p) => ({\n      id: p.id,\n      name: p.name,\n      category: p.category,\n      isActive: p.isActive,\n      priority: p.priority,\n      apiBaseUrl: p.apiBaseUrl,\n      configJson: p.configJson as Record<string, unknown>,\n      apiKeys: p.apiKeys\n    }))\n  } catch (error) {\n    console.error(`Failed to get providers for category ${category}:`, error)\n    return []\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 832, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/http-client.ts"],"sourcesContent":["type RetryOptions = {\n  retries?: number\n  baseDelayMs?: number\n  maxDelayMs?: number\n  timeoutMs?: number\n  retryOnStatuses?: number[]\n}\n\nasync function withTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {\n  return new Promise<T>((resolve, reject) => {\n    const timer = setTimeout(() => reject(new Error(`Request timed out after ${ms}ms`)), ms)\n    promise\n      .then((val) => {\n        clearTimeout(timer)\n        resolve(val)\n      })\n      .catch((err) => {\n        clearTimeout(timer)\n        reject(err)\n      })\n  })\n}\n\nfunction sleep(ms: number) {\n  return new Promise((r) => setTimeout(r, ms))\n}\n\nexport async function fetchJsonWithRetry(input: RequestInfo | URL, init: RequestInit = {}, opts: RetryOptions = {}) {\n  const {\n    retries = 3,\n    baseDelayMs = 300,\n    maxDelayMs = 3000,\n    timeoutMs = 8000,\n    retryOnStatuses = [408, 429, 500, 502, 503, 504],\n  } = opts\n\n  let attempt = 0\n  let lastError: any\n  while (attempt <= retries) {\n    try {\n      const res = await withTimeout(fetch(input, init), timeoutMs)\n      let data: any = null\n      try {\n        data = await res.json()\n      } catch {\n        data = null\n      }\n      if (!res.ok && retryOnStatuses.includes(res.status) && attempt < retries) {\n        const delay = Math.min(maxDelayMs, baseDelayMs * Math.pow(2, attempt))\n        await sleep(delay)\n        attempt++\n        continue\n      }\n      return { res, data }\n    } catch (err) {\n      lastError = err\n      if (attempt < retries) {\n        const delay = Math.min(maxDelayMs, baseDelayMs * Math.pow(2, attempt))\n        await sleep(delay)\n        attempt++\n        continue\n      }\n      throw err\n    }\n  }\n  throw lastError\n}\n\nexport function buildAuthHeaders(apiKey?: string, extra?: Record<string, string>) {\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n    ...(extra || {}),\n  }\n  if (apiKey) {\n    headers['Authorization'] = `Bearer ${apiKey}`\n    headers['x-api-key'] = apiKey\n  }\n  return headers\n}"],"names":[],"mappings":";;;;;;AAQA,eAAe,YAAe,OAAmB,EAAE,EAAU;IAC3D,OAAO,IAAI,QAAW,CAAC,SAAS;QAC9B,MAAM,QAAQ,WAAW,IAAM,OAAO,IAAI,MAAM,CAAC,wBAAwB,EAAE,GAAG,EAAE,CAAC,IAAI;QACrF,QACG,IAAI,CAAC,CAAC;YACL,aAAa;YACb,QAAQ;QACV,GACC,KAAK,CAAC,CAAC;YACN,aAAa;YACb,OAAO;QACT;IACJ;AACF;AAEA,SAAS,MAAM,EAAU;IACvB,OAAO,IAAI,QAAQ,CAAC,IAAM,WAAW,GAAG;AAC1C;AAEO,eAAe,mBAAmB,KAAwB,EAAE,OAAoB,CAAC,CAAC,EAAE,OAAqB,CAAC,CAAC;IAChH,MAAM,EACJ,UAAU,CAAC,EACX,cAAc,GAAG,EACjB,aAAa,IAAI,EACjB,YAAY,IAAI,EAChB,kBAAkB;QAAC;QAAK;QAAK;QAAK;QAAK;QAAK;KAAI,EACjD,GAAG;IAEJ,IAAI,UAAU;IACd,IAAI;IACJ,MAAO,WAAW,QAAS;QACzB,IAAI;YACF,MAAM,MAAM,MAAM,YAAY,MAAM,OAAO,OAAO;YAClD,IAAI,OAAY;YAChB,IAAI;gBACF,OAAO,MAAM,IAAI,IAAI;YACvB,EAAE,OAAM;gBACN,OAAO;YACT;YACA,IAAI,CAAC,IAAI,EAAE,IAAI,gBAAgB,QAAQ,CAAC,IAAI,MAAM,KAAK,UAAU,SAAS;gBACxE,MAAM,QAAQ,KAAK,GAAG,CAAC,YAAY,cAAc,KAAK,GAAG,CAAC,GAAG;gBAC7D,MAAM,MAAM;gBACZ;gBACA;YACF;YACA,OAAO;gBAAE;gBAAK;YAAK;QACrB,EAAE,OAAO,KAAK;YACZ,YAAY;YACZ,IAAI,UAAU,SAAS;gBACrB,MAAM,QAAQ,KAAK,GAAG,CAAC,YAAY,cAAc,KAAK,GAAG,CAAC,GAAG;gBAC7D,MAAM,MAAM;gBACZ;gBACA;YACF;YACA,MAAM;QACR;IACF;IACA,MAAM;AACR;AAEO,SAAS,iBAAiB,MAAe,EAAE,KAA8B;IAC9E,MAAM,UAAkC;QACtC,gBAAgB;QAChB,GAAI,SAAS,CAAC,CAAC;IACjB;IACA,IAAI,QAAQ;QACV,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,QAAQ;QAC7C,OAAO,CAAC,YAAY,GAAG;IACzB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 911, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/airtime-ported.ts"],"sourcesContent":["import { type AirtimeRequest, type AirtimeResponse } from \"@/lib/providers/airtime\"\nimport { type ProviderConfig } from \"@/lib/provider-manager\"\nimport { fetchJsonWithRetry, buildAuthHeaders } from \"@/lib/http-client\"\n\n/**\n * Real Airtime VTU adapter for PortedSIM-like providers.\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\n *\n * Expected provider config:\n * - apiBaseUrl: string (e.g., https://api.portedsim.com)\n * - apiKeys: [{ keyName: \"apiKey\", keyValue: \"...\" }]\n * - configJson may include { adapter: \"ported\", endpoints: { vtu: \"/airtime/vtu\" } }\n */\nexport async function sendAirtimeViaPorted(\n  req: AirtimeRequest,\n  provider?: ProviderConfig,\n): Promise<AirtimeResponse> {\n  const apiBase = provider?.apiBaseUrl || process.env.PORTEDSIM_BASE_URL || \"\"\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\n    process.env.PORTEDSIM_API_KEY || \"\"\n\n  const vtuPath = (provider?.configJson as any)?.endpoints?.vtu || \"/airtime/vtu\"\n  const url = `${apiBase}${vtuPath}`\n\n  if (!apiBase || !apiKey) {\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL or API key\" }\n  }\n\n  if (!req.params?.phone || !req.params?.network) {\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing phone or network\" }\n  }\n\n  try {\n    const payload = {\n      phone: req.params.phone,\n      network: req.params.network,\n      amount: req.amount,\n      subServiceId: req.subServiceId,\n    }\n\n    const { res, data } = await fetchJsonWithRetry(url, {\n      method: \"POST\",\n      headers: buildAuthHeaders(apiKey),\n      body: JSON.stringify(payload),\n    }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\n\n    if (!res.ok) {\n      const message = data?.message || data?.error || `Provider error (${res.status})`\n      const code = data?.code || \"PROVIDER_ERROR\"\n      return { ok: false, code, message }\n    }\n\n    const providerReference = data?.reference || data?.providerRef || data?.transactionId\n    if (!providerReference) {\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\n    }\n\n    return {\n      ok: true,\n      providerReference,\n      message: data?.message || \"Airtime delivered\",\n    }\n  } catch (err) {\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\n  }\n}"],"names":[],"mappings":";;;;AAEA;;AAWO,eAAe,qBACpB,GAAmB,EACnB,QAAyB;IAEzB,MAAM,UAAU,UAAU,cAAc,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAC1E,MAAM,SAAS,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,WAAW,YAC1F,QAAQ,GAAG,CAAC,iBAAiB,IAAI;IAEnC,MAAM,UAAU,AAAC,UAAU,YAAoB,WAAW,OAAO;IACjE,MAAM,MAAM,GAAG,UAAU,SAAS;IAElC,IAAI,CAAC,WAAW,CAAC,QAAQ;QACvB,OAAO;YAAE,IAAI;YAAO,MAAM;YAAkB,SAAS;QAAuC;IAC9F;IAEA,IAAI,CAAC,IAAI,MAAM,EAAE,SAAS,CAAC,IAAI,MAAM,EAAE,SAAS;QAC9C,OAAO;YAAE,IAAI;YAAO,MAAM;YAAa,SAAS;QAA2B;IAC7E;IAEA,IAAI;QACF,MAAM,UAAU;YACd,OAAO,IAAI,MAAM,CAAC,KAAK;YACvB,SAAS,IAAI,MAAM,CAAC,OAAO;YAC3B,QAAQ,IAAI,MAAM;YAClB,cAAc,IAAI,YAAY;QAChC;QAEA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,6IAAkB,EAAC,KAAK;YAClD,QAAQ;YACR,SAAS,IAAA,2IAAgB,EAAC;YAC1B,MAAM,KAAK,SAAS,CAAC;QACvB,GAAG;YAAE,SAAS;YAAG,aAAa;YAAK,WAAW;QAAM;QAEpD,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,UAAU,MAAM,WAAW,MAAM,SAAS,CAAC,gBAAgB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YAChF,MAAM,OAAO,MAAM,QAAQ;YAC3B,OAAO;gBAAE,IAAI;gBAAO;gBAAM;YAAQ;QACpC;QAEA,MAAM,oBAAoB,MAAM,aAAa,MAAM,eAAe,MAAM;QACxE,IAAI,CAAC,mBAAmB;YACtB,OAAO;gBAAE,IAAI;gBAAO,MAAM;gBAAgB,SAAS;YAA6B;QAClF;QAEA,OAAO;YACL,IAAI;YACJ;YACA,SAAS,MAAM,WAAW;QAC5B;IACF,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,IAAI;YAAO,MAAM;YAAiB,SAAS,OAAO;QAAK;IAClE;AACF","debugId":null}},
    {"offset": {"line": 986, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/airtime-subandgain.ts"],"sourcesContent":["import { type AirtimeRequest, type AirtimeResponse } from \"@/lib/providers/airtime\"\r\nimport { type ProviderConfig } from \"@/lib/provider-manager\"\r\nimport { fetchJsonWithRetry } from \"@/lib/http-client\"\r\n\r\n// Normalize common Nigerian network names to SubAndGain-expected values\r\nfunction normalizeNetwork(input: string): string {\r\n  const n = input.trim().toUpperCase()\r\n  if (!n) return n\r\n  if (n === \"ETISALAT\") return \"9MOBILE\"\r\n  if (n === \"9 MOBILE\" || n === \"9-MOBILE\") return \"9MOBILE\"\r\n  if (n === \"AIRTEL NG\") return \"AIRTEL\"\r\n  return n\r\n}\r\n\r\n/**\r\n * Real Airtime VTU adapter for SubAndGain providers.\r\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\r\n *\r\n * SubAndGain docs: https://subandgain.com/APIAirtime.php (pattern similar to data/bills)\r\n * Endpoint (typical): GET https://subandgain.com/api/airtime.php?username=...&apiKey=...&network=...&amount=...&phoneNumber=...\r\n */\r\nexport async function sendAirtimeViaSubAndGain(\r\n  req: AirtimeRequest,\r\n  provider?: ProviderConfig,\r\n): Promise<AirtimeResponse> {\r\n  const apiBase = provider?.apiBaseUrl || process.env.SUBANDGAIN_BASE_URL || \"https://subandgain.com\"\r\n\r\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\r\n    process.env.SUBANDGAIN_API_KEY || \"\"\r\n  const username = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"username\")?.keyValue ||\r\n    process.env.SUBANDGAIN_USERNAME || \"\"\r\n\r\n  if (!apiBase || !apiKey || !username) {\r\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL, username, or API key\" }\r\n  }\r\n\r\n  const phoneNumber = String((req.params as any)?.phone || (req.params as any)?.phoneNumber || \"\").trim()\r\n  const rawNetwork = String(req.params?.network || \"\")\r\n  const normalizedNetwork = normalizeNetwork(rawNetwork)\r\n\r\n  if (!phoneNumber || !normalizedNetwork || !(req.amount > 0)) {\r\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing phone, network, or amount\" }\r\n  }\r\n\r\n  const validNetworks = [\"MTN\", \"GLO\", \"AIRTEL\", \"9MOBILE\"]\r\n  if (!validNetworks.includes(normalizedNetwork)) {\r\n    return { ok: false, code: \"INVALID_NETWORK\", message: `Unsupported network: ${rawNetwork}` }\r\n  }\r\n\r\n  try {\r\n    const network = normalizedNetwork\r\n    \r\n    // Ensure amount is an integer Naira value\r\n    const amount = Math.round(Number(req.amount))\r\n\r\n    const airtimePath = \"/api/airtime.php\"\r\n    const url = `${apiBase}${airtimePath}?username=${encodeURIComponent(username)}&apiKey=${encodeURIComponent(apiKey)}&network=${encodeURIComponent(network)}&amount=${encodeURIComponent(String(amount))}&phoneNumber=${encodeURIComponent(phoneNumber)}`\r\n\r\n    const { res, data } = await fetchJsonWithRetry(url, { method: \"GET\" }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\r\n\r\n    // Robust provider error detection: treat \"0\" or 0 as success\r\n    const rawErr = (data as any)?.error\r\n    const errStr = typeof rawErr === \"string\" ? rawErr.trim().toLowerCase() : rawErr\r\n    const looksSuccessText = String((data as any)?.api_response || (data as any)?.message || \"\").toLowerCase()\r\n    const isProviderError = !res.ok || (\r\n      rawErr != null &&\r\n      errStr !== 0 && errStr !== \"0\" && errStr !== \"\" && errStr !== \"ok\" && errStr !== \"success\" && !/success/.test(looksSuccessText)\r\n    )\r\n\r\n    if (isProviderError) {\r\n      const errorCode = (data as any)?.error || \"PROVIDER_ERROR\"\r\n      const message = (data as any)?.description || (data as any)?.message || (data as any)?.api_response || `Provider error (${res.status})`\r\n      switch (errorCode) {\r\n        case \"ERR200\":\r\n          return { ok: false, code: \"INVALID_USERNAME\", message: \"Username field is empty\" }\r\n        case \"ERR201\":\r\n          return { ok: false, code: \"INVALID_CREDENTIALS\", message: \"Invalid username or API key\" }\r\n        case \"ERR202\":\r\n          return { ok: false, code: \"INVALID_PHONE\", message: \"Invalid recipient phone number\" }\r\n        case \"ERR203\":\r\n          return { ok: false, code: \"INSUFFICIENT_BALANCE\", message: \"Insufficient balance to complete transaction\" }\r\n        case \"ERR204\":\r\n          return { ok: false, code: \"INVALID_NETWORK\", message: \"Invalid network provider specified\" }\r\n        case \"ERR206\":\r\n          return { ok: false, code: \"TRANSACTION_FAILED\", message: \"Order could not be processed. Please try again later\" }\r\n        default:\r\n          return { ok: false, code: String(errorCode), message }\r\n      }\r\n    }\r\n\r\n    const providerReference = (data as any)?.trans_id || (data as any)?.reference || (data as any)?.transactionId || (data as any)?.transaction_id\r\n    if (!providerReference) {\r\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\r\n    }\r\n\r\n    return {\r\n      ok: true,\r\n      providerReference,\r\n      message: (data as any)?.api_response || (data as any)?.message || \"Airtime delivered\",\r\n    }\r\n  } catch (err) {\r\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1126, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/data-ported.ts"],"sourcesContent":["import { type DataRequest, type DataResponse } from \"@/lib/providers/data\"\nimport { type ProviderConfig } from \"@/lib/provider-manager\"\nimport { fetchJsonWithRetry, buildAuthHeaders } from \"@/lib/http-client\"\n\n/**\n * Real Data Bundle adapter for PortedSIM-like providers.\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\n *\n * Expected provider config:\n * - apiBaseUrl: string (e.g., https://api.portedsim.com)\n * - apiKeys: [{ keyName: \"apiKey\", keyValue: \"...\" }]\n * - configJson may include { adapter: \"ported\", endpoints: { bundle: \"/data/bundle\" } }\n */\nexport async function sendDataBundleViaPorted(\n  req: DataRequest,\n  provider?: ProviderConfig,\n): Promise<DataResponse> {\n  const apiBase = provider?.apiBaseUrl || process.env.PORTEDSIM_BASE_URL || \"\"\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\n    process.env.PORTEDSIM_API_KEY || \"\"\n\n  const bundlePath = (provider?.configJson as any)?.endpoints?.bundle || \"/data/bundle\"\n  const url = `${apiBase}${bundlePath}`\n\n  if (!apiBase || !apiKey) {\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL or API key\" }\n  }\n\n  if (!req.params?.phone || !req.params?.network || !req.params?.planCode) {\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing phone, network, or planCode\" }\n  }\n\n  try {\n    const payload = {\n      phone: req.params.phone,\n      network: req.params.network,\n      planCode: req.params.planCode,\n      amount: req.amount,\n      subServiceId: req.subServiceId,\n    }\n\n    const { res, data } = await fetchJsonWithRetry(url, {\n      method: \"POST\",\n      headers: buildAuthHeaders(apiKey),\n      body: JSON.stringify(payload),\n    }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\n\n    if (!res.ok) {\n      const message = data?.message || data?.error || `Provider error (${res.status})`\n      const code = data?.code || \"PROVIDER_ERROR\"\n      return { ok: false, code, message }\n    }\n\n    const providerReference = data?.reference || data?.providerRef || data?.transactionId\n\n    if (!providerReference) {\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\n    }\n\n    return {\n      ok: true,\n      providerReference,\n      message: data?.message || \"Data bundle activated\",\n    }\n  } catch (err) {\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\n  }\n}"],"names":[],"mappings":";;;;AAEA;;AAWO,eAAe,wBACpB,GAAgB,EAChB,QAAyB;IAEzB,MAAM,UAAU,UAAU,cAAc,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAC1E,MAAM,SAAS,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,WAAW,YAC1F,QAAQ,GAAG,CAAC,iBAAiB,IAAI;IAEnC,MAAM,aAAa,AAAC,UAAU,YAAoB,WAAW,UAAU;IACvE,MAAM,MAAM,GAAG,UAAU,YAAY;IAErC,IAAI,CAAC,WAAW,CAAC,QAAQ;QACvB,OAAO;YAAE,IAAI;YAAO,MAAM;YAAkB,SAAS;QAAuC;IAC9F;IAEA,IAAI,CAAC,IAAI,MAAM,EAAE,SAAS,CAAC,IAAI,MAAM,EAAE,WAAW,CAAC,IAAI,MAAM,EAAE,UAAU;QACvE,OAAO;YAAE,IAAI;YAAO,MAAM;YAAa,SAAS;QAAsC;IACxF;IAEA,IAAI;QACF,MAAM,UAAU;YACd,OAAO,IAAI,MAAM,CAAC,KAAK;YACvB,SAAS,IAAI,MAAM,CAAC,OAAO;YAC3B,UAAU,IAAI,MAAM,CAAC,QAAQ;YAC7B,QAAQ,IAAI,MAAM;YAClB,cAAc,IAAI,YAAY;QAChC;QAEA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,6IAAkB,EAAC,KAAK;YAClD,QAAQ;YACR,SAAS,IAAA,2IAAgB,EAAC;YAC1B,MAAM,KAAK,SAAS,CAAC;QACvB,GAAG;YAAE,SAAS;YAAG,aAAa;YAAK,WAAW;QAAM;QAEpD,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,UAAU,MAAM,WAAW,MAAM,SAAS,CAAC,gBAAgB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YAChF,MAAM,OAAO,MAAM,QAAQ;YAC3B,OAAO;gBAAE,IAAI;gBAAO;gBAAM;YAAQ;QACpC;QAEA,MAAM,oBAAoB,MAAM,aAAa,MAAM,eAAe,MAAM;QAExE,IAAI,CAAC,mBAAmB;YACtB,OAAO;gBAAE,IAAI;gBAAO,MAAM;gBAAgB,SAAS;YAA6B;QAClF;QAEA,OAAO;YACL,IAAI;YACJ;YACA,SAAS,MAAM,WAAW;QAC5B;IACF,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,IAAI;YAAO,MAAM;YAAiB,SAAS,OAAO;QAAK;IAClE;AACF","debugId":null}},
    {"offset": {"line": 1202, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/data-subandgain.ts"],"sourcesContent":["import { type DataRequest, type DataResponse } from \"@/lib/providers/data\"\nimport { type ProviderConfig } from \"@/lib/provider-manager\"\nimport { fetchJsonWithRetry } from \"@/lib/http-client\"\n\n// Normalize common Nigerian network names to SubAndGain-expected values\nfunction normalizeNetwork(input: string): string {\n  const n = input.trim().toUpperCase()\n  if (!n) return n\n  if (n === \"ETISALAT\") return \"9MOBILE\"\n  if (n === \"9 MOBILE\" || n === \"9-MOBILE\") return \"9MOBILE\"\n  if (n === \"AIRTEL NG\") return \"AIRTEL\"\n  return n\n}\n\n/**\n * Real Data Bundle adapter for SubAndGain providers.\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\n *\n * Docs: https://subandgain.com/APIBuyData.php\n * Endpoint: GET https://subandgain.com/api/data.php?username=...&apiKey=...&network=...&dataPlan=...&phoneNumber=...\n */\nexport async function sendDataBundleViaSubAndGain(\n  req: DataRequest,\n  provider?: ProviderConfig,\n): Promise<DataResponse> {\n  const apiBase = provider?.apiBaseUrl || process.env.SUBANDGAIN_BASE_URL || \"https://subandgain.com\"\n\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\n    process.env.SUBANDGAIN_API_KEY || \"\"\n  const username = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"username\")?.keyValue ||\n    process.env.SUBANDGAIN_USERNAME || \"\"\n\n  if (!apiBase || !apiKey || !username) {\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL, username, or API key\" }\n  }\n\n  const phoneNumber = String((req.params as any)?.phone || (req.params as any)?.phoneNumber || \"\").trim()\n  const rawNetwork = String(req.params?.network || \"\")\n  const normalizedNetwork = normalizeNetwork(rawNetwork)\n  const planCode = String((req.params as any)?.planCode || (req.params as any)?.plan || (req.params as any)?.dataPlan || \"\").trim()\n\n  if (!phoneNumber || !normalizedNetwork || !planCode) {\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing phone, network, or planCode\" }\n  }\n\n  const validNetworks = [\"MTN\", \"GLO\", \"AIRTEL\", \"9MOBILE\"]\n  if (!validNetworks.includes(normalizedNetwork)) {\n    return { ok: false, code: \"INVALID_NETWORK\", message: `Unsupported network: ${rawNetwork}` }\n  }\n\n  try {\n    const network = normalizedNetwork\n    const dataPlan = planCode\n\n    const dataPath = \"/api/data.php\"\n    const url = `${apiBase}${dataPath}?username=${encodeURIComponent(username)}&apiKey=${encodeURIComponent(apiKey)}&network=${encodeURIComponent(network)}&dataPlan=${encodeURIComponent(dataPlan)}&phoneNumber=${encodeURIComponent(phoneNumber)}`\n\n    const { res, data } = await fetchJsonWithRetry(url, { method: \"GET\" }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\n\n    if (!res.ok || data?.error) {\n      const errorCode = data?.error || \"PROVIDER_ERROR\";\n      let message = data?.description || data?.message || data?.error || `Provider error (${res.status})`;\n      \n      // Map SubAndGain specific error codes to user-friendly messages\n      switch (errorCode) {\n        case \"ERR200\":\n          return { ok: false, code: \"INVALID_USERNAME\", message: \"Username field is empty\" };\n        case \"ERR201\":\n          return { ok: false, code: \"INVALID_CREDENTIALS\", message: \"Invalid username or API key\" };\n        case \"ERR202\":\n          return { ok: false, code: \"INVALID_PHONE\", message: \"Invalid recipient phone number\" };\n        case \"ERR203\":\n          return { ok: false, code: \"INSUFFICIENT_BALANCE\", message: \"Insufficient balance to complete transaction\" };\n        case \"ERR204\":\n          return { ok: false, code: \"INVALID_NETWORK\", message: \"Invalid network provider specified\" };\n        case \"ERR206\":\n          return { ok: false, code: \"TRANSACTION_FAILED\", message: \"Order could not be processed. Please try again later\" };\n        case \"ERR207\":\n          return { ok: false, code: \"INVALID_PLAN\", message: \"Invalid data plan selected\" };\n        default:\n          return { ok: false, code: errorCode, message };\n      }\n    }\n\n    const providerReference = data?.trans_id || data?.reference || data?.transactionId\n    if (!providerReference) {\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\n    }\n\n    return {\n      ok: true,\n      providerReference,\n      message: data?.api_response || data?.message || \"Data bundle activated\",\n    }\n  } catch (err) {\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1344, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/bills-subandgain.ts"],"sourcesContent":["import { type BillsRequest, type BillsResponse } from \"@/lib/providers/bills\"\nimport { type ProviderConfig } from \"@/lib/provider-manager\"\nimport { fetchJsonWithRetry, buildAuthHeaders } from \"@/lib/http-client\"\n\n/**\n * Real Bills/Electricity adapter for SubAndGain provider.\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\n *\n * Expected provider config:\n * - apiBaseUrl: string (e.g., https://subandgain.com)\n * - apiKeys: [{ keyName: \"apiKey\", keyValue: \"...\" }]\n * - configJson may include { adapter: \"subandgain\", endpoints: { purchase: \"/electricity/purchase\" } }\n */\nexport async function payBillViaSubAndGain(\n  req: BillsRequest,\n  provider?: ProviderConfig,\n): Promise<BillsResponse> {\n  const apiBase = provider?.apiBaseUrl || process.env.SUBANDGAIN_BASE_URL || \"https://subandgain.com\"\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\n    process.env.SUBANDGAIN_API_KEY || \"\"\n\n  const purchasePath = (provider?.configJson as any)?.endpoints?.purchase || \"/electricity/purchase\"\n  const url = `${apiBase}${purchasePath}`\n\n  if (!apiBase || !apiKey) {\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL or API key\" }\n  }\n\n  // Basic validation mirroring the mock adapter\n  if (!req.params?.meterNumber || !req.params?.serviceProvider) {\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing meter number or service provider\" }\n  }\n\n  try {\n    const payload = {\n      meterNumber: req.params.meterNumber,\n      disco: req.params.serviceProvider, // provider code/name per upstream API\n      amount: req.amount,\n      // Additional optional fields\n      customerName: req.params.customerName,\n      customerAddress: req.params.customerAddress,\n      // Pass through subServiceId if upstream supports variants\n      subServiceId: req.subServiceId,\n    }\n\n    const { res, data } = await fetchJsonWithRetry(url, {\n      method: \"POST\",\n      headers: buildAuthHeaders(apiKey),\n      body: JSON.stringify(payload),\n    }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\n\n    if (!res.ok) {\n      const errorCode = data?.error || \"PROVIDER_ERROR\";\n      let message = data?.message || data?.error || `Provider error (${res.status})`;\n      \n      // Map SubAndGain specific error codes to user-friendly messages\n      switch (errorCode) {\n        case \"ERR200\":\n          return { ok: false, code: \"INVALID_USERNAME\", message: \"Username field is empty\" };\n        case \"ERR201\":\n          return { ok: false, code: \"INVALID_CREDENTIALS\", message: \"Invalid username or API key\" };\n        case \"ERR203\":\n          return { ok: false, code: \"INSUFFICIENT_BALANCE\", message: \"Insufficient balance to complete transaction\" };\n        case \"ERR206\":\n          return { ok: false, code: \"TRANSACTION_FAILED\", message: \"Order could not be processed. Please try again later\" };\n        case \"ERR208\":\n          return { ok: false, code: \"INVALID_METER\", message: \"Invalid meter number provided\" };\n        case \"ERR209\":\n          return { ok: false, code: \"INVALID_DISCO\", message: \"Invalid electricity provider specified\" };\n        case \"ERR210\":\n          return { ok: false, code: \"INVALID_AMOUNT\", message: \"Invalid amount specified\" };\n        default:\n          return { ok: false, code: errorCode || data?.code || \"PROVIDER_ERROR\", message };\n      }\n    }\n\n    // Map common fields from provider response\n    const providerReference = data?.reference || data?.providerRef || data?.transactionId\n    const token = data?.token || data?.tokenUnits || data?.unitsToken\n    const units = data?.units || (data?.energyUnits ? `${data.energyUnits} kWh` : undefined)\n\n    if (!providerReference) {\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\n    }\n\n    return {\n      ok: true,\n      providerReference,\n      token,\n      units,\n      message: data?.message || \"Electricity purchase successful\",\n    }\n  } catch (err) {\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\n  }\n}"],"names":[],"mappings":";;;;AAEA;;AAWO,eAAe,qBACpB,GAAiB,EACjB,QAAyB;IAEzB,MAAM,UAAU,UAAU,cAAc,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAC3E,MAAM,SAAS,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,WAAW,YAC1F,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAEpC,MAAM,eAAe,AAAC,UAAU,YAAoB,WAAW,YAAY;IAC3E,MAAM,MAAM,GAAG,UAAU,cAAc;IAEvC,IAAI,CAAC,WAAW,CAAC,QAAQ;QACvB,OAAO;YAAE,IAAI;YAAO,MAAM;YAAkB,SAAS;QAAuC;IAC9F;IAEA,8CAA8C;IAC9C,IAAI,CAAC,IAAI,MAAM,EAAE,eAAe,CAAC,IAAI,MAAM,EAAE,iBAAiB;QAC5D,OAAO;YAAE,IAAI;YAAO,MAAM;YAAa,SAAS;QAA2C;IAC7F;IAEA,IAAI;QACF,MAAM,UAAU;YACd,aAAa,IAAI,MAAM,CAAC,WAAW;YACnC,OAAO,IAAI,MAAM,CAAC,eAAe;YACjC,QAAQ,IAAI,MAAM;YAClB,6BAA6B;YAC7B,cAAc,IAAI,MAAM,CAAC,YAAY;YACrC,iBAAiB,IAAI,MAAM,CAAC,eAAe;YAC3C,0DAA0D;YAC1D,cAAc,IAAI,YAAY;QAChC;QAEA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,6IAAkB,EAAC,KAAK;YAClD,QAAQ;YACR,SAAS,IAAA,2IAAgB,EAAC;YAC1B,MAAM,KAAK,SAAS,CAAC;QACvB,GAAG;YAAE,SAAS;YAAG,aAAa;YAAK,WAAW;QAAM;QAEpD,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,YAAY,MAAM,SAAS;YACjC,IAAI,UAAU,MAAM,WAAW,MAAM,SAAS,CAAC,gBAAgB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YAE9E,gEAAgE;YAChE,OAAQ;gBACN,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAoB,SAAS;oBAA0B;gBACnF,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAuB,SAAS;oBAA8B;gBAC1F,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAwB,SAAS;oBAA+C;gBAC5G,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAsB,SAAS;oBAAuD;gBAClH,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAiB,SAAS;oBAAgC;gBACtF,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAiB,SAAS;oBAAyC;gBAC/F,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAkB,SAAS;oBAA2B;gBAClF;oBACE,OAAO;wBAAE,IAAI;wBAAO,MAAM,aAAa,MAAM,QAAQ;wBAAkB;oBAAQ;YACnF;QACF;QAEA,2CAA2C;QAC3C,MAAM,oBAAoB,MAAM,aAAa,MAAM,eAAe,MAAM;QACxE,MAAM,QAAQ,MAAM,SAAS,MAAM,cAAc,MAAM;QACvD,MAAM,QAAQ,MAAM,SAAS,CAAC,MAAM,cAAc,GAAG,KAAK,WAAW,CAAC,IAAI,CAAC,GAAG,SAAS;QAEvF,IAAI,CAAC,mBAAmB;YACtB,OAAO;gBAAE,IAAI;gBAAO,MAAM;gBAAgB,SAAS;YAA6B;QAClF;QAEA,OAAO;YACL,IAAI;YACJ;YACA;YACA;YACA,SAAS,MAAM,WAAW;QAC5B;IACF,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,IAAI;YAAO,MAAM;YAAiB,SAAS,OAAO;QAAK;IAClE;AACF","debugId":null}},
    {"offset": {"line": 1475, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/education-subandgain.ts"],"sourcesContent":["import { type ProviderConfig } from \"@/lib/provider-manager\"\nimport { fetchJsonWithRetry } from \"@/lib/http-client\"\n\nexport type EducationParams = {\n  eduType: string // e.g. NEONE, WAEONE, etc (see docs)\n}\n\nexport type EducationRequest = {\n  amount: number\n  params: EducationParams\n  providerId: string\n  subServiceId?: string\n}\n\nexport type EducationResponse = {\n  ok: boolean\n  providerReference?: string\n  token?: string\n  code?: string\n  message?: string\n}\n\n/**\n * Real Education Bills adapter for SubAndGain providers.\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\n *\n * Docs: https://subandgain.com/APIEducation.php\n * Endpoint: GET https://subandgain.com/api/education.php?username=...&apiKey=...&eduType=...\n */\nexport async function payEducationViaSubAndGain(\n  req: EducationRequest,\n  provider?: ProviderConfig,\n): Promise<EducationResponse> {\n  const apiBase = provider?.apiBaseUrl || process.env.SUBANDGAIN_BASE_URL || \"https://subandgain.com\"\n\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\n    process.env.SUBANDGAIN_API_KEY || \"\"\n  const username = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"username\")?.keyValue ||\n    process.env.SUBANDGAIN_USERNAME || \"\"\n\n  if (!apiBase || !apiKey || !username) {\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL, username, or API key\" }\n  }\n\n  if (!req.params?.eduType) {\n    return { ok: false, code: \"BAD_INPUT\", message: \"Missing eduType\" }\n  }\n\n  try {\n    const eduType = String(req.params.eduType).toUpperCase()\n\n    const eduPath = \"/api/education.php\"\n    const url = `${apiBase}${eduPath}?username=${encodeURIComponent(username)}&apiKey=${encodeURIComponent(apiKey)}&eduType=${encodeURIComponent(eduType)}`\n\n    const { res, data } = await fetchJsonWithRetry(url, { method: \"GET\" }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\n\n    if (!res.ok || data?.error) {\n      const errorCode = data?.error || \"PROVIDER_ERROR\";\n      let message = data?.description || data?.message || data?.error || `Provider error (${res.status})`;\n      \n      // Map SubAndGain specific error codes to user-friendly messages\n      switch (errorCode) {\n        case \"ERR200\":\n          return { ok: false, code: \"INVALID_USERNAME\", message: \"Username field is empty\" };\n        case \"ERR201\":\n          return { ok: false, code: \"INVALID_CREDENTIALS\", message: \"Invalid username or API key\" };\n        case \"ERR203\":\n          return { ok: false, code: \"INSUFFICIENT_BALANCE\", message: \"Insufficient balance to complete transaction\" };\n        case \"ERR206\":\n          return { ok: false, code: \"TRANSACTION_FAILED\", message: \"Order could not be processed. Please try again later\" };\n        case \"ERR207\":\n          return { ok: false, code: \"INVALID_EDU_TYPE\", message: \"Invalid education type specified\" };\n        default:\n          return { ok: false, code: errorCode, message };\n      }\n    }\n\n    const providerReference = data?.trans_id || data?.reference || data?.transactionId\n    const token = data?.token\n    if (!providerReference) {\n      return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\n    }\n\n    return {\n      ok: true,\n      providerReference,\n      token,\n      message: data?.message || \"Education token purchase successful\",\n    }\n  } catch (err) {\n    return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\n  }\n}"],"names":[],"mappings":";;;;AACA;;AA4BO,eAAe,0BACpB,GAAqB,EACrB,QAAyB;IAEzB,MAAM,UAAU,UAAU,cAAc,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAE3E,MAAM,SAAS,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,WAAW,YAC1F,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACpC,MAAM,WAAW,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,aAAa,YAC9F,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAErC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,UAAU;QACpC,OAAO;YAAE,IAAI;YAAO,MAAM;YAAkB,SAAS;QAAkD;IACzG;IAEA,IAAI,CAAC,IAAI,MAAM,EAAE,SAAS;QACxB,OAAO;YAAE,IAAI;YAAO,MAAM;YAAa,SAAS;QAAkB;IACpE;IAEA,IAAI;QACF,MAAM,UAAU,OAAO,IAAI,MAAM,CAAC,OAAO,EAAE,WAAW;QAEtD,MAAM,UAAU;QAChB,MAAM,MAAM,GAAG,UAAU,QAAQ,UAAU,EAAE,mBAAmB,UAAU,QAAQ,EAAE,mBAAmB,QAAQ,SAAS,EAAE,mBAAmB,UAAU;QAEvJ,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,6IAAkB,EAAC,KAAK;YAAE,QAAQ;QAAM,GAAG;YAAE,SAAS;YAAG,aAAa;YAAK,WAAW;QAAM;QAExH,IAAI,CAAC,IAAI,EAAE,IAAI,MAAM,OAAO;YAC1B,MAAM,YAAY,MAAM,SAAS;YACjC,IAAI,UAAU,MAAM,eAAe,MAAM,WAAW,MAAM,SAAS,CAAC,gBAAgB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YAEnG,gEAAgE;YAChE,OAAQ;gBACN,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAoB,SAAS;oBAA0B;gBACnF,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAuB,SAAS;oBAA8B;gBAC1F,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAwB,SAAS;oBAA+C;gBAC5G,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAsB,SAAS;oBAAuD;gBAClH,KAAK;oBACH,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAoB,SAAS;oBAAmC;gBAC5F;oBACE,OAAO;wBAAE,IAAI;wBAAO,MAAM;wBAAW;oBAAQ;YACjD;QACF;QAEA,MAAM,oBAAoB,MAAM,YAAY,MAAM,aAAa,MAAM;QACrE,MAAM,QAAQ,MAAM;QACpB,IAAI,CAAC,mBAAmB;YACtB,OAAO;gBAAE,IAAI;gBAAO,MAAM;gBAAgB,SAAS;YAA6B;QAClF;QAEA,OAAO;YACL,IAAI;YACJ;YACA;YACA,SAAS,MAAM,WAAW;QAC5B;IACF,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,IAAI;YAAO,MAAM;YAAiB,SAAS,OAAO;QAAK;IAClE;AACF","debugId":null}},
    {"offset": {"line": 1580, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/cable-subandgain.ts"],"sourcesContent":["import { type ProviderConfig } from \"@/lib/provider-manager\"\r\nimport { fetchJsonWithRetry, buildAuthHeaders } from \"@/lib/http-client\"\r\n\r\nexport type CableRequest = {\r\n    amount: number\r\n    params: {\r\n        smartcardNumber: string\r\n        provider: string\r\n        planId: string\r\n        customerName?: string\r\n    }\r\n    providerId: string\r\n    subServiceId?: string\r\n}\r\n\r\nexport type CableResponse = {\r\n    ok: boolean\r\n    providerReference?: string\r\n    code?: string\r\n    message?: string\r\n}\r\n\r\n/**\r\n * Real Cable TV adapter for SubAndGain provider.\r\n */\r\nexport async function payCableViaSubAndGain(\r\n    req: CableRequest,\r\n    provider?: ProviderConfig,\r\n): Promise<CableResponse> {\r\n    const apiBase = provider?.apiBaseUrl || process.env.SUBANDGAIN_BASE_URL || \"https://subandgain.com\"\r\n    const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"apikey\")?.keyValue ||\r\n        process.env.SUBANDGAIN_API_KEY || \"\"\r\n\r\n    const purchasePath = (provider?.configJson as any)?.endpoints?.cable || \"/cable/purchase\"\r\n    const url = `${apiBase}${purchasePath}`\r\n\r\n    if (!apiBase || !apiKey) {\r\n        return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL or API key\" }\r\n    }\r\n\r\n    if (!req.params?.smartcardNumber || !req.params?.provider || !req.params?.planId) {\r\n        return { ok: false, code: \"BAD_INPUT\", message: \"Missing smartcard number, provider, or plan ID\" }\r\n    }\r\n\r\n    try {\r\n        const payload = {\r\n            smartcardNumber: req.params.smartcardNumber,\r\n            provider: req.params.provider,\r\n            plan: req.params.planId,\r\n            amount: req.amount,\r\n            customerName: req.params.customerName,\r\n        }\r\n\r\n        const { res, data } = await fetchJsonWithRetry(url, {\r\n            method: \"POST\",\r\n            headers: buildAuthHeaders(apiKey),\r\n            body: JSON.stringify(payload),\r\n        }, { retries: 3, baseDelayMs: 400, timeoutMs: 10000 })\r\n\r\n        if (!res.ok) {\r\n            const errorCode = data?.error || \"PROVIDER_ERROR\";\r\n            const message = data?.message || data?.error || `Provider error (${res.status})`;\r\n            return { ok: false, code: errorCode || data?.code || \"PROVIDER_ERROR\", message };\r\n        }\r\n\r\n        const providerReference = data?.reference || data?.providerRef || data?.transactionId\r\n        if (!providerReference) {\r\n            return { ok: false, code: \"NO_REFERENCE\", message: \"Missing provider reference\" }\r\n        }\r\n\r\n        return {\r\n            ok: true,\r\n            providerReference,\r\n            message: data?.message || \"Cable subscription successful\",\r\n        }\r\n    } catch (err) {\r\n        return { ok: false, code: \"NETWORK_ERROR\", message: String(err) }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAwBO,eAAe,sBAClB,GAAiB,EACjB,QAAyB;IAEzB,MAAM,UAAU,UAAU,cAAc,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAC3E,MAAM,SAAS,CAAC,UAAU,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,CAAC,WAAW,OAAO,WAAW,YACxF,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAEtC,MAAM,eAAe,AAAC,UAAU,YAAoB,WAAW,SAAS;IACxE,MAAM,MAAM,GAAG,UAAU,cAAc;IAEvC,IAAI,CAAC,WAAW,CAAC,QAAQ;QACrB,OAAO;YAAE,IAAI;YAAO,MAAM;YAAkB,SAAS;QAAuC;IAChG;IAEA,IAAI,CAAC,IAAI,MAAM,EAAE,mBAAmB,CAAC,IAAI,MAAM,EAAE,YAAY,CAAC,IAAI,MAAM,EAAE,QAAQ;QAC9E,OAAO;YAAE,IAAI;YAAO,MAAM;YAAa,SAAS;QAAiD;IACrG;IAEA,IAAI;QACA,MAAM,UAAU;YACZ,iBAAiB,IAAI,MAAM,CAAC,eAAe;YAC3C,UAAU,IAAI,MAAM,CAAC,QAAQ;YAC7B,MAAM,IAAI,MAAM,CAAC,MAAM;YACvB,QAAQ,IAAI,MAAM;YAClB,cAAc,IAAI,MAAM,CAAC,YAAY;QACzC;QAEA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,6IAAkB,EAAC,KAAK;YAChD,QAAQ;YACR,SAAS,IAAA,2IAAgB,EAAC;YAC1B,MAAM,KAAK,SAAS,CAAC;QACzB,GAAG;YAAE,SAAS;YAAG,aAAa;YAAK,WAAW;QAAM;QAEpD,IAAI,CAAC,IAAI,EAAE,EAAE;YACT,MAAM,YAAY,MAAM,SAAS;YACjC,MAAM,UAAU,MAAM,WAAW,MAAM,SAAS,CAAC,gBAAgB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YAChF,OAAO;gBAAE,IAAI;gBAAO,MAAM,aAAa,MAAM,QAAQ;gBAAkB;YAAQ;QACnF;QAEA,MAAM,oBAAoB,MAAM,aAAa,MAAM,eAAe,MAAM;QACxE,IAAI,CAAC,mBAAmB;YACpB,OAAO;gBAAE,IAAI;gBAAO,MAAM;gBAAgB,SAAS;YAA6B;QACpF;QAEA,OAAO;YACH,IAAI;YACJ;YACA,SAAS,MAAM,WAAW;QAC9B;IACJ,EAAE,OAAO,KAAK;QACV,OAAO;YAAE,IAAI;YAAO,MAAM;YAAiB,SAAS,OAAO;QAAK;IACpE;AACJ","debugId":null}},
    {"offset": {"line": 1656, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/providers/verification-prembly.ts"],"sourcesContent":["import { type ProviderConfig } from \"@/lib/provider-manager\"\r\nimport { fetchJsonWithRetry, buildAuthHeaders } from \"@/lib/http-client\"\r\n\r\nexport interface NINVerificationRequest {\r\n  nin: string\r\n  phone?: string\r\n  firstName?: string\r\n  lastName?: string\r\n  dateOfBirth?: string\r\n  gender?: string\r\n}\r\n\r\nexport interface NINVerificationResponse {\r\n  ok: boolean\r\n  code?: string\r\n  message?: string\r\n  data?: {\r\n    nin: string\r\n    firstName: string\r\n    lastName: string\r\n    middleName?: string\r\n    dateOfBirth: string\r\n    gender: string\r\n    phone: string\r\n    address: string\r\n    photo?: string\r\n    trackingId?: string\r\n    issueDate?: string\r\n    signature?: string\r\n    stateOfOrigin?: string\r\n    lga?: string\r\n    maritalStatus?: string\r\n    profession?: string\r\n    religion?: string\r\n    bloodGroup?: string\r\n    height?: string\r\n    nextOfKin?: string\r\n    nextOfKinPhone?: string\r\n    nextOfKinAddress?: string\r\n  }\r\n  reference?: string\r\n  transactionId?: string\r\n}\r\n\r\n/**\r\n * Real NIN Verification adapter for Prembly API.\r\n * Uses provider configuration (base URL + API keys) or environment fallbacks.\r\n *\r\n * Expected provider config:\r\n * - apiBaseUrl: string (e.g., https://api.prembly.com)\r\n * - apiKeys: [{ keyName: \"api_key\" }, { keyName: \"app_id\" }]\r\n * - configJson may include { adapter: \"prembly\", endpoints: { nin: \"/verification/nin/advanced\" } }\r\n */\r\nexport async function verifyNINViaPrembly(\r\n  req: NINVerificationRequest,\r\n  provider?: ProviderConfig,\r\n): Promise<NINVerificationResponse> {\r\n  const apiBase = provider?.apiBaseUrl || process.env.PREMBLY_BASE_URL || \"https://api.prembly.com\"\r\n  const apiKey = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"api_key\")?.keyValue ||\r\n    process.env.PREMBLY_API_KEY || \"\"\r\n  const appId = (provider?.apiKeys || []).find((k) => k.keyName.toLowerCase() === \"app_id\")?.keyValue ||\r\n    process.env.PREMBLY_APP_ID || \"\"\r\n\r\n  // Primary endpoint from provider config or default (use advanced by default)\r\n  const configuredPath = (provider?.configJson as any)?.endpoints?.nin || \"/verification/nin/advanced\"\r\n\r\n  // Known fallbacks for Prembly API variations. We try these if we get a 404 from the primary.\r\n  const candidatePaths = [\r\n    configuredPath,\r\n    \"/verification/nin/advanced\",\r\n    \"/verification/nin/printout\",\r\n    \"/verification/nin\",\r\n    \"/v1/verifications/identity/nin/advanced\", // legacy variants we still try\r\n    \"/v1/verifications/identity/nin/printout\",\r\n    \"/v1/verifications/identity/nin\",\r\n    \"/v1/verifications/identities/nin/printout\",\r\n  ]\r\n\r\n  if (!apiBase || !apiKey || !appId) {\r\n    return { ok: false, code: \"MISSING_CONFIG\", message: \"Missing provider base URL, API key, or app id\" }\r\n  }\r\n\r\n  if (!req.nin || req.nin.length !== 11) {\r\n    return { ok: false, code: \"BAD_INPUT\", message: \"Invalid NIN format. NIN must be 11 digits\" }\r\n  }\r\n\r\n  const payload = {\r\n    nin: req.nin,\r\n    phone: req.phone,\r\n    firstName: req.firstName,\r\n    lastName: req.lastName,\r\n    dateOfBirth: req.dateOfBirth,\r\n    gender: req.gender,\r\n  }\r\n\r\n  let lastError: NINVerificationResponse | null = null\r\n\r\n  for (const path of candidatePaths) {\r\n    const url = `${apiBase}${path}`\r\n    try {\r\n      const { res, data } = await fetchJsonWithRetry(url, {\r\n        method: \"POST\",\r\n        headers: buildAuthHeaders(apiKey, { Accept: \"application/json\", \"app-id\": appId }),\r\n        body: JSON.stringify(payload),\r\n      }, { retries: 2, baseDelayMs: 400, timeoutMs: 12000 })\r\n\r\n      if (!res.ok) {\r\n        const message = data?.message || data?.error || res.statusText || \"Unknown error\"\r\n        const errResp: NINVerificationResponse = {\r\n          ok: false,\r\n          code: `HTTP_${res.status}`,\r\n          message: `Prembly API error: ${res.status} ${message} (endpoint: ${path})`,\r\n        }\r\n\r\n        // For 404, try next candidate endpoint\r\n        if (res.status === 404) {\r\n          lastError = errResp\r\n          continue\r\n        }\r\n\r\n        // For auth errors or other non-retryable statuses, return immediately\r\n        return errResp\r\n      }\r\n\r\n      // Handle Prembly response format\r\n      if (data?.status === \"success\" || data?.success === true || data?.status === true) {\r\n        return {\r\n          ok: true,\r\n          data: {\r\n            nin: data.data?.nin || req.nin,\r\n            firstName: data.data?.firstName || data.data?.first_name || \"\",\r\n            lastName: data.data?.lastName || data.data?.last_name || \"\",\r\n            middleName: data.data?.middleName || data.data?.middle_name || \"\",\r\n            dateOfBirth: data.data?.dateOfBirth || data.data?.date_of_birth || \"\",\r\n            gender: data.data?.gender || \"\",\r\n            phone: data.data?.phone || data.data?.phoneNumber || \"\",\r\n            address: data.data?.address || \"\",\r\n            photo: data.data?.photo || data.data?.image || \"\",\r\n            trackingId: data.data?.trackingId || data.data?.tracking_id || \"\",\r\n            issueDate: data.data?.issueDate || data.data?.issue_date || \"\",\r\n            signature: data.data?.signature || \"\",\r\n            stateOfOrigin: data.data?.stateOfOrigin || data.data?.state_of_origin || \"\",\r\n            lga: data.data?.lga || \"\",\r\n            maritalStatus: data.data?.maritalStatus || data.data?.marital_status || \"\",\r\n            profession: data.data?.profession || \"\",\r\n            religion: data.data?.religion || \"\",\r\n            bloodGroup: data.data?.bloodGroup || data.data?.blood_group || \"\",\r\n            height: data.data?.height || \"\",\r\n            nextOfKin: data.data?.nextOfKin || data.data?.next_of_kin || \"\",\r\n            nextOfKinPhone: data.data?.nextOfKinPhone || data.data?.next_of_kin_phone || \"\",\r\n            nextOfKinAddress: data.data?.nextOfKinAddress || data.data?.next_of_kin_address || \"\",\r\n          },\r\n          reference: data.reference || data.transactionId,\r\n          transactionId: data.transactionId || data.reference,\r\n        }\r\n      }\r\n\r\n      // Non-successful payload\r\n      return {\r\n        ok: false,\r\n        code: data?.code || \"VERIFICATION_FAILED\",\r\n        message: data?.message || data?.error || \"NIN verification failed\",\r\n      }\r\n    } catch (error) {\r\n      // Network error; move to next path if any\r\n      lastError = { ok: false, code: \"NETWORK_ERROR\", message: `Network error on ${path}: ${String(error)}` }\r\n      continue\r\n    }\r\n  }\r\n\r\n  // If we exhausted all candidates, return the last error captured\r\n  return lastError || { ok: false, code: \"UNKNOWN_ERROR\", message: \"NIN verification failed for unknown reasons\" }\r\n}\r\n\r\n/**\r\n * Mock NIN verification for local testing\r\n */\r\n// Mock NIN verification removed; platform now enforces real provider integration"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1793, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/prembly.ts"],"sourcesContent":["/**\r\n * Prembly API Client\r\n * Documentation: https://docs.prembly.com/docs/welcome-to-prembly-documentation\r\n */\r\n\r\nconst PREMBLY_BASE_URL = process.env.PREMBLY_BASE_URL || 'https://api.prembly.com';\r\n\r\ninterface PremblyConfig {\r\n  apiKey: string;\r\n  appId: string;\r\n}\r\n\r\ninterface PremblyResponse<T> {\r\n  status: boolean;\r\n  detail: string;\r\n  data?: T;\r\n  error?: string;\r\n}\r\n\r\n// NIN Service Types\r\ninterface NINPrintoutParams {\r\n  nin: string;\r\n}\r\n\r\ninterface NINSlipParams {\r\n  nin: string;\r\n}\r\n\r\ninterface NINAdvancedParams {\r\n  nin: string;\r\n  phoneNumber?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  dateOfBirth?: string;\r\n  gender?: string;\r\n}\r\n\r\n// BVN Service Types\r\ninterface BVNPrintoutParams {\r\n  bvn: string;\r\n}\r\n\r\ninterface BVNByPhoneParams {\r\n  phoneNumber: string;\r\n}\r\n\r\ninterface BVNAdvancedParams {\r\n  bvn: string;\r\n}\r\n\r\n// Phone number advanced\r\ninterface PhoneAdvancedParams {\r\n  phoneNumber: string;\r\n}\r\n\r\n// TIN Service Types\r\ninterface TINVerificationParams {\r\n  tin: string;\r\n}\r\n\r\n// Driver's License\r\ninterface DriversLicenseAdvancedParams {\r\n  licenseNumber?: string;\r\n  expiryDate?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  dob?: string;\r\n}\r\n\r\n// Voters Card\r\ninterface VotersCardParams {\r\n  number: string;\r\n  lastName?: string;\r\n  firstName?: string;\r\n  dob?: string;\r\n  lga?: string;\r\n  state?: string;\r\n}\r\n\r\n// CAC Service Types (Advance)\r\ninterface CACAdvanceParams {\r\n  // unified params aligning to Prembly Advance CAC\r\n  number: string; // RC or BN or IT number\r\n  companyType?: 'RC' | 'BN' | 'IT';\r\n  companyName?: string;\r\n}\r\n\r\n// International Passport\r\ninterface InternationalPassportV2Params {\r\n  passportNumber: string;\r\n  lastName?: string;\r\n}\r\n\r\n// Plate Number\r\ninterface PlateNumberParams {\r\n  plateNumber: string;\r\n}\r\n\r\n/**\r\n * Prembly API Client for identity verification services\r\n */\r\nexport class PremblyClient {\r\n  private apiKey: string;\r\n  private appId: string;\r\n  \r\n  constructor(config: PremblyConfig) {\r\n    this.apiKey = config.apiKey;\r\n    this.appId = config.appId;\r\n  }\r\n\r\n  private async makeRequest<T>(endpoint: string, method: string, data?: any): Promise<PremblyResponse<T>> {\r\n    try {\r\n      if (process.env.NODE_ENV !== 'production') {\r\n        console.log('[Prembly] env check', {\r\n          baseUrl: PREMBLY_BASE_URL,\r\n          endpoint,\r\n          hasApiKey: !!this.apiKey,\r\n          hasAppId: !!this.appId,\r\n        })\r\n      }\r\n      const response = await fetch(`${PREMBLY_BASE_URL}${endpoint}`, {\r\n        method,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/json',\r\n          'x-api-key': this.apiKey,\r\n          'app-id': this.appId,\r\n        },\r\n        body: data ? JSON.stringify(data) : undefined,\r\n      });\r\n\r\n      const contentType = response.headers.get('content-type') || '';\r\n      let result: any;\r\n      if (contentType.includes('application/json')) {\r\n        result = await response.json();\r\n      } else {\r\n        const text = await response.text();\r\n        throw new Error(`Unexpected response from Prembly (${response.status}): ${text.slice(0, 200)}...`);\r\n      }\r\n      \r\n      if (!response.ok) {\r\n        const msg = typeof result?.error === 'string' ? result.error\r\n          : typeof result?.detail === 'string' ? result.detail\r\n          : typeof result?.message === 'string' ? result.message\r\n          : 'Failed to process request';\r\n        throw new Error(msg);\r\n      }\r\n      \r\n      return result;\r\n    } catch (error: any) {\r\n      console.error('Prembly API Error:', error);\r\n      return {\r\n        status: false,\r\n        detail: error.message || 'An error occurred while processing your request',\r\n        error: error.message,\r\n      };\r\n    }\r\n  }\r\n\r\n  // NIN Services\r\n  async getNINPrintout(params: NINPrintoutParams) {\r\n    const payload: any = { number_nin: params.nin }\r\n    return this.makeRequest('/verification/vnin', 'POST', payload);\r\n  }\r\n\r\n  async getNINSlip(params: NINSlipParams) {\r\n    const payload: any = { number_nin: params.nin }\r\n    return this.makeRequest('/verification/vnin', 'POST', payload);\r\n  }\r\n\r\n  async getNINAdvanced(params: NINAdvancedParams) {\r\n    const payload: any = { number_nin: params.nin }\r\n    if (params.phoneNumber) payload.phone_number = params.phoneNumber\r\n    if (params.firstName) payload.first_name = params.firstName\r\n    if (params.lastName) payload.last_name = params.lastName\r\n    if (params.dateOfBirth) payload.date_of_birth = params.dateOfBirth\r\n    if (params.gender) payload.gender = params.gender\r\n    return this.makeRequest('/verification/vnin', 'POST', payload)\r\n  }\r\n\r\n  // BVN Services (use documented endpoints)\r\n  async getBVNPrintout(params: BVNPrintoutParams) {\r\n    const payload = { number: params.bvn } as any\r\n    return this.makeRequest('/verification/bvn', 'POST', payload);\r\n  }\r\n\r\n  async getBVNByPhone(params: BVNByPhoneParams) {\r\n    // Per docs: POST /verification/bvn_with_phone_advance with payload { phone_number }\r\n    const payload = { phone_number: params.phoneNumber } as any;\r\n    return this.makeRequest('/verification/bvn_with_phone_advance', 'POST', payload);\r\n  }\r\n\r\n  async getBVNAdvanced(params: BVNAdvancedParams) {\r\n    return this.makeRequest('/verification/bvn/advance', 'POST', params);\r\n  }\r\n\r\n  // Phone Number (Advanced)\r\n  async verifyPhoneAdvanced(params: PhoneAdvancedParams) {\r\n    const payload = { phone_number: params.phoneNumber } as any\r\n    return this.makeRequest('/verification/phone_number/advance', 'POST', payload)\r\n  }\r\n\r\n  // TIN\r\n  async verifyTIN(params: TINVerificationParams) {\r\n    return this.makeRequest('/verification/global/tin-check', 'POST', params);\r\n  }\r\n\r\n  // Driver's License (Advanced)\r\n  async verifyDriversLicenseAdvanced(params: DriversLicenseAdvancedParams) {\r\n    const payload: any = {}\r\n    if (params.licenseNumber) payload.license_number = params.licenseNumber\r\n    if (params.expiryDate) payload.expiry_date = params.expiryDate\r\n    if (params.firstName) payload.first_name = params.firstName\r\n    if (params.lastName) payload.last_name = params.lastName\r\n    if (params.dob) payload.dob = params.dob\r\n    return this.makeRequest('/verification/drivers_license/advance/v2', 'POST', payload)\r\n  }\r\n\r\n  // Voters Card\r\n  async verifyVotersCard(params: VotersCardParams) {\r\n    const payload: any = { number: params.number }\r\n    if (params.lastName) payload.last_name = params.lastName\r\n    if (params.firstName) payload.first_name = params.firstName\r\n    if (params.dob) payload.dob = params.dob\r\n    if (params.lga) payload.lga = params.lga\r\n    if (params.state) payload.state = params.state\r\n    return this.makeRequest('/verification/voters_card', 'POST', payload)\r\n  }\r\n\r\n  // CAC Services (Advance)\r\n  async getCACInfo(params: CACAdvanceParams) {\r\n    // Docs: POST /verification/cac/advance with rc_number, company_type, company_name\r\n    const payload: any = {}\r\n    if (params.number) payload.rc_number = String(params.number)\r\n    if (params.companyType) payload.company_type = String(params.companyType)\r\n    if (params.companyName) payload.company_name = String(params.companyName)\r\n    return this.makeRequest('/verification/cac/advance', 'POST', payload)\r\n  }\r\n\r\n  async getCACAdvanced(params: CACAdvanceParams) {\r\n    const payload: any = {}\r\n    if (params.number) payload.rc_number = String(params.number)\r\n    if (params.companyType) payload.company_type = String(params.companyType)\r\n    if (params.companyName) payload.company_name = String(params.companyName)\r\n    return this.makeRequest('/verification/cac/advance', 'POST', payload)\r\n  }\r\n\r\n  async getCACStatusReport(params: CACAdvanceParams) {\r\n    const payload: any = {}\r\n    if (params.number) payload.rc_number = String(params.number)\r\n    if (params.companyType) payload.company_type = String(params.companyType)\r\n    if (params.companyName) payload.company_name = String(params.companyName)\r\n    return this.makeRequest('/verification/cac/advance', 'POST', payload)\r\n  }\r\n\r\n  // International Passport v2\r\n  async verifyInternationalPassportV2(params: InternationalPassportV2Params) {\r\n    const payload: any = { passport_number: params.passportNumber }\r\n    if (params.lastName) payload.last_name = params.lastName\r\n    return this.makeRequest('/verification/national_passport_v2', 'POST', payload)\r\n  }\r\n\r\n  // Plate Number\r\n  async verifyPlateNumber(params: PlateNumberParams) {\r\n    const payload = { plate_number: params.plateNumber } as any\r\n    return this.makeRequest('/verification/vehicle', 'POST', payload)\r\n  }\r\n}\r\n\r\n// Create and export a singleton instance with environment variables\r\nexport const premblyClient = new PremblyClient({\r\n  apiKey: process.env.PREMBLY_API_KEY || '',\r\n  appId: process.env.PREMBLY_APP_ID || '',\r\n});\r\n\r\nexport default premblyClient;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1976, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/prembly-sdk-adapter.ts"],"sourcesContent":["import premblyHttpClient, { PremblyClient as HttpPremblyClient } from \"./prembly\"\n\n// Optional SDK imports. We keep usage minimal and fallback to HTTP client when unsupported.\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { PremblyDataVerification, PremblyGeneralVerification, PremblyDocumentVerification, PremblyGlobalBusinessVerification } from \"prembly-pass\"\n\n// Shape normalization helper to keep the same response contract our routes expect\nfunction ok<T>(data: T, detail = \"OK\") {\n  return { status: true, detail, data }\n}\nfunction fail(message: string) {\n  return { status: false, detail: message, error: message }\n}\n\n// Singleton SDK instances (created lazily)\nlet dataVerification: any | null = null\nlet generalVerification: any | null = null\nlet documentVerification: any | null = null\nlet globalBusinessVerification: any | null = null\n\nfunction ensureSdkInstances() {\n  const apiKey = process.env.PREMBLY_API_KEY || \"\"\n  const appId = process.env.PREMBLY_APP_ID || \"\"\n  if (!apiKey || !appId) return false\n  try {\n    if (!dataVerification) dataVerification = new PremblyDataVerification(apiKey, appId)\n    if (!generalVerification) generalVerification = new PremblyGeneralVerification(apiKey, appId)\n    if (!documentVerification) documentVerification = new PremblyDocumentVerification(apiKey, appId)\n    if (!globalBusinessVerification) globalBusinessVerification = new PremblyGlobalBusinessVerification(apiKey, appId)\n    return true\n  } catch (e) {\n    return false\n  }\n}\n\n// Adapter exposing the same methods as our HTTP client. Unknowns fall back to HTTP client.\nconst sdkBackedClient: HttpPremblyClient & Record<string, any> = {\n  // Delegate to original HTTP client's private fields through the instance we import\n  ...(premblyHttpClient as any),\n\n  // Plate Number via SDK (Data Verification)\n  async verifyPlateNumber(params: { plateNumber: string }) {\n    try {\n      if (ensureSdkInstances()) {\n        const res = await dataVerification.verifyPlateNumber(params.plateNumber)\n        // Normalize into our standard response\n        return ok(res)\n      }\n    } catch (e: any) {\n      return fail(e?.message || String(e))\n    }\n    // Fallback to HTTP client\n    return premblyHttpClient.verifyPlateNumber(params)\n  },\n\n  // Everything else falls back to the HTTP client for now\n  async getBVNPrintout(params: any) { return premblyHttpClient.getBVNPrintout(params) },\n  async getBVNByPhone(params: any) { return premblyHttpClient.getBVNByPhone(params) },\n  async getBVNAdvanced(params: any) { return premblyHttpClient.getBVNAdvanced(params) },\n\n  async getNINPrintout(params: any) { return premblyHttpClient.getNINPrintout(params) },\n  async getNINSlip(params: any) { return premblyHttpClient.getNINSlip(params) },\n  async getNINAdvanced(params: any) { return premblyHttpClient.getNINAdvanced(params) },\n\n  async getCACInfo(params: any) { return premblyHttpClient.getCACInfo(params) },\n  async getCACAdvanced(params: any) { return premblyHttpClient.getCACAdvanced(params) },\n  async getCACStatusReport(params: any) { return premblyHttpClient.getCACStatusReport(params) },\n\n  async verifyInternationalPassportV2(params: any) { return premblyHttpClient.verifyInternationalPassportV2(params) },\n  async verifyTIN(params: any) { return premblyHttpClient.verifyTIN(params) },\n  async verifyVotersCard(params: any) { return premblyHttpClient.verifyVotersCard(params) },\n  async verifyPhoneAdvanced(params: any) { return premblyHttpClient.verifyPhoneAdvanced(params) },\n}\n\nexport function getPrembly() {\n  const useSdk = String(process.env.USE_PREMBLY_SDK || \"\").toLowerCase() === \"true\"\n  return useSdk ? (sdkBackedClient as HttpPremblyClient) : premblyHttpClient\n}\n\nexport default getPrembly"],"names":[],"mappings":";;;;;;AAAA;AAEA,4FAA4F;AAC5F,6DAA6D;AAC7D,aAAa;AACb;;;AAEA,kFAAkF;AAClF,SAAS,GAAM,IAAO,EAAE,SAAS,IAAI;IACnC,OAAO;QAAE,QAAQ;QAAM;QAAQ;IAAK;AACtC;AACA,SAAS,KAAK,OAAe;IAC3B,OAAO;QAAE,QAAQ;QAAO,QAAQ;QAAS,OAAO;IAAQ;AAC1D;AAEA,2CAA2C;AAC3C,IAAI,mBAA+B;AACnC,IAAI,sBAAkC;AACtC,IAAI,uBAAmC;AACvC,IAAI,6BAAyC;AAE7C,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI;IAC9C,MAAM,QAAQ,QAAQ,GAAG,CAAC,cAAc,IAAI;IAC5C,IAAI,CAAC,UAAU,CAAC,OAAO,OAAO;IAC9B,IAAI;QACF,IAAI,CAAC,kBAAkB,mBAAmB,IAAI,6KAAuB,CAAC,QAAQ;QAC9E,IAAI,CAAC,qBAAqB,sBAAsB,IAAI,gLAA0B,CAAC,QAAQ;QACvF,IAAI,CAAC,sBAAsB,uBAAuB,IAAI,iLAA2B,CAAC,QAAQ;QAC1F,IAAI,CAAC,4BAA4B,6BAA6B,IAAI,uLAAiC,CAAC,QAAQ;QAC5G,OAAO;IACT,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEA,2FAA2F;AAC3F,MAAM,kBAA2D;IAC/D,mFAAmF;IACnF,GAAI,2HAAiB;IAErB,2CAA2C;IAC3C,MAAM,mBAAkB,MAA+B;QACrD,IAAI;YACF,IAAI,sBAAsB;gBACxB,MAAM,MAAM,MAAM,iBAAiB,iBAAiB,CAAC,OAAO,WAAW;gBACvE,uCAAuC;gBACvC,OAAO,GAAG;YACZ;QACF,EAAE,OAAO,GAAQ;YACf,OAAO,KAAK,GAAG,WAAW,OAAO;QACnC;QACA,0BAA0B;QAC1B,OAAO,2HAAiB,CAAC,iBAAiB,CAAC;IAC7C;IAEA,wDAAwD;IACxD,MAAM,gBAAe,MAAW;QAAI,OAAO,2HAAiB,CAAC,cAAc,CAAC;IAAQ;IACpF,MAAM,eAAc,MAAW;QAAI,OAAO,2HAAiB,CAAC,aAAa,CAAC;IAAQ;IAClF,MAAM,gBAAe,MAAW;QAAI,OAAO,2HAAiB,CAAC,cAAc,CAAC;IAAQ;IAEpF,MAAM,gBAAe,MAAW;QAAI,OAAO,2HAAiB,CAAC,cAAc,CAAC;IAAQ;IACpF,MAAM,YAAW,MAAW;QAAI,OAAO,2HAAiB,CAAC,UAAU,CAAC;IAAQ;IAC5E,MAAM,gBAAe,MAAW;QAAI,OAAO,2HAAiB,CAAC,cAAc,CAAC;IAAQ;IAEpF,MAAM,YAAW,MAAW;QAAI,OAAO,2HAAiB,CAAC,UAAU,CAAC;IAAQ;IAC5E,MAAM,gBAAe,MAAW;QAAI,OAAO,2HAAiB,CAAC,cAAc,CAAC;IAAQ;IACpF,MAAM,oBAAmB,MAAW;QAAI,OAAO,2HAAiB,CAAC,kBAAkB,CAAC;IAAQ;IAE5F,MAAM,+BAA8B,MAAW;QAAI,OAAO,2HAAiB,CAAC,6BAA6B,CAAC;IAAQ;IAClH,MAAM,WAAU,MAAW;QAAI,OAAO,2HAAiB,CAAC,SAAS,CAAC;IAAQ;IAC1E,MAAM,kBAAiB,MAAW;QAAI,OAAO,2HAAiB,CAAC,gBAAgB,CAAC;IAAQ;IACxF,MAAM,qBAAoB,MAAW;QAAI,OAAO,2HAAiB,CAAC,mBAAmB,CAAC;IAAQ;AAChG;AAEO,SAAS;IACd,MAAM,SAAS,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI,IAAI,WAAW,OAAO;IAC3E,OAAO,SAAU,kBAAwC,2HAAiB;AAC5E;uCAEe","debugId":null}},
    {"offset": {"line": 2091, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/service-utils.ts"],"sourcesContent":["export function isManualService(serviceId: string, subServiceId?: string): boolean {\r\n    const sId = serviceId.toLowerCase()\r\n    const subId = subServiceId?.toLowerCase()\r\n\r\n    // BVN: printout, advanced, retrieval_phone are automated\r\n    if (sId === \"bvn\") {\r\n        const auto = [\"printout\", \"retrieval\"]\r\n        return !subId || !auto.includes(subId)\r\n    }\r\n\r\n    // NIN: slip, printout, advanced are automated\r\n    if (sId === \"nin\") {\r\n        const auto = [\"slip\", \"printout\", \"advanced\"]\r\n        return !subId || !auto.includes(subId)\r\n    }\r\n\r\n    // CAC: status-report, certification, info, status are automated\r\n    if (sId === \"cac\") {\r\n        const auto = [\"status-report\", \"certification\", \"status\", \"info\"]\r\n        return !subId || !auto.includes(subId)\r\n    }\r\n\r\n    // POS and Software: Always manual\r\n    if (sId === \"pos-requests\" || sId === \"software-development\") return true\r\n\r\n    return false\r\n}\r\n\r\nexport function handleServiceError(resp: any, toast: any, title = \"Error\") {\r\n    const message = resp.error || resp.message || \"An unexpected error occurred\"\r\n    toast({\r\n        title,\r\n        description: message,\r\n        variant: \"destructive\",\r\n    })\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,gBAAgB,SAAiB,EAAE,YAAqB;IACpE,MAAM,MAAM,UAAU,WAAW;IACjC,MAAM,QAAQ,cAAc;IAE5B,yDAAyD;IACzD,IAAI,QAAQ,OAAO;QACf,MAAM,OAAO;YAAC;YAAY;SAAY;QACtC,OAAO,CAAC,SAAS,CAAC,KAAK,QAAQ,CAAC;IACpC;IAEA,8CAA8C;IAC9C,IAAI,QAAQ,OAAO;QACf,MAAM,OAAO;YAAC;YAAQ;YAAY;SAAW;QAC7C,OAAO,CAAC,SAAS,CAAC,KAAK,QAAQ,CAAC;IACpC;IAEA,gEAAgE;IAChE,IAAI,QAAQ,OAAO;QACf,MAAM,OAAO;YAAC;YAAiB;YAAiB;YAAU;SAAO;QACjE,OAAO,CAAC,SAAS,CAAC,KAAK,QAAQ,CAAC;IACpC;IAEA,kCAAkC;IAClC,IAAI,QAAQ,kBAAkB,QAAQ,wBAAwB,OAAO;IAErE,OAAO;AACX;AAEO,SAAS,mBAAmB,IAAS,EAAE,KAAU,EAAE,QAAQ,OAAO;IACrE,MAAM,UAAU,KAAK,KAAK,IAAI,KAAK,OAAO,IAAI;IAC9C,MAAM;QACF;QACA,aAAa;QACb,SAAS;IACb;AACJ","debugId":null}},
    {"offset": {"line": 2143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/service/%5Bcategory%5D/%5Baction%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { prisma } from \"@/lib/db\"\r\nimport { requireAuth } from \"@/lib/require-auth\"\r\nimport { protect } from \"@/lib/security\"\r\nimport { z } from \"zod\"\r\nimport { getActiveProvider } from \"@/lib/provider-manager\"\r\nimport { sendAirtimeViaPorted } from \"@/lib/providers/airtime-ported\"\r\nimport { sendAirtimeViaSubAndGain } from \"@/lib/providers/airtime-subandgain\"\r\nimport { sendDataBundleViaPorted } from \"@/lib/providers/data-ported\"\r\nimport { sendDataBundleViaSubAndGain } from \"@/lib/providers/data-subandgain\"\r\nimport { payBillViaSubAndGain } from \"@/lib/providers/bills-subandgain\"\r\nimport { payEducationViaSubAndGain } from \"@/lib/providers/education-subandgain\"\r\nimport { payCableViaSubAndGain } from \"@/lib/providers/cable-subandgain\"\r\nimport { verifyNINViaPrembly } from \"@/lib/providers/verification-prembly\"\r\nimport getPrembly from \"@/lib/prembly-sdk-adapter\"\r\nimport { isManualService } from \"@/lib/service-utils\"\r\n\r\n// POST /api/service/[category]/[action]\r\nexport async function POST(req: NextRequest, ctx: { params: Promise<{ category: string; action: string }> }) {\r\n  try {\r\n    const auth = await requireAuth(req)\r\n    if (!auth.ok) return auth.response\r\n\r\n    const sec = await protect(req as any)\r\n    if (!sec.allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n    }\r\n\r\n    const { category, action } = await ctx.params\r\n    const serviceId = decodeURIComponent(category)\r\n    const actionId = decodeURIComponent(action)\r\n\r\n    const body = await req.json()\r\n    const Schema = z.object({\r\n      amount: z.number().positive(),\r\n      idempotencyKey: z.string().min(8).optional(),\r\n      params: z.record(z.any()).default({}),\r\n      subServiceId: z.string().optional(),\r\n      pin: z.string().length(4).regex(/^\\d+$/),\r\n    })\r\n    const parsed = Schema.safeParse(body)\r\n    if (!parsed.success) {\r\n      return NextResponse.json({ error: \"Invalid request\", detail: parsed.error.flatten() }, { status: 400 })\r\n    }\r\n\r\n    const { amount, idempotencyKey, params, subServiceId, pin } = parsed.data\r\n    const reference = idempotencyKey || `SRV-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\r\n\r\n    // Transaction PIN Verification\r\n    const userWithPin = await prisma.user.findUnique({\r\n      where: { id: auth.user.id },\r\n      select: { transactionPin: true },\r\n    })\r\n\r\n    if (!userWithPin?.transactionPin) {\r\n      return NextResponse.json({ error: \"Transaction PIN not set\" }, { status: 403 })\r\n    }\r\n\r\n    const { compare } = await import(\"bcryptjs\")\r\n    const isPinValid = await compare(pin || \"\", userWithPin.transactionPin)\r\n    if (!isPinValid) {\r\n      return NextResponse.json({ error: \"Invalid transaction PIN\" }, { status: 401 })\r\n    }\r\n\r\n    // KYC Check: Exempt airtime, data, bills, education. Enforce for others (NIN, BVN, CAC, verification, etc.)\r\n    const exemptCategories = [\"airtime\", \"data\", \"bills\", \"education\"]\r\n    if (!exemptCategories.includes(serviceId.toLowerCase())) {\r\n      const { ensureKyc } = await import(\"@/lib/kyc-check\")\r\n      const kycError = await ensureKyc(auth.user.id)\r\n      if (kycError) return kycError\r\n    }\r\n\r\n    // Manual Service Check\r\n    if (isManualService(serviceId, actionId)) {\r\n      const wallet = await prisma.wallet.findUnique({ where: { userId: auth.user.id } })\r\n      if (!wallet || Number(wallet.balance) < amount) {\r\n        return NextResponse.json({ error: \"Insufficient wallet balance\" }, { status: 402 })\r\n      }\r\n\r\n      await prisma.$transaction([\r\n        prisma.transaction.create({\r\n          data: {\r\n            userId: auth.user.id,\r\n            type: \"SERVICE_REQUEST\",\r\n            amount,\r\n            status: \"SUBMITTED\" as any,\r\n            reference,\r\n            category: serviceId,\r\n            subservice: actionId,\r\n            meta: { serviceId, action: actionId, subServiceId, params, manual: true },\r\n          },\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"MANUAL_SERVICE_REQUEST\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, subServiceId, params, status: \"SUBMITTED\" as any },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({\r\n        ok: true,\r\n        reference,\r\n        status: \"SUBMITTED\" as any,\r\n        message: \"Service request submitted. Admin will review shortly.\",\r\n      })\r\n    }\r\n\r\n    // Idempotency: short-circuit on existing transaction\r\n    const existing = await prisma.transaction.findUnique({ where: { reference } }).catch(() => null)\r\n    if (existing) {\r\n      return NextResponse.json({ ok: true, idempotent: true, reference, transaction: existing })\r\n    }\r\n\r\n    // Lightweight service: NIN flows (no external provider required) - slip/printout/advanced\r\n    if (serviceId.toLowerCase() === \"nin\" && [\"slip\", \"printout\", \"advanced\"].includes(actionId.toLowerCase())) {\r\n      const wallet = await prisma.wallet.findUnique({ where: { userId: auth.user.id } })\r\n      if (!wallet || Number(wallet.balance) < amount) {\r\n        return NextResponse.json({ error: \"Insufficient wallet balance\" }, { status: 402 })\r\n      }\r\n\r\n      await prisma.$transaction([\r\n        prisma.transaction.create({\r\n          data: {\r\n            userId: auth.user.id,\r\n            type: \"SERVICE_PURCHASE\",\r\n            amount,\r\n            status: \"PENDING\",\r\n            reference,\r\n            category: serviceId,\r\n            subservice: actionId,\r\n            meta: { serviceId, subServiceId, action: actionId, params },\r\n          },\r\n        }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_INIT\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, subServiceId, params },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({ where: { reference }, data: { status: \"SUCCESS\", meta: { slip: \"nin\", variant: subServiceId } } }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, subServiceId, params },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({ ok: true, reference })\r\n    }\r\n\r\n    // BVN services (printout, advanced, retrieval_phone) via Prembly; debit wallet on success\r\n    if (serviceId.toLowerCase() === \"bvn\") {\r\n      const wallet = await prisma.wallet.findUnique({ where: { userId: auth.user.id } })\r\n      if (!wallet || Number(wallet.balance) < amount) {\r\n        return NextResponse.json({ error: \"Insufficient wallet balance\" }, { status: 402 })\r\n      }\r\n\r\n      const premblyClient = getPrembly()\r\n      let res: any = null\r\n      try {\r\n        if (actionId.toLowerCase() === \"printout\") {\r\n          res = await premblyClient.getBVNPrintout({ bvn: String((params as any)?.bvn || \"\") })\r\n        } else if (actionId.toLowerCase() === \"advanced\") {\r\n          res = await premblyClient.getBVNAdvanced({ bvn: String((params as any)?.bvn || \"\") })\r\n        } else if (actionId.toLowerCase() === \"retrieval_phone\") {\r\n          res = await premblyClient.getBVNByPhone({ phoneNumber: String((params as any)?.phoneNumber || \"\") })\r\n        } else {\r\n          return NextResponse.json({ error: `Unsupported BVN action: ${actionId}` }, { status: 400 })\r\n        }\r\n      } catch (e: any) {\r\n        res = { status: false, error: e?.message || String(e), detail: e?.message || String(e) }\r\n      }\r\n\r\n      if (!res?.status) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.create({\r\n            data: {\r\n              userId: auth.user.id,\r\n              type: \"SERVICE_PURCHASE\",\r\n              amount,\r\n              status: \"FAILED\",\r\n              reference,\r\n              category: serviceId,\r\n              subservice: actionId,\r\n              meta: { serviceId, action: actionId, params, error: res?.error || res?.detail },\r\n            },\r\n          }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, reason: res?.error || res?.detail, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res?.error || res?.detail || \"BVN request failed\" }, { status: 400 })\r\n      }\r\n\r\n      await prisma.$transaction([\r\n        prisma.transaction.create({\r\n          data: {\r\n            userId: auth.user.id,\r\n            type: \"SERVICE_PURCHASE\",\r\n            amount,\r\n            status: \"SUCCESS\",\r\n            reference,\r\n            category: serviceId,\r\n            subservice: actionId,\r\n            meta: { serviceId, action: actionId, params },\r\n          },\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, params },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({ ok: true, reference, data: res?.data })\r\n    }\r\n\r\n    // Provider selection (for services that require an external provider)\r\n    const providerInfo = await getActiveProvider(serviceId)\r\n    if (!providerInfo.provider) {\r\n      return NextResponse.json(\r\n        { error: \"No active provider for service\", serviceId, fallbackProviders: providerInfo.fallbackProviders },\r\n        { status: 503 },\r\n      )\r\n    }\r\n\r\n    // Wallet check (outline)\r\n    const wallet = await prisma.wallet.findUnique({ where: { userId: auth.user.id } })\r\n    if (!wallet || Number(wallet.balance) < amount) {\r\n      return NextResponse.json({ error: \"Insufficient wallet balance\" }, { status: 402 })\r\n    }\r\n\r\n    // Create initial transaction and audit\r\n    await prisma.$transaction([\r\n      prisma.transaction.create({\r\n        data: {\r\n          userId: auth.user.id,\r\n          type: \"SERVICE_PURCHASE\",\r\n          amount,\r\n          status: \"PENDING\",\r\n          reference,\r\n          category: serviceId,\r\n          subservice: subServiceId || actionId,\r\n          meta: { serviceId, subServiceId, action: actionId, providerId: providerInfo.provider.id, params },\r\n        },\r\n      }),\r\n      prisma.auditLog.create({\r\n        data: {\r\n          actorId: auth.user.id,\r\n          action: \"SERVICE_REQUEST_INIT\",\r\n          resourceType: \"Transaction\",\r\n          resourceId: reference,\r\n          diffJson: { amount, serviceId, action: actionId, subServiceId, providerId: providerInfo.provider.id, params },\r\n        },\r\n      }),\r\n    ])\r\n\r\n    // For airtime/vtu, use live adapters (SubAndGain or Ported SIM); add failover to fallback providers\r\n    if (serviceId === \"airtime\" && actionId === \"vtu\") {\r\n      const adapterName = String((providerInfo.provider.configJson as any)?.adapter || \"\")\r\n        .toLowerCase()\r\n      const providerName = providerInfo.provider.name.toLowerCase()\r\n      const isSubAndGain = adapterName.includes(\"subandgain\") || providerName.includes(\"subandgain\")\r\n      const isPorted = adapterName.includes(\"ported\") || providerName.includes(\"ported\")\r\n      const isMock = adapterName.includes(\"mock\") || providerName.includes(\"mock\")\r\n\r\n      let res = isSubAndGain\r\n        ? await sendAirtimeViaSubAndGain(\r\n          {\r\n            amount,\r\n            params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\") },\r\n            providerId: providerInfo.provider.id,\r\n            subServiceId,\r\n          },\r\n          providerInfo.provider,\r\n        )\r\n        : isPorted\r\n          ? await sendAirtimeViaPorted(\r\n            {\r\n              amount,\r\n              params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\") },\r\n              providerId: providerInfo.provider.id,\r\n              subServiceId,\r\n            },\r\n            providerInfo.provider,\r\n          )\r\n          : isMock\r\n            ? {\r\n              ok: true,\r\n              providerReference: `mock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n              message: \"Mock airtime purchase successful\",\r\n            }\r\n            : { ok: false, code: \"UNSUPPORTED_ADAPTER\", message: \"Unsupported airtime adapter (expected subandgain, ported, or mock)\" }\r\n\r\n      // Failover: if primary fails and we have fallback providers, try them sequentially\r\n      let usedProvider = providerInfo.provider\r\n      if (!res.ok && providerInfo.fallbackProviders.length > 0) {\r\n        for (const fb of providerInfo.fallbackProviders) {\r\n          const fbAdapter = String((fb.configJson as any)?.adapter || fb.name || \"\").toLowerCase()\r\n          const fbIsPorted = fbAdapter.includes(\"ported\") || fbAdapter.includes(\"portedsim\")\r\n          const fbIsSAG = fbAdapter.includes(\"subandgain\")\r\n          const supportsAirtime = fb.category === \"airtime\"\r\n          if (!supportsAirtime || (!fbIsPorted && !fbIsSAG)) continue\r\n\r\n          await prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_FAILOVER_ATTEMPT\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { fromProviderId: usedProvider?.id, toProviderId: fb.id, category: serviceId },\r\n            },\r\n          })\r\n\r\n          const attempt = fbIsPorted\r\n            ? await sendAirtimeViaPorted({ amount, params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\") }, providerId: fb.id, subServiceId }, fb)\r\n            : await sendAirtimeViaSubAndGain({ amount, params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\") }, providerId: fb.id, subServiceId }, fb)\r\n\r\n          if (attempt.ok) {\r\n            res = attempt\r\n            usedProvider = fb\r\n            break\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success: mark transaction and debit wallet atomically\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({ where: { reference }, data: { status: \"SUCCESS\", meta: { providerRef: res.providerReference, providerId: usedProvider?.id } } }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, subServiceId, providerRef: res.providerReference, providerId: usedProvider?.id },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({ ok: true, reference, provider: usedProvider, providerRef: res.providerReference })\r\n    }\r\n\r\n    // For data/bundle, use live adapters (SubAndGain or Ported SIM); add failover to fallback providers\r\n    if (serviceId === \"data\" && actionId === \"bundle\") {\r\n      const adapterName = String((providerInfo.provider.configJson as any)?.adapter || \"\")\r\n        .toLowerCase()\r\n      const providerName = providerInfo.provider.name.toLowerCase()\r\n      const isSubAndGain = adapterName.includes(\"subandgain\") || providerName.includes(\"subandgain\")\r\n      const isPorted = adapterName.includes(\"ported\") || providerName.includes(\"ported\")\r\n\r\n      let res = isSubAndGain\r\n        ? await sendDataBundleViaSubAndGain(\r\n          {\r\n            amount,\r\n            params: {\r\n              phone: String(params?.phone || \"\"),\r\n              network: String(params?.network || \"\"),\r\n              planCode: String(params?.planCode || \"\"),\r\n            },\r\n            providerId: providerInfo.provider.id,\r\n            subServiceId,\r\n          },\r\n          providerInfo.provider,\r\n        )\r\n        : isPorted\r\n          ? await sendDataBundleViaPorted(\r\n            {\r\n              amount,\r\n              params: {\r\n                phone: String(params?.phone || \"\"),\r\n                network: String(params?.network || \"\"),\r\n                planCode: String(params?.planCode || \"\"),\r\n              },\r\n              providerId: providerInfo.provider.id,\r\n              subServiceId,\r\n            },\r\n            providerInfo.provider,\r\n          )\r\n          : { ok: false, code: \"UNSUPPORTED_ADAPTER\", message: \"Unsupported data adapter (expected subandgain or ported)\" }\r\n\r\n      // Failover: if primary fails and we have fallback providers, try them sequentially\r\n      let usedProvider = providerInfo.provider\r\n      if (!res.ok && providerInfo.fallbackProviders.length > 0) {\r\n        for (const fb of providerInfo.fallbackProviders) {\r\n          const fbAdapter = String((fb.configJson as any)?.adapter || fb.name || \"\").toLowerCase()\r\n          const fbIsPorted = fbAdapter.includes(\"ported\") || fbAdapter.includes(\"portedsim\")\r\n          const fbIsSAG = fbAdapter.includes(\"subandgain\")\r\n          const supportsData = fb.category === \"data\"\r\n          if (!supportsData || (!fbIsPorted && !fbIsSAG)) continue\r\n\r\n          await prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_FAILOVER_ATTEMPT\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { fromProviderId: usedProvider?.id, toProviderId: fb.id, category: serviceId },\r\n            },\r\n          })\r\n\r\n          const attempt = fbIsPorted\r\n            ? await sendDataBundleViaPorted({ amount, params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\"), planCode: String(params?.planCode || \"\") }, providerId: fb.id, subServiceId }, fb)\r\n            : await sendDataBundleViaSubAndGain({ amount, params: { phone: String(params?.phone || \"\"), network: String(params?.network || \"\"), planCode: String(params?.planCode || \"\") }, providerId: fb.id, subServiceId }, fb)\r\n\r\n          if (attempt.ok) {\r\n            res = attempt\r\n            usedProvider = fb\r\n            break\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success: mark transaction and debit wallet atomically\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({ where: { reference }, data: { status: \"SUCCESS\", meta: { providerRef: res.providerReference, providerId: usedProvider?.id } } }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: { amount, serviceId, action: actionId, subServiceId, providerRef: res.providerReference, providerId: usedProvider?.id },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({ ok: true, reference, provider: usedProvider, providerRef: res.providerReference })\r\n    }\r\n\r\n    // For bills/electricity, use SubAndGain live adapter only; remove mock\r\n    if (serviceId === \"bills\" && actionId === \"electricity\") {\r\n      const adapterName = String((providerInfo.provider.configJson as any)?.adapter || \"\").toLowerCase()\r\n      const providerName = providerInfo.provider.name.toLowerCase()\r\n      const isSubAndGain = adapterName.includes(\"subandgain\") || providerName.includes(\"subandgain\")\r\n\r\n      const res = isSubAndGain\r\n        ? await payBillViaSubAndGain(\r\n          {\r\n            amount,\r\n            params: {\r\n              meterNumber: String(params?.meterNumber || \"\"),\r\n              serviceProvider: String(params?.serviceProvider || \"\"),\r\n              customerName: String(params?.customerName || \"\"),\r\n              customerAddress: String(params?.customerAddress || \"\"),\r\n            },\r\n            providerId: providerInfo.provider.id,\r\n            subServiceId,\r\n          },\r\n          providerInfo.provider,\r\n        )\r\n        : { ok: false, code: \"UNSUPPORTED_ADAPTER\", message: \"Unsupported bills adapter (expected subandgain)\" }\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success: mark transaction and debit wallet atomically\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({\r\n          where: { reference },\r\n          data: {\r\n            status: \"SUCCESS\",\r\n            meta: {\r\n              providerRef: res.providerReference,\r\n              token: res.token,\r\n              units: res.units\r\n            }\r\n          }\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: {\r\n              amount,\r\n              serviceId,\r\n              action: actionId,\r\n              subServiceId,\r\n              providerRef: res.providerReference,\r\n              token: res.token,\r\n              units: res.units,\r\n              params\r\n            },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({\r\n        ok: true,\r\n        reference,\r\n        provider: providerInfo.provider,\r\n        providerRef: res.providerReference,\r\n        token: res.token,\r\n        units: res.units\r\n      })\r\n    }\r\n\r\n    // For bills/cable, use SubAndGain live adapter\r\n    if (serviceId === \"bills\" && actionId === \"cable\") {\r\n      const adapterName = String((providerInfo.provider.configJson as any)?.adapter || \"\").toLowerCase()\r\n      const providerName = providerInfo.provider.name.toLowerCase()\r\n      const isSubAndGain = adapterName.includes(\"subandgain\") || providerName.includes(\"subandgain\")\r\n\r\n      const res = isSubAndGain\r\n        ? await payCableViaSubAndGain(\r\n          {\r\n            amount,\r\n            params: {\r\n              smartcardNumber: String(params?.smartcardNumber || \"\"),\r\n              provider: String(params?.provider || \"\"),\r\n              planId: String(params?.planId || \"\"),\r\n              customerName: String(params?.customerName || \"\"),\r\n            },\r\n            providerId: providerInfo.provider.id,\r\n            subServiceId,\r\n          },\r\n          providerInfo.provider,\r\n        )\r\n        : { ok: false, code: \"UNSUPPORTED_ADAPTER\", message: \"Unsupported cable adapter (expected subandgain)\" }\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success: mark transaction and debit wallet atomically\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({\r\n          where: { reference },\r\n          data: {\r\n            status: \"SUCCESS\",\r\n            meta: {\r\n              providerRef: res.providerReference,\r\n            }\r\n          }\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: {\r\n              amount,\r\n              serviceId,\r\n              action: actionId,\r\n              subServiceId,\r\n              providerRef: res.providerReference,\r\n              params\r\n            },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({\r\n        ok: true,\r\n        reference,\r\n        provider: providerInfo.provider,\r\n        providerRef: res.providerReference,\r\n      })\r\n    }\r\n\r\n    // For education tokens/pins, use SubAndGain live adapter. Support sub-endpoints for exams\r\n    if (serviceId === \"education\") {\r\n      const adapterName = String((providerInfo.provider.configJson as any)?.adapter || \"\").toLowerCase()\r\n      const providerName = providerInfo.provider.name.toLowerCase()\r\n      const isSubAndGain = adapterName.includes(\"subandgain\") || providerName.includes(\"subandgain\")\r\n      const isMock = adapterName.includes(\"mock\") || providerName.includes(\"mock\")\r\n\r\n      // Map action to eduType if action represents a specific exam\r\n      const actionToEduType: Record<string, string> = {\r\n        neco: \"NECO\",\r\n        waec: \"WAEC\",\r\n        nabteb: \"NABTEB\",\r\n        nbais: \"NBAIS\",\r\n        token: String((params as any)?.eduType || \"\"),\r\n      }\r\n      // Normalize UI labels like \"WAEC Pin\" -> \"WAEC\"; prioritize params.eduType\r\n      const incomingEduTypeRaw = String((params as any)?.eduType || \"\")\r\n      const normalizedLabel = incomingEduTypeRaw.trim().toUpperCase()\r\n      let mappedEduType = \"\"\r\n      if (normalizedLabel) {\r\n        if (normalizedLabel.includes(\"WAEC\") || normalizedLabel.includes(\"GCE\")) mappedEduType = \"WAEC\"\r\n        else if (normalizedLabel.includes(\"NECO\")) mappedEduType = \"NECO\"\r\n        else if (normalizedLabel.includes(\"NABTEB\")) mappedEduType = \"NABTEB\"\r\n        else if (normalizedLabel.includes(\"NBAIS\")) mappedEduType = \"NBAIS\"\r\n        else mappedEduType = normalizedLabel\r\n      } else {\r\n        mappedEduType = actionToEduType[actionId] || \"\"\r\n      }\r\n\r\n      let res = isSubAndGain\r\n        ? await payEducationViaSubAndGain(\r\n          {\r\n            amount,\r\n            params: { eduType: mappedEduType },\r\n            providerId: providerInfo.provider.id,\r\n            subServiceId,\r\n          },\r\n          providerInfo.provider,\r\n        )\r\n        : isMock\r\n          ? {\r\n            ok: true,\r\n            providerReference: `mock_edu_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n            token: `EDU-${mappedEduType || 'TOKEN'}-${Math.random().toString(36).substr(2, 8).toUpperCase()}`,\r\n            message: `Mock education token purchase successful for ${mappedEduType || 'education service'}`,\r\n          }\r\n          : { ok: false, code: \"UNSUPPORTED_ADAPTER\", message: \"Unsupported education adapter (expected subandgain or mock)\" }\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, message: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({\r\n          where: { reference },\r\n          data: {\r\n            status: \"SUCCESS\",\r\n            meta: {\r\n              providerRef: res.providerReference,\r\n              token: res.token\r\n            }\r\n          }\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: {\r\n              amount,\r\n              serviceId,\r\n              action: actionId,\r\n              subServiceId,\r\n              providerRef: res.providerReference,\r\n              token: res.token,\r\n              params\r\n            },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({\r\n        ok: true,\r\n        reference,\r\n        provider: providerInfo.provider,\r\n        providerRef: res.providerReference,\r\n        token: res.token\r\n      })\r\n    }\r\n\r\n    // For verification/nin, call Prembly API when configured; no mock fallback\r\n    if (serviceId === \"verification\" && actionId === \"nin\") {\r\n      const useReal = String((providerInfo.provider.configJson as any)?.adapter || \"\")\r\n        .toLowerCase()\r\n        .includes(\"prembly\") || providerInfo.provider.name.toLowerCase().includes(\"prembly\")\r\n\r\n      if (!useReal) {\r\n        return NextResponse.json({ error: \"Unsupported verification provider. Prembly required.\" }, { status: 503 })\r\n      }\r\n\r\n      const res = await verifyNINViaPrembly(\r\n        {\r\n          nin: String(params?.nin || \"\"),\r\n          phone: String(params?.phone || \"\"),\r\n          firstName: String(params?.firstName || \"\"),\r\n          lastName: String(params?.lastName || \"\"),\r\n          dateOfBirth: String(params?.dateOfBirth || \"\"),\r\n          gender: String(params?.gender || \"\"),\r\n        },\r\n        providerInfo.provider,\r\n      )\r\n\r\n      if (!res.ok) {\r\n        await prisma.$transaction([\r\n          prisma.transaction.update({ where: { reference }, data: { status: \"FAILED\", meta: { error: res.message, code: res.code } } }),\r\n          prisma.auditLog.create({\r\n            data: {\r\n              actorId: auth.user.id,\r\n              action: \"SERVICE_REQUEST_FAILED\",\r\n              resourceType: \"Transaction\",\r\n              resourceId: reference,\r\n              diffJson: { amount, serviceId, action: actionId, subServiceId, reason: res.message, code: res.code, params },\r\n            },\r\n          }),\r\n        ])\r\n        return NextResponse.json({ ok: false, reference, error: res.message, code: res.code }, { status: 400 })\r\n      }\r\n\r\n      // Success: mark transaction and debit wallet atomically\r\n      await prisma.$transaction([\r\n        prisma.transaction.update({\r\n          where: { reference },\r\n          data: {\r\n            status: \"SUCCESS\",\r\n            meta: {\r\n              providerRef: res.reference,\r\n              transactionId: res.transactionId,\r\n              verificationData: res.data\r\n            }\r\n          }\r\n        }),\r\n        prisma.wallet.update({ where: { userId: auth.user.id }, data: { balance: { decrement: amount } } }),\r\n        prisma.auditLog.create({\r\n          data: {\r\n            actorId: auth.user.id,\r\n            action: \"SERVICE_REQUEST_SUCCESS\",\r\n            resourceType: \"Transaction\",\r\n            resourceId: reference,\r\n            diffJson: {\r\n              amount,\r\n              serviceId,\r\n              action: actionId,\r\n              subServiceId,\r\n              providerRef: res.reference,\r\n              transactionId: res.transactionId,\r\n              nin: params?.nin,\r\n              params\r\n            },\r\n          },\r\n        }),\r\n      ])\r\n\r\n      return NextResponse.json({\r\n        ok: true,\r\n        reference,\r\n        provider: providerInfo.provider,\r\n        providerRef: res.reference,\r\n        transactionId: res.transactionId,\r\n        data: res.data\r\n      })\r\n    }\r\n\r\n    // Default: queued (awaiting provider processing)\r\n    return NextResponse.json({ ok: true, reference, provider: providerInfo.provider, message: \"Queued\" })\r\n  } catch (err) {\r\n    return NextResponse.json({ error: \"Service request failed\", detail: String(err) }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}