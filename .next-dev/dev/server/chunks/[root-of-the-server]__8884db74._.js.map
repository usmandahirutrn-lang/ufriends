{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/security.ts"],"sourcesContent":["import arcjet, { shield, validateEmail } from \"@arcjet/next\"\n\ntype AJInstance = ReturnType<typeof arcjet> | null\n\n// Create a shared Arcjet instance with common rules.\n// In development, ARCJET_KEY may be missing, so we fail open.\nexport const aj: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n      ],\n    })\n  : null\n\n// Email-validation instance for routes that need email context\nexport const ajWithEmail: AJInstance = process.env.ARCJET_KEY\n  ? arcjet({\n      key: process.env.ARCJET_KEY!,\n      rules: [\n        shield({ mode: \"LIVE\" }),\n        validateEmail({ mode: \"LIVE\", deny: [\"DISPOSABLE\", \"INVALID\", \"NO_MX_RECORDS\"] }),\n      ],\n    })\n  : null\n\nexport async function protect(req: Request, opts?: { email?: string }) {\n  if (!aj) return { allowed: true }\n  try {\n    const decision = await (opts?.email && ajWithEmail\n      ? (ajWithEmail as any).protect(req as any, { email: opts.email })\n      : (aj as any).protect(req as any))\n    if (decision?.isDenied?.()) return { allowed: false }\n    return { allowed: true }\n  } catch {\n    // Fail open in dev\n    return { allowed: true }\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAMO,MAAM,KAAiB,QAAQ,GAAG,CAAC,UAAU,GAChD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;KACvB;AACH,KACA;AAGG,MAAM,cAA0B,QAAQ,GAAG,CAAC,UAAU,GACzD,IAAA,sKAAM,EAAC;IACL,KAAK,QAAQ,GAAG,CAAC,UAAU;IAC3B,OAAO;QACL,IAAA,2IAAM,EAAC;YAAE,MAAM;QAAO;QACtB,IAAA,kJAAa,EAAC;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAc;gBAAW;aAAgB;QAAC;KAChF;AACH,KACA;AAEG,eAAe,QAAQ,GAAY,EAAE,IAAyB;IACnE,IAAI,CAAC,IAAI,OAAO;QAAE,SAAS;IAAK;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,CAAC,MAAM,SAAS,cACnC,AAAC,YAAoB,OAAO,CAAC,KAAY;YAAE,OAAO,KAAK,KAAK;QAAC,KAC7D,AAAC,GAAW,OAAO,CAAC,IAAW;QACnC,IAAI,UAAU,cAAc,OAAO;YAAE,SAAS;QAAM;QACpD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAM;QACN,mBAAmB;QACnB,OAAO;YAAE,SAAS;QAAK;IACzB;AACF","debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient | undefined }\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\n\nconst encoder = new TextEncoder();\n\nfunction getAccessSecret() {\n  const secret = process.env.JWT_SECRET || \"dev_access_secret\";\n  return encoder.encode(secret);\n}\n\nfunction getRefreshSecret() {\n  const secret = process.env.JWT_REFRESH_SECRET || \"dev_refresh_secret\";\n  return encoder.encode(secret);\n}\n\nfunction nowSeconds() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport type TokenPayload = {\n  sub: string; // user id\n  email: string;\n  role: string;\n  jti?: string; // token id for refresh\n};\n\nexport async function signAccessToken(payload: TokenPayload, expiresInSeconds = 15 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getAccessSecret());\n}\n\nexport async function signRefreshToken(payload: TokenPayload, expiresInSeconds = 7 * 24 * 60 * 60) {\n  return new SignJWT(payload as JWTPayload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(nowSeconds() + expiresInSeconds)\n    .sign(getRefreshSecret());\n}\n\nexport async function verifyAccessToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getAccessSecret());\n  return payload as T;\n}\n\nexport async function verifyRefreshToken<T = TokenPayload>(token: string) {\n  const { payload } = await jwtVerify(token, getRefreshSecret());\n  return payload as T;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAEA,MAAM,UAAU,IAAI;AAEpB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IACjD,OAAO,QAAQ,MAAM,CAAC;AACxB;AAEA,SAAS;IACP,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AACjC;AASO,eAAe,gBAAgB,OAAqB,EAAE,mBAAmB,KAAK,EAAE;IACrF,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,iBAAiB,OAAqB,EAAE,mBAAmB,IAAI,KAAK,KAAK,EAAE;IAC/F,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,eAAe,kBACjC,IAAI,CAAC;AACV;AAEO,eAAe,kBAAoC,KAAa;IACrE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT;AAEO,eAAe,mBAAqC,KAAa;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;IAC3C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Downloads/ufriends%20version%201/app/api/auth/logout/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { protect } from \"@/lib/security\"\nimport { prisma } from \"@/lib/db\"\nimport { z } from \"zod\"\nimport { verifyRefreshToken } from \"@/lib/jwt\"\n\n// Arcjet protection via shared helper\n\nconst schema = z.object({ refreshToken: z.string().min(10) }).partial()\n\nexport async function POST(req: Request) {\n  // Apply Arcjet Shield via shared helper to mitigate automated logout abuse\n  const sec = await protect(req as any)\n  if (!sec.allowed) {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n  }\n\n  // Attempt to revoke provided refresh token (optional)\n  try {\n    const body = await req.json().catch(() => ({}))\n    const parsed = schema.safeParse(body)\n    if (parsed.success && parsed.data.refreshToken) {\n      try {\n        const payload: any = await verifyRefreshToken(parsed.data.refreshToken)\n        const jti = payload.jti as string | undefined\n        const userId = payload.sub as string | undefined\n        if (jti && userId) {\n          const record = await prisma.refreshToken.findUnique({ where: { tokenId: jti } })\n          if (record && record.userId === userId && !record.revokedAt) {\n            await prisma.refreshToken.update({ where: { tokenId: jti }, data: { revokedAt: new Date() } })\n          }\n        }\n      } catch {}\n    }\n  } catch {}\n\n  const res = NextResponse.json({ ok: true })\n  // Clear NextAuth cookies to effectively log out\n  res.cookies.set(\"next-auth.session-token\", \"\", { path: \"/\", maxAge: 0 })\n  res.cookies.set(\"__Secure-next-auth.session-token\", \"\", { path: \"/\", maxAge: 0, secure: true })\n  res.cookies.set(\"next-auth.csrf-token\", \"\", { path: \"/\", maxAge: 0 })\n  res.cookies.set(\"__Secure-next-auth.csrf-token\", \"\", { path: \"/\", maxAge: 0, secure: true })\n\n  return res\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,sCAAsC;AAEtC,MAAM,SAAS,yKAAC,CAAC,MAAM,CAAC;IAAE,cAAc,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAAI,GAAG,OAAO;AAE9D,eAAe,KAAK,GAAY;IACrC,2EAA2E;IAC3E,MAAM,MAAM,MAAM,IAAA,4HAAO,EAAC;IAC1B,IAAI,CAAC,IAAI,OAAO,EAAE;QAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IAEA,sDAAsD;IACtD,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,MAAM,SAAS,OAAO,SAAS,CAAC;QAChC,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,CAAC,YAAY,EAAE;YAC9C,IAAI;gBACF,MAAM,UAAe,MAAM,IAAA,kIAAkB,EAAC,OAAO,IAAI,CAAC,YAAY;gBACtE,MAAM,MAAM,QAAQ,GAAG;gBACvB,MAAM,SAAS,QAAQ,GAAG;gBAC1B,IAAI,OAAO,QAAQ;oBACjB,MAAM,SAAS,MAAM,qHAAM,CAAC,YAAY,CAAC,UAAU,CAAC;wBAAE,OAAO;4BAAE,SAAS;wBAAI;oBAAE;oBAC9E,IAAI,UAAU,OAAO,MAAM,KAAK,UAAU,CAAC,OAAO,SAAS,EAAE;wBAC3D,MAAM,qHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;4BAAE,OAAO;gCAAE,SAAS;4BAAI;4BAAG,MAAM;gCAAE,WAAW,IAAI;4BAAO;wBAAE;oBAC9F;gBACF;YACF,EAAE,OAAM,CAAC;QACX;IACF,EAAE,OAAM,CAAC;IAET,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;IACzC,gDAAgD;IAChD,IAAI,OAAO,CAAC,GAAG,CAAC,2BAA2B,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IACtE,IAAI,OAAO,CAAC,GAAG,CAAC,oCAAoC,IAAI;QAAE,MAAM;QAAK,QAAQ;QAAG,QAAQ;IAAK;IAC7F,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IACnE,IAAI,OAAO,CAAC,GAAG,CAAC,iCAAiC,IAAI;QAAE,MAAM;QAAK,QAAQ;QAAG,QAAQ;IAAK;IAE1F,OAAO;AACT","debugId":null}}]
}