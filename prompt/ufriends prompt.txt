üèóÔ∏è Build Full Backend for ‚ÄúUFriends Information Technology‚Äù Platform
________________________________________
üß© Overview
You are building the backend for UFriends Information Technology, a multi-service platform offering:
‚Ä¢	BVN/NIN/CAC Verification
‚Ä¢	Airtime, Data, and Bill Payments
‚Ä¢	Education Pins (WAEC, NECO, NABTEB, JAMB, etc.)
‚Ä¢	Agency Banking
‚Ä¢	Software Development
‚Ä¢	Marketer & Admin Control System
The backend should use Next.js API routes (or Express) with PostgreSQL as the main database and Prisma ORM for modeling.
All code must follow clean modular architecture, security best practices, and modern validation.
________________________________________
‚öôÔ∏è Tech Stack & Tools
Layer	Tools
Database	PostgreSQL + Prisma ORM
Validation	Zod + zod-xss-sanitizer + Joi (optional)
Rate Limiting	Arcjet
Authentication	JWT (Access + Refresh)
Input Sanitization	zod-xss-sanitizer
File Upload	Cloudinary SDK
PDF/Image Generation	node-canvas + pdf-lib + sharp
Payment Gateways	Monnify + PaymentPoint
Provider APIs	Prembly, SubAndGain, MaskawaSub
Environment Management	dotenv
Error Handling	Middleware + structured logging
________________________________________
üîê Modules to Implement
1Ô∏è‚É£ Authentication & User Management
‚Ä¢	User signup, login, logout
‚Ä¢	OTP Email Verification (not link)
‚Ä¢	Password hashing with bcrypt
‚Ä¢	Role-based access: user, marketer, admin
‚Ä¢	Arcjet rate limit on signup/login
‚Ä¢	Zod validation for input sanitization
API Routes
POST /api/auth/signup
POST /api/auth/verify-otp
POST /api/auth/login
POST /api/auth/logout
GET  /api/auth/me
________________________________________
2Ô∏è‚É£ KYC Module (Lightweight)
‚Ä¢	User chooses NIN or BVN for verification
‚Ä¢	Uploads live selfie photo (captured via frontend)
‚Ä¢	Backend saves data, sets status = pending
‚Ä¢	Admin approves/rejects manually
‚Ä¢	KYC is required for Verification & Airtime2Cash services
API Routes
POST /api/kyc/submit
GET  /api/kyc/status
POST /api/admin/kyc/approve
POST /api/admin/kyc/reject
________________________________________
3Ô∏è‚É£ Wallet System
‚Ä¢	User wallet auto-created at signup
‚Ä¢	Fund wallet via Monnify or PaymentPoint
‚Ä¢	Verify transactions via webhook
‚Ä¢	Deduct wallet for any service purchase
‚Ä¢	Refund if service fails
‚Ä¢	Manual admin credit/debit
‚Ä¢	Profit calculation via service pricing
API Routes
POST /api/wallet/fund
GET  /api/wallet/balance
GET  /api/wallet/transactions
POST /api/wallet/webhook/monnify
POST /api/admin/wallet/adjust
GET  /api/admin/wallet/summary
________________________________________
4Ô∏è‚É£ Provider Control System
‚Ä¢	Admin can activate/deactivate any provider
‚Ä¢	Providers include:
o	Airtime/Data/Bills ‚Üí Ported SIM, SubAndGain, MaskawaSub
o	Verification ‚Üí Prembly
o	Wallet ‚Üí Monnify, PaymentPoint
‚Ä¢	System must auto-switch if active provider fails
‚Ä¢	Providers and keys stored in DB, editable from dashboard
API Routes
GET  /api/admin/providers
PATCH /api/admin/providers/:category
POST /api/admin/providers/:id/api-key
________________________________________
5Ô∏è‚É£ Transaction & Service Engine
‚Ä¢	Centralized system to process all user service requests
‚Ä¢	Supports all service categories (Airtime, Data, Verification, Education, CAC, etc.)
‚Ä¢	Deduct wallet, call provider API, log everything
‚Ä¢	Auto refund on failure
‚Ä¢	Save profit per transaction
‚Ä¢	Store provider request & response logs
API Routes
POST /api/service/:category/:action
GET  /api/service/status/:reference
POST /api/admin/service/retry/:reference
GET  /api/admin/service/logs/:reference
________________________________________
6Ô∏è‚É£ Verification Slip Generator (Image Template System)
‚Ä¢	Uses admin-uploaded image templates (PNG/JPG)
‚Ä¢	Backend overlays user data, photo, and QR code on the image
‚Ä¢	Exports to PDF for download
‚Ä¢	Templates configurable via admin dashboard
Flow
‚Ä¢	Admin uploads base template image
‚Ä¢	Admin defines coordinate JSON (x, y, fontSize, etc.)
‚Ä¢	System uses node-canvas to render data on the image
‚Ä¢	Generates official-looking PDF with watermark/signature
API Routes
POST /api/admin/templates/upload
PATCH /api/admin/templates/:id/positions
POST /api/verification/generate/:type
GET  /api/verification/download/:reference
________________________________________
7Ô∏è‚É£ Marketer Module
‚Ä¢	User requests to become marketer (form in /services/agency-banking/marketer)
‚Ä¢	Admin approves or rejects
‚Ä¢	Marketer sees discounted prices on all services
‚Ä¢	Marketer dashboard includes:
o	Commission tracking
o	Referral count
o	Sales performance
‚Ä¢	Admin can adjust commissions manually
API Routes
POST /api/marketer/apply
GET  /api/marketer/dashboard
POST /api/admin/marketer/approve
POST /api/admin/marketer/adjust
________________________________________
8Ô∏è‚É£ Admin Dashboard (Core)
‚Ä¢	Manage users, KYC, wallet, transactions, providers, templates, marketers, and pricing
‚Ä¢	Dynamic configuration via Settings table
‚Ä¢	Profit & Loss Reports
‚Ä¢	Manual service approval (for manual types)
‚Ä¢	Download/export CSV reports
Admin Features
‚Ä¢	Adjust service price
‚Ä¢	Adjust provider API key
‚Ä¢	View profit & total revenue
‚Ä¢	See all wallet inflows/outflows
‚Ä¢	Approve manual services
‚Ä¢	Audit logs for every admin action
________________________________________
9Ô∏è‚É£ Security Features
‚Ä¢	Arcjet ‚Üí Rate limit auth & wallet routes
‚Ä¢	Zod + zod-xss-sanitizer ‚Üí Input sanitization
‚Ä¢	JWT Authentication middleware
‚Ä¢	Prisma transactions ‚Üí Prevent double deduction
‚Ä¢	All file uploads scanned + size limited
‚Ä¢	Webhook signature validation (Monnify, PaymentPoint)
‚Ä¢	Admin logs stored in AdminActionLog
________________________________________
üîê Database Models
Use the Unified Schema (already defined above), which includes:
‚Ä¢	User, KYCRecord, Wallet, WalletTransaction
‚Ä¢	Provider, ServiceCategory, ServicePricing
‚Ä¢	ServiceTransaction, ProviderLog
‚Ä¢	VerificationTemplate, GeneratedDocument
‚Ä¢	Marketer, AdminActionLog, Settings
________________________________________
üßæ System Behavior Summary
Event	Action
User registers	Creates wallet + default role
User funds wallet	Gateway ‚Üí webhook ‚Üí credit
User buys service	Deduct wallet, log transaction
Service fails	Refund + mark failed
Admin changes provider	All future calls switch instantly
Admin uploads template	Available for next PDF generation
User requests KYC	Stored pending until admin approval
Admin credits/debits	Logged in audit table
Marketer approved	Sees discounted prices instantly
________________________________________
üß† Output Requirements
‚Ä¢	Modular codebase (auth, wallet, services, admin, etc.)
‚Ä¢	All routes documented with request/response examples
‚Ä¢	Include Prisma schema and migration
‚Ä¢	Include .env.example for all required environment variables:
‚Ä¢	DATABASE_URL=
‚Ä¢	JWT_SECRET=
‚Ä¢	MONNIFY_API_KEY=
‚Ä¢	PAYMENTPOINT_KEY=
‚Ä¢	PREMBLY_KEY=
‚Ä¢	SUBANDGAIN_KEY=
‚Ä¢	MASKAWASUB_KEY=
‚Ä¢	CLOUDINARY_URL=
‚Ä¢	ARCJET_KEY=
‚Ä¢	Include Postman or OpenAPI (Swagger) route documentation.
Generate the entire backend for the UFriends Information Technology platform as defined above, ensuring modular structure, secure API routes, and production-ready PostgreSQL database.
