(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,750769,e=>{"use strict";var t=e.i(271645),r=e.i(692659);function i(e){try{let t=String(e?.role||"").toLowerCase(),r=Array.isArray(e?.roles)?e.roles.map(e=>String(e).toLowerCase()):[];return t.includes("marketer")||r.includes("marketer")||e?.isMarketer===!0?"marketer":"user"}catch{return"user"}}async function a(){try{let e=await fetch("/api/me");if(!e.ok)return"user";let t=await e.json().catch(()=>null);return i(t?.user||t)}catch{return"user"}}function n(e,n,s,c,l){let[o,d]=(0,t.useState)(()=>i(l)),[u,p]=(0,t.useState)(null),[m,v]=(0,t.useState)(!1),[h,f]=(0,t.useState)(null),[g,y]=(0,t.useState)(void 0),x=(0,t.useMemo)(()=>({category:String(e||"").trim(),subservice:String(n||"").trim(),variant:String(s||"").trim()}),[e,n,s]),b=(0,t.useMemo)(()=>{if(!c||"object"!=typeof c)return"";let e=Object.entries(c).filter(([e,t])=>null!=t);return e.length?(e.sort(([e],[t])=>e.localeCompare(t)),e.map(([e,t])=>`${e}=${String(t)}`).join("|")):""},[c]);return(0,t.useEffect)(()=>{let e=!1;return(async()=>{v(!0),f(null);try{let t=l?i(l):await a();e||d(t);let r=[["category",x.category],["subservice",x.subservice],["variant",x.variant],["role",t]];if(c&&"object"==typeof c){let e=Object.entries(c).filter(([e,t])=>null!=t);for(let[t,i]of(e.sort(([e],[t])=>e.localeCompare(t)),e))r.push([t,String(i)])}let n=new URLSearchParams(r),s=await fetch(`/api/pricing?${n.toString()}`,{cache:"no-store"}),o=await s.json().catch(()=>null);if(!s.ok)throw Error(String(o?.error||"Failed to load pricing"));let u=o?.price;p("number"==typeof u?u:null)}catch(e){f(e?.message||"Failed to fetch pricing"),p(null)}finally{e||v(!1)}})(),()=>{e=!0}},[x.category,x.subservice,x.variant,b,l]),{price:u,isLoading:m,error:h,reference:g,submitService:(0,t.useCallback)(async e=>{try{let t={amount:Number(e.amount),idempotencyKey:"string"==typeof e.idempotencyKey?e.idempotencyKey:void 0,params:{...e||{}},subServiceId:x.variant||void 0,action:function(e,t){let r=e.trim().toLowerCase(),i=t.trim().toLowerCase();if("nin"===r){if("slip"===i)return"nin.slip";if("printout"===i)return"nin.printout";if("advanced"===i||"verification"===i)return"nin.advanced"}if("bvn"===r){if("printout"===i)return"bvn.printout";if("retrieval"===i||"retrieval_phone"===i)return"bvn.retrieval_phone";if("advanced"===i||"verification"===i)return"bvn.advanced"}if("cac"===r){if("info"===i)return"cac.info";if("status"===i)return"cac.status"}return"passport"===r&&("verify"===i||"verification"===i||"basic"===i)?"passport.verify":"phone"===r&&("advanced"===i||"verification"===i||"basic"===i)?"phone.verify_advanced":("driver-license"===r||"drivers_license"===r)&&("basic"===i||"verification"===i)?"drivers_license.verify":("voters-card"===r||"voters"===r)&&("basic"===i||"full"===i||"verification"===i)?"voters.verify":("plate-number"===r||"plate"===r)&&("basic"===i||"verification"===i)?"plate.verify":"tin"===r&&("basic"===i||"certificate"===i||"verification"===i)?"tin.verify":null}(x.category,x.subservice)||void 0,pin:e.pin},i=await (0,r.authFetch)(`/api/service/${encodeURIComponent(x.category)}/${encodeURIComponent(x.subservice)}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}),a=await i.json().catch(()=>null);if(!i.ok)return{ok:!1,error:String(a?.error||`Service failed (${i.status})`),message:String(a?.message||"Failed"),data:a};return y(String(a?.reference||"")),{ok:!0,reference:String(a?.reference||""),message:String(a?.message||""),data:a}}catch(e){return{ok:!1,error:String(e?.message||e)}}},[x.category,x.subservice,x.variant])}}e.s(["default",0,n,"useDynamicPricing",()=>n])},330843,e=>{"use strict";var t=e.i(843476),r=e.i(271645),i=e.i(630374),a=e.i(167881),n=e.i(23750),s=e.i(10708),c=e.i(846696);function l({isOpen:e,onClose:l,onConfirm:o,isLoading:d}){let[u,p]=(0,r.useState)(""),m=()=>{4!==u.length?c.toast.error("Please enter a 4-digit PIN"):(o(u),p(""))};return(0,t.jsx)(i.Dialog,{open:e,onOpenChange:e=>!e&&l(),children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Enter Transaction PIN"}),(0,t.jsx)(i.DialogDescription,{children:"Please enter your 4-digit transaction PIN to authorize this request."})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"pin",className:"text-center block",children:"PIN"}),(0,t.jsx)(n.Input,{id:"pin",type:"password",inputMode:"numeric",maxLength:4,value:u,onChange:e=>p(e.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-[1em]",placeholder:"••••",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&m()}})]})}),(0,t.jsxs)(i.DialogFooter,{children:[(0,t.jsx)(a.Button,{variant:"outline",onClick:l,disabled:d,children:"Cancel"}),(0,t.jsx)(a.Button,{onClick:m,disabled:d||4!==u.length,className:"bg-[#3457D5]",children:d?"Verifying...":"Confirm PIN"})]})]})})}e.s(["PinPrompt",()=>l])},595468,e=>{"use strict";let t=(0,e.i(475254).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],595468)},39312,e=>{"use strict";let t=(0,e.i(475254).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],39312)},677282,e=>{"use strict";var t=e.i(843476),r=e.i(271645),i=e.i(846932),a=e.i(970065),n=e.i(167881),s=e.i(23750),c=e.i(10708),l=e.i(62870),o=e.i(39312),d=e.i(595468),u=e.i(120682),p=e.i(750769),m=e.i(330843);function v(){let[e,v]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[x,b]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1),[E,C]=(0,r.useState)(null),[S,I]=(0,r.useState)(!1),[R,P]=(0,r.useState)(null),{toast:A}=(0,u.useToast)(),[k,D]=(0,r.useState)(null),[T,w]=(0,r.useState)(!1),{price:L,isLoading:O,error:_,submitService:F}=(0,p.default)("bills","electricity",e?({IKEJA:"ikeja",EKO:"eko",IBADAN:"ibadan",ABUJA:"abuja",KANO:"kano","PORT-HARCOURT":"port.harcourt",ENUGU:"enugu",JOS:"jos"})[e]||e.toLowerCase():""),U=async t=>{if(t.preventDefault(),!e||!h||!g||0>=Number(g))return void A({title:"Missing details",description:"Fill provider, meter and amount",variant:"destructive"});N(!0);try{P({amount:Number(g),meterNumber:h,serviceProvider:e,customerName:x}),I(!0)}finally{N(!1)}},K=async e=>{I(!1),N(!0),C(null);try{if(!R)throw Error("No pending payment details found.");let t=await F({...R,pin:e});if(!t.ok)throw Error(t.error||"Electricity bill payment failed");C({reference:String(t.reference||t.data?.reference||""),token:t.data?.token,units:t.data?.units}),A({title:"Electricity paid",description:`Ref: ${String(t.reference||t.data?.reference||"")}`}),v(""),f(""),y(""),b(""),P(null)}catch(e){!function(e,t="Service Error"){let r=e?.message||String(e),i=e?.code||(r.includes("ERR2")?r.match(/ERR2\d{2}/)?.[0]:null);if(i){let e=function(e){switch(e){case"INVALID_USERNAME":case"ERR200":return{title:"Authentication Error",description:"Provider username is missing or invalid. Please contact support."};case"INVALID_CREDENTIALS":case"ERR201":return{title:"Authentication Error",description:"Invalid provider credentials. Please contact support."};case"INSUFFICIENT_BALANCE":case"ERR203":return{title:"Insufficient Balance",description:"Your account balance is insufficient to complete this transaction."};case"TRANSACTION_FAILED":case"ERR206":return{title:"Transaction Failed",description:"Your transaction could not be processed. Please try again later."};case"INVALID_PHONE":case"ERR202":return{title:"Invalid Phone Number",description:"The phone number provided is invalid. Please check and try again."};case"INVALID_NETWORK":case"ERR204":return{title:"Invalid Network",description:"The selected network provider is not supported or invalid."};case"INVALID_PLAN":case"ERR207":return{title:"Invalid Plan",description:"The selected data plan is invalid or unavailable."};case"INVALID_METER":case"ERR208":return{title:"Invalid Meter Number",description:"The meter number provided is invalid. Please check and try again."};case"INVALID_DISCO":case"ERR209":return{title:"Invalid Provider",description:"The selected electricity provider is invalid or not supported."};case"INVALID_AMOUNT":case"ERR210":return{title:"Invalid Amount",description:"The amount specified is invalid for this transaction."};case"INVALID_EDU_TYPE":return{title:"Invalid Education Type",description:"The selected education service type is invalid or not supported."};case"MISSING_CONFIG":return{title:"Configuration Error",description:"Provider configuration is missing. Please contact support."};case"BAD_INPUT":return{title:"Invalid Input",description:"Some required information is missing or invalid. Please check your inputs."};case"NETWORK_ERROR":return{title:"Network Error",description:"Unable to connect to the service provider. Please check your internet connection and try again."};case"NO_REFERENCE":return{title:"Transaction Reference Error",description:"Transaction completed but no reference was generated. Please contact support."};default:return{title:"Service Error",description:"An error occurred with the service provider. Please try again later or contact support."}}}(i);(0,u.toast)({title:e.title,description:e.description,variant:"destructive"})}else(0,u.toast)({title:t,description:r,variant:"destructive"})}(e,"Electricity Payment Failed")}finally{N(!1)}};return(0,r.useEffect)(()=>{(w(O),e)?D("number"==typeof L?L:null):D(null)},[e,L,O]),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)(i.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-2 bg-[#3457D5]/10 rounded-lg",children:(0,t.jsx)(o.Zap,{className:"h-6 w-6 text-[#3457D5]"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Electricity Bill"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Pay for electricity across all DISCOs"})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,t.jsxs)(a.Card,{className:"border-[#3457D5]/20 shadow-lg",children:[(0,t.jsxs)(a.CardHeader,{className:"bg-gradient-to-r from-[#3457D5]/5 to-[#CCCCFF]/10",children:[(0,t.jsx)(a.CardTitle,{className:"text-[#3457D5]",children:"Pay Electricity"}),(0,t.jsx)(a.CardDescription,{children:"Enter meter details and amount"})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"DISCO Provider"}),(0,t.jsxs)(l.Select,{value:e,onValueChange:v,children:[(0,t.jsx)(l.SelectTrigger,{children:(0,t.jsx)(l.SelectValue,{placeholder:"Select provider"})}),(0,t.jsx)(l.SelectContent,{children:[{value:"IKEJA",label:"Ikeja Electric"},{value:"EKO",label:"Eko Electric"},{value:"IBADAN",label:"Ibadan Electric"},{value:"ABUJA",label:"Abuja Electric"},{value:"KANO",label:"Kano Electric"},{value:"PORT-HARCOURT",label:"Port Harcourt Electric"},{value:"ENUGU",label:"Enugu Electric"},{value:"JOS",label:"Jos Electric"}].map(e=>(0,t.jsx)(l.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Meter Number"}),(0,t.jsx)(s.Input,{value:h,onChange:e=>f(e.target.value),placeholder:"1234567890"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Amount (₦)"}),(0,t.jsx)(s.Input,{type:"number",value:g,onChange:e=>y(Number(e.target.value)),placeholder:"500"})]}),e?(0,t.jsxs)("div",{className:"bg-[#CCCCFF]/20 p-3 rounded-lg text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Service Fee"}),(0,t.jsx)("span",{children:T?"Loading...":`₦${(k??0).toLocaleString()}`})]}),(0,t.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,t.jsx)("span",{children:"Total Payable"}),(0,t.jsxs)("span",{children:["₦",((Number(g)||0)+(k||0)).toLocaleString()]})]})]}):null,(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Customer Name (optional)"}),(0,t.jsx)(s.Input,{value:x,onChange:e=>b(e.target.value),placeholder:"John Doe"})]}),(0,t.jsx)(n.Button,{className:"w-full",type:"submit",disabled:j||O,children:j||O?"Processing...":"Pay Electricity"})]}),E&&(0,t.jsxs)("div",{className:"mt-6 p-3 rounded-lg bg-green-50 border border-green-200 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-medium text-green-700",children:[(0,t.jsx)(d.CheckCircle2,{className:"h-5 w-5"})," Payment successful"]}),(0,t.jsxs)("div",{className:"mt-1 text-green-700",children:["Reference: ",E.reference]}),E.token?(0,t.jsxs)("div",{className:"text-green-700",children:["Token: ",E.token]}):null,E.units?(0,t.jsxs)("div",{className:"text-green-700",children:["Units: ",E.units]}):null]})]})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(a.CardTitle,{children:"Tips"}),(0,t.jsx)(a.CardDescription,{children:"Prepaid meters return tokens on success"})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-2",children:[(0,t.jsx)("li",{children:"Confirm DISCO provider matches your meter."}),(0,t.jsx)("li",{children:"Double-check meter number before paying."}),(0,t.jsx)("li",{children:"Your wallet will be debited after success."})]})})]})]}),(0,t.jsx)(m.PinPrompt,{isOpen:S,onClose:()=>I(!1),onConfirm:K,isLoading:j})]})}e.s(["default",()=>v],677282)}]);