(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,595468,e=>{"use strict";let t=(0,e.i(475254).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],595468)},184762,e=>{"use strict";var t=e.i(843476),a=e.i(647163);function s({className:e,...s}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,a.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...s})}e.s(["Textarea",()=>s])},947627,e=>{"use strict";var t=e.i(843476),a=e.i(647163);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...s})})}function i({className:e,...s}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...s})}function l({className:e,...s}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...s})}function r({className:e,...s}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...s})}function n({className:e,...s}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}function d({className:e,...s}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}e.s(["Table",()=>s,"TableBody",()=>l,"TableCell",()=>d,"TableHead",()=>n,"TableHeader",()=>i,"TableRow",()=>r])},373884,e=>{"use strict";let t=(0,e.i(475254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],373884)},727612,e=>{"use strict";let t=(0,e.i(475254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],727612)},319036,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(981140),i=e.i(820783),l=e.i(30030),r=e.i(369340),n=e.i(999682),d=e.i(635804),c=e.i(248425),o="Switch",[m,h]=(0,l.createContextScope)(o),[u,p]=m(o),x=a.forwardRef((e,l)=>{let{__scopeSwitch:n,name:d,checked:m,defaultChecked:h,required:p,disabled:x,value:g="on",onCheckedChange:f,form:b,...N}=e,[y,S]=a.useState(null),w=(0,i.useComposedRefs)(l,e=>S(e)),C=a.useRef(!1),T=!y||b||!!y.closest("form"),[k,A]=(0,r.useControllableState)({prop:m,defaultProp:h??!1,onChange:f,caller:o});return(0,t.jsxs)(u,{scope:n,checked:k,disabled:x,children:[(0,t.jsx)(c.Primitive.button,{type:"button",role:"switch","aria-checked":k,"aria-required":p,"data-state":v(k),"data-disabled":x?"":void 0,disabled:x,value:g,...N,ref:w,onClick:(0,s.composeEventHandlers)(e.onClick,e=>{A(e=>!e),T&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),T&&(0,t.jsx)(j,{control:y,bubbles:!C.current,name:d,value:g,checked:k,required:p,disabled:x,form:b,style:{transform:"translateX(-100%)"}})]})});x.displayName=o;var g="SwitchThumb",f=a.forwardRef((e,a)=>{let{__scopeSwitch:s,...i}=e,l=p(g,s);return(0,t.jsx)(c.Primitive.span,{"data-state":v(l.checked),"data-disabled":l.disabled?"":void 0,...i,ref:a})});f.displayName=g;var j=a.forwardRef(({__scopeSwitch:e,control:s,checked:l,bubbles:r=!0,...c},o)=>{let m=a.useRef(null),h=(0,i.useComposedRefs)(m,o),u=(0,n.usePrevious)(l),p=(0,d.useSize)(s);return a.useEffect(()=>{let e=m.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==l&&t){let a=new Event("click",{bubbles:r});t.call(e,l),e.dispatchEvent(a)}},[u,l,r]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...c,tabIndex:-1,ref:h,style:{...c.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function v(e){return e?"checked":"unchecked"}j.displayName="SwitchBubbleInput";var b=e.i(647163);function N({className:e,...a}){return(0,t.jsx)(x,{"data-slot":"switch",className:(0,b.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:(0,t.jsx)(f,{"data-slot":"switch-thumb",className:(0,b.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}e.s(["Switch",()=>N],319036)},174117,e=>{"use strict";e.i(271645);let t=0,a=new Map,s=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),r({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},i=[],l={toasts:[]};function r(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?s(a):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),i.forEach(e=>{e(l)})}function n({...e}){let a=(t=(t+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>r({type:"DISMISS_TOAST",toastId:a});return r({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>r({type:"UPDATE_TOAST",toast:{...e,id:a}})}}e.s(["toast",()=>n])},790092,e=>{"use strict";let t=(0,e.i(475254).default)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);e.s(["RefreshCcw",()=>t],790092)},245605,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(970065),i=e.i(167881),l=e.i(23750),r=e.i(184762),n=e.i(62870),d=e.i(319036),c=e.i(947627),o=e.i(994179),m=e.i(174117),h=e.i(692659),u=e.i(727612),p=e.i(790092),x=e.i(595468),g=e.i(373884),f=e.i(178583),j=e.i(630374);function v(){var e;let v,b,[N,y]=(0,a.useState)(!1),[S,w]=(0,a.useState)([]),[C,T]=(0,a.useState)("all"),[k,A]=(0,a.useState)(""),[D,I]=(0,a.useState)("digital"),[O,E]=(0,a.useState)(""),[M,_]=(0,a.useState)(!0),[B,P]=(0,a.useState)(""),[R,H]=(0,a.useState)(!1),[z,$]=(0,a.useState)(!1),[F,L]=(0,a.useState)(""),[U,q]=(0,a.useState)("current"),[V,J]=(0,a.useState)(!1),[X,Z]=(0,a.useState)(null),[G,K]=(0,a.useState)(null),[Q,W]=(0,a.useState)(null),[Y,ee]=(0,a.useState)(null),[et,ea]=(0,a.useState)(!1),[es,ei]=(0,a.useState)(null),[el,er]=(0,a.useState)(""),[en,ed]=(0,a.useState)("digital"),[ec,eo]=(0,a.useState)(""),[em,eh]=(0,a.useState)(!0),eu=(0,a.useRef)(null),[ep,ex]=(0,a.useState)(!1),[eg,ef]=(0,a.useState)(!1),[ej,ev]=(0,a.useState)([]),[eb,eN]=(0,a.useState)(""),ey=["firstName","lastName","nin","dateOfBirth","gender","issueDate","photo","qrCode"],eS=(0,a.useMemo)(()=>[...new Set(Array.from(ec.matchAll(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g)).map(e=>e[1]))],[ec]),ew=(0,a.useMemo)(()=>ey.filter(e=>!eS.includes(e)),[ey,eS]),eC=(0,a.useMemo)(()=>eS.filter(e=>!ey.includes(e)),[ey,eS]),eT=(0,a.useMemo)(()=>[...new Set(Array.from(O.matchAll(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g)).map(e=>`{{${e[1]}}}`))],[O]),ek=(0,a.useMemo)(()=>Y&&S.find(e=>e.isActive&&e.type===Y)||null,[S,Y]),eA=async()=>{y(!0);try{let e=new URLSearchParams;C&&"all"!==C&&e.set("type",C),e.set("pageSize","50");let t=await (0,h.authFetch)(`/api/admin/nin-templates?${e.toString()}`);if(401===t.status){(0,m.toast)({title:"Unauthorized",description:"Please log in as admin.",variant:"destructive"}),y(!1);return}let a=await t.json();w(a.templates||[])}catch(e){(0,m.toast)({title:"Failed to load templates",description:String(e),variant:"destructive"})}finally{y(!1)}};(0,a.useEffect)(()=>{eA()},[C]);let eD=async()=>{if(!k||!O)return void(0,m.toast)({title:"Missing fields",description:"Name and content are required.",variant:"destructive"});y(!0);try{let e=await (0,h.authFetch)("/api/admin/nin-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:k,type:D,templateContent:O,placeholders:eT,isActive:M})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||`Failed: ${e.status}`)}(0,m.toast)({title:"Template created",description:k}),A(""),E(""),_(!0),I("digital"),await eA()}catch(e){(0,m.toast)({title:"Create failed",description:String(e),variant:"destructive"})}finally{y(!1)}},eI=e=>{let t={firstName:"John",middleName:"A.",lastName:"Doe",nin:"12345678901",dateOfBirth:"1990-01-01",gender:"MALE",issueDate:new Date().toISOString().slice(0,10),photo:"/placeholder.jpg",qrCode:"SAMPLE-QR-CODE"},a=e.templateContent;for(let e of Object.keys(t)){let s=RegExp(`\\{\\{\\s*${e}\\s*\\}\\}`,"g");a=a.replace(s,t[e])}return eO(a)},eO=e=>e?e.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gim,"").replace(/<iframe\b[^>]*>([\s\S]*?)<\/iframe>/gim,"").replace(/\bon\w+="[^"]*"/gim,"").replace(/\bon\w+='[^']*'/gim,"").replace(/\bjavascript:[^"']+/gim,""):"",eE=()=>{$(!0),L(""),q("current"),Z(null),K(null),W(null)},eM=async()=>{if(!F)return void Z("Enter a transaction reference");J(!0),Z(null);try{let e=await (0,h.authFetch)(`/api/admin/service/logs/${encodeURIComponent(F)}`),t=await e.json();if(!e.ok||!t?.ok)throw Error(t?.error||`Failed (${e.status})`);let a=t.transaction?.meta||{};K(a?.verificationData||null),W(a?.slipData||null),ee(a?.templateType||null),a?.verificationData||a?.slipData||Z("No verification or slip data found on transaction")}catch(e){Z(String(e?.message||e))}finally{J(!1)}},e_=async()=>{ef(!0);try{let e=new URLSearchParams;eb&&e.set("prefix",eb);let t=await (0,h.authFetch)(`/api/admin/assets?${e.toString()}`),a=await t.json();if(!t.ok||!a?.ok)throw Error(a?.error||`Failed (${t.status})`);ev((a.files||[]).map(e=>({name:e.name,url:e.url,path:e.path})))}catch(e){(0,m.toast)({title:"Failed to load assets",description:String(e),variant:"destructive"})}finally{ef(!1)}},eB=async()=>{if(es){y(!0);try{let e=Array.from(ec.matchAll(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g)).map(e=>`{{${e[1]}}}`),t=[...new Set(e)],a=await (0,h.authFetch)(`/api/admin/nin-templates/${es}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:el,type:en,templateContent:ec,isActive:em,placeholders:t})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||`Failed: ${a.status}`)}(0,m.toast)({title:"Template updated",description:el}),ea(!1),ei(null),await eA()}catch(e){(0,m.toast)({title:"Update failed",description:String(e),variant:"destructive"})}finally{y(!1)}}},eP=async e=>{try{let t=await (0,h.authFetch)(`/api/admin/nin-templates/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive})});if(!t.ok)throw Error(`Failed: ${t.status}`);await eA()}catch(e){(0,m.toast)({title:"Update failed",description:String(e),variant:"destructive"})}},eR=async e=>{if(confirm(`Delete template "${e.name}"?`))try{let t=await (0,h.authFetch)(`/api/admin/nin-templates/${e.id}`,{method:"DELETE"});if(!t.ok)throw Error(`Failed: ${t.status}`);await eA()}catch(e){(0,m.toast)({title:"Delete failed",description:String(e),variant:"destructive"})}},eH=async e=>{y(!0);try{let t=Array.from(e.templateContent.matchAll(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g)).map(e=>`{{${e[1]}}}`),a=[...new Set(t)],s={name:`Copy of ${e.name}`,type:e.type,templateContent:e.templateContent,isActive:!1,placeholders:a},i=await (0,h.authFetch)("/api/admin/nin-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||`Failed: ${i.status}`)}(0,m.toast)({title:"Template duplicated",description:s.name}),await eA()}catch(e){(0,m.toast)({title:"Duplicate failed",description:String(e),variant:"destructive"})}finally{y(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,t.jsx)(f.FileText,{className:"h-6 w-6 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"NIN Templates"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Manage templates used for NIN slip PDF generation"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)(s.CardTitle,{children:"Create Template"})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,t.jsx)(l.Input,{value:k,onChange:e=>A(e.target.value),placeholder:"e.g., Digital Slip v1"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Type"}),(0,t.jsxs)(n.Select,{value:D,onValueChange:e=>I(e),children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{placeholder:"Select type"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"digital",children:"Digital"}),(0,t.jsx)(n.SelectItem,{value:"physical",children:"Physical"}),(0,t.jsx)(n.SelectItem,{value:"nims",children:"NIMS"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Template Content (HTML)"}),(0,t.jsx)(r.Textarea,{rows:8,value:O,onChange:e=>E(e.target.value),placeholder:"HTML with placeholders like {{firstName}}, {{lastName}}, {{nin}}"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[(0,t.jsx)(d.Switch,{checked:M,onCheckedChange:_}),(0,t.jsx)("span",{className:"text-sm",children:"Active"})]}),(0,t.jsxs)("div",{className:"mt-3 text-xs text-muted-foreground",children:["Detected placeholders: ",eT.join(", ")||"<none>"]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(i.Button,{onClick:eD,disabled:N,children:"Create Template"})})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(s.CardTitle,{children:"Templates"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.Select,{value:C,onValueChange:T,children:[(0,t.jsx)(n.SelectTrigger,{className:"w-40",children:(0,t.jsx)(n.SelectValue,{placeholder:"Filter type"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"all",children:"All"}),(0,t.jsx)(n.SelectItem,{value:"digital",children:"Digital"}),(0,t.jsx)(n.SelectItem,{value:"physical",children:"Physical"}),(0,t.jsx)(n.SelectItem,{value:"nims",children:"NIMS"})]})]}),(0,t.jsxs)(i.Button,{variant:"outline",onClick:eA,disabled:N,children:[(0,t.jsx)(p.RefreshCcw,{className:"h-4 w-4 mr-2"})," Refresh"]})]})]})}),(0,t.jsxs)(s.CardContent,{children:[R&&(0,t.jsxs)("div",{className:"border rounded-md p-3 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Template Preview"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>H(!1),children:"Close"})]}),(0,t.jsx)("div",{className:"bg-white border rounded p-4 overflow-auto",style:{maxHeight:500},children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:B}})}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"Note: Images must exist in `public/`. Placeholders are filled with sample data."})]}),(0,t.jsxs)(c.Table,{children:[(0,t.jsx)(c.TableHeader,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableHead,{children:"Name"}),(0,t.jsx)(c.TableHead,{children:"Type"}),(0,t.jsx)(c.TableHead,{children:"Status"}),(0,t.jsx)(c.TableHead,{children:"Placeholders"}),(0,t.jsx)(c.TableHead,{children:"Updated"}),(0,t.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsxs)(c.TableBody,{children:[S.map(e=>(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(c.TableCell,{className:"capitalize",children:e.type}),(0,t.jsx)(c.TableCell,{children:e.isActive?(0,t.jsxs)(o.Badge,{className:"bg-green-600 text-white",children:[(0,t.jsx)(x.CheckCircle2,{className:"h-3 w-3 mr-1"})," Active"]}):(0,t.jsxs)(o.Badge,{variant:"destructive",children:[(0,t.jsx)(g.XCircle,{className:"h-3 w-3 mr-1"})," Inactive"]})}),(0,t.jsx)(c.TableCell,{className:"text-xs",children:e.placeholders?.join(", ")||"<none>"}),(0,t.jsx)(c.TableCell,{className:"text-xs",children:new Date(e.updatedAt).toLocaleString()}),(0,t.jsx)(c.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(i.Button,{variant:"secondary",size:"sm",onClick:()=>{ei(e.id),er(e.name),ed(e.type),eo(e.templateContent),eh(e.isActive),ea(!0)},children:"Edit"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>eH(e),children:"Duplicate"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{P(eI(e)),H(!0)},children:"Preview"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:eE,children:"Real Preview"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>eP(e),children:e.isActive?"Deactivate":"Activate"}),(0,t.jsx)(i.Button,{variant:"destructive",size:"sm",onClick:()=>eR(e),children:(0,t.jsx)(u.Trash2,{className:"h-4 w-4"})})]})})]},e.id)),0===S.length&&(0,t.jsx)(c.TableRow,{children:(0,t.jsx)(c.TableCell,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"No templates found"})})]})]})]})]}),(0,t.jsx)(j.Dialog,{open:et,onOpenChange:ea,children:(0,t.jsxs)(j.DialogContent,{className:"max-w-3xl",children:[(0,t.jsxs)(j.DialogHeader,{children:[(0,t.jsx)(j.DialogTitle,{children:"Edit NIN Template"}),(0,t.jsx)(j.DialogDescription,{children:"Update template details and content. Placeholders auto-detect from HTML."})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,t.jsx)(l.Input,{value:el,onChange:e=>er(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Type"}),(0,t.jsxs)(n.Select,{value:en,onValueChange:e=>ed(e),children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{placeholder:"Select type"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"digital",children:"Digital"}),(0,t.jsx)(n.SelectItem,{value:"physical",children:"Physical"}),(0,t.jsx)(n.SelectItem,{value:"nims",children:"NIMS"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)(d.Switch,{checked:em,onCheckedChange:eh}),(0,t.jsx)("span",{className:"text-sm",children:"Active"})]}),(0,t.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Template Content (HTML)"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsx)(r.Textarea,{ref:eu,rows:8,value:ec,onChange:e=>eo(e.target.value)}),(0,t.jsxs)("div",{className:"border rounded p-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium mb-2",children:"Placeholders"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:["firstName","middleName","lastName","nin","dateOfBirth","gender","issueDate","photo","qrCode","phone","address","stateOfOrigin","lga","trackingId"].map(e=>(0,t.jsx)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{let t=eu.current,a=`{{${e}}}`;if(t&&"number"==typeof t.selectionStart){let e=t.selectionStart,s=t.selectionEnd;eo(ec.slice(0,e)+a+ec.slice(s)),requestAnimationFrame(()=>{t.selectionStart=t.selectionEnd=e+a.length,t.focus()})}else eo(e=>e+a)},children:`{{${e}}}`},e))}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Input,{placeholder:"assets subfolder (optional)",value:eb,onChange:e=>eN(e.target.value)}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{ex(!0),e_()},children:"Assets"})]})})]})]})]}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Required placeholders: ",ey.join(", ")]}),ew.length>0&&(0,t.jsxs)("div",{className:"text-xs text-red-600",children:["Missing required placeholders: ",ew.join(", ")]}),eC.length>0&&(0,t.jsxs)("div",{className:"text-xs text-amber-600",children:["Other detected placeholders: ",eC.join(", ")]})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Detected placeholders: ",Array.from(ec.matchAll(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g)).map(e=>`{{${e[1]}}}`).filter((e,t,a)=>a.indexOf(e)===t).join(", ")||"<none>"]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2 justify-end",children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>ea(!1),children:"Cancel"}),(0,t.jsx)(i.Button,{onClick:eB,disabled:N||!es||ew.length>0,children:"Save Changes"})]}),(0,t.jsxs)("div",{className:"border rounded-md p-3 mt-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium mb-2",children:"Live Preview (sample data)"}),(0,t.jsx)("div",{className:"bg-white border rounded p-4 overflow-auto",style:{maxHeight:300},children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:eI({id:es||"",name:el,type:en,templateContent:ec,placeholders:[],isActive:em,createdBy:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}})}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"Images must exist in `public/`."})]})]})}),(0,t.jsx)(j.Dialog,{open:z,onOpenChange:$,children:(0,t.jsxs)(j.DialogContent,{className:"max-w-4xl",children:[(0,t.jsxs)(j.DialogHeader,{children:[(0,t.jsx)(j.DialogTitle,{children:"Real Data Preview"}),(0,t.jsx)(j.DialogDescription,{children:"Render a template using actual verification/slip data from a transaction reference."})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Transaction Reference"}),(0,t.jsx)(l.Input,{value:F,onChange:e=>L(e.target.value),placeholder:"e.g., NIN-169..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Preview Mode"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Button,{variant:"current"===U?"default":"outline",size:"sm",onClick:()=>q("current"),children:"Use current template"}),(0,t.jsx)(i.Button,{variant:"stored"===U?"default":"outline",size:"sm",onClick:()=>q("stored"),children:"Use stored slip"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Button,{onClick:eM,disabled:V,children:"Load"}),F&&(0,t.jsx)("a",{href:`/api/verification/nin-slip/${encodeURIComponent(F)}/pdf`,target:"_blank",rel:"noreferrer",className:"text-sm underline",children:"Open PDF endpoint"})]}),X&&(0,t.jsx)("div",{className:"text-sm text-red-600",children:X}),(0,t.jsxs)("div",{className:"border rounded-md p-3 mt-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium mb-2",children:"Preview"}),(0,t.jsx)("div",{className:"bg-white border rounded p-4 overflow-auto",style:{maxHeight:400},children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:"stored"===U?eO(Q||"<div class='text-muted-foreground text-sm'>No stored slip HTML for this reference.</div>"):G?(e=ek?.templateContent||ec||O||"",v=e||"",Object.entries({"{{firstName}}":(b=(e=>{if(!e)return{};let t=e||{},a=t.result||t.data||t,s=a.firstName||a.firstname||a.first_name||a.givenNames||a.given_name||"",i=a.middleName||a.middlename||a.middle_name||a.otherNames||"",l=a.lastName||a.lastname||a.last_name||a.surname||"",r=a.nin||a.ninNumber||a.nin_number||a.trackingId||a.tracking_id||a.nimcNin||"",n=a.dateOfBirth||a.dob||a.birthDate||a.birth_date||"",d=(a.gender||a.sex||"").toString().toUpperCase(),c=a.phone||a.msisdn||a.telephone||"",o=a.address||a.residentialAddress||a.residential_address||a.homeAddress||"",m=a.stateOfOrigin||a.state_of_origin||a.state||"",h=a.lga||a.localGovt||a.local_government||"",u=a.trackingId||a.tracking_id||"",p=a.issueDate||a.issue_date||t.issueDate||"",x=a.photoUrl||a.photo||a.imageUrl||a.image||"",g=a.photoBase64||a.imageBase64||"",f=x||(g?`data:image/png;base64,${g}`:"")||"/placeholder.jpg",j=a.qrCode||a.qr||t.qrCode||"";return{firstName:s,middleName:i,lastName:l,nin:r,dateOfBirth:n,gender:d,phone:c,address:o,stateOfOrigin:m,lga:h,trackingId:u,issueDate:p||new Date().toISOString().slice(0,10),photo:f,qrCode:j}})(G)).firstName||"","{{lastName}}":b.lastName||"","{{middleName}}":b.middleName||"","{{nin}}":b.nin||"","{{dateOfBirth}}":b.dateOfBirth||"","{{gender}}":b.gender||"","{{phone}}":b.phone||"","{{address}}":b.address||"","{{photo}}":b.photo||"/placeholder.jpg","{{issueDate}}":b.issueDate||new Date().toISOString().slice(0,10),"{{stateOfOrigin}}":b.stateOfOrigin||"","{{lga}}":b.lga||"","{{trackingId}}":b.trackingId||"","{{qrCode}}":b.qrCode||""}).forEach(([e,t])=>{v=v.replace(RegExp(e,"g"),String(t))}),eO(v)):"<div class='text-muted-foreground text-sm'>Load a reference to render with current template.</div>"}})}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:'Note: "Use current template" renders with the editor content; "Use stored slip" shows server-processed HTML if available.'})]})]})}),(0,t.jsx)(j.Dialog,{open:ep,onOpenChange:ex,children:(0,t.jsxs)(j.DialogContent,{className:"max-w-3xl",children:[(0,t.jsxs)(j.DialogHeader,{children:[(0,t.jsx)(j.DialogTitle,{children:"Assets"}),(0,t.jsx)(j.DialogDescription,{children:"Select an image to insert into the template"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(l.Input,{className:"flex-1",placeholder:"assets subfolder (optional)",value:eb,onChange:e=>eN(e.target.value)}),(0,t.jsxs)(i.Button,{variant:"outline",onClick:e_,disabled:eg,children:[(0,t.jsx)(p.RefreshCcw,{className:"h-4 w-4 mr-2"})," Refresh"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[ej.map(e=>(0,t.jsxs)("div",{className:"border rounded p-2 flex flex-col gap-2",children:[(0,t.jsx)("img",{src:e.url,alt:e.name,className:"h-24 w-full object-cover rounded"}),(0,t.jsx)("div",{className:"text-xs truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{let t=`<img src='${e.url}' alt='${e.name}' />`,a=eu.current;if(a&&"number"==typeof a.selectionStart){let e=a.selectionStart,s=a.selectionEnd;eo(ec.slice(0,e)+t+ec.slice(s)),requestAnimationFrame(()=>{a.selectionStart=a.selectionEnd=e+t.length,a.focus()})}else eo(e=>e+t);ex(!1)},children:"Insert <img>"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{let t=`style="background-image: url('${e.url}');"`,a=eu.current;if(a&&"number"==typeof a.selectionStart){let e=a.selectionStart,s=a.selectionEnd;eo(ec.slice(0,e)+t+ec.slice(s)),requestAnimationFrame(()=>{a.selectionStart=a.selectionEnd=e+t.length,a.focus()})}else eo(e=>e+t);ex(!1)},children:"Insert bg"})]})]},e.path)),0===ej.length&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground col-span-full",children:"No assets found. Upload images in Admin â†’ Assets."})]})]})})]})}e.s(["default",()=>v])}]);