module.exports=[229840,e=>e.a(async(t,a)=>{try{var n=e.i(89171),r=e.i(909438),i=e.i(762294),s=e.i(456158),o=e.i(612834),l=t([s]);async function d(e){try{let t,a=await (0,r.requireAuth)(e,{roles:["ADMIN","AGENT","USER"]});if(!a.ok)return a.response;let{templateId:l,action:d,params:g,fileName:p,data:m}=await e.json().catch(()=>({}))||{};if(!l||"string"!=typeof l)return n.NextResponse.json({error:"Missing templateId"},{status:400});if(!d||"string"!=typeof d)return n.NextResponse.json({error:"Missing action"},{status:400});let u=await i.prisma.ninTemplate.findUnique({where:{id:l}});if(!u||!u.isActive)return n.NextResponse.json({error:"Template not found or inactive"},{status:404});let c=(0,o.default)(),f=null;if(m&&"object"==typeof m)t={status:!0,data:m},f=m;else{switch(d){case"bvn.printout":t=await c.getBVNPrintout({bvn:String(g?.bvn||"")});break;case"bvn.retrieval_phone":t=await c.getBVNByPhone({phoneNumber:String(g?.phoneNumber||"")});break;case"bvn.advanced":t=await c.getBVNAdvanced({bvn:String(g?.bvn||"")});break;case"nin.printout":t=await c.getNINPrintout({nin:String(g?.nin||"")});break;case"nin.slip":t=await c.getNINSlip({nin:String(g?.nin||"")});break;case"nin.advanced":t=await c.getNINAdvanced({nin:String(g?.nin||""),phoneNumber:g?.phoneNumber,firstName:g?.firstName,lastName:g?.lastName,dateOfBirth:g?.dateOfBirth,gender:g?.gender});break;case"cac.info":t=await c.getCACInfo({number:String(g?.number??g?.rcNumber??""),companyType:g?.companyType?String(g.companyType).toUpperCase():void 0,companyName:g?.companyName?String(g.companyName):void 0});break;case"cac.status":t=await c.getCACStatusReport({number:String(g?.number??g?.rcNumber??""),companyType:g?.companyType?String(g.companyType).toUpperCase():void 0,companyName:g?.companyName?String(g.companyName):void 0});break;case"passport.verify":t=await c.verifyInternationalPassportV2({passportNumber:String(g?.passportNumber||""),lastName:g?.lastName});break;case"tin.verify":t=await c.verifyTIN({tin:String(g?.tin||"")});break;case"voters.verify":t=await c.verifyVotersCard({number:String(g?.number??g?.vin??""),lastName:g?.lastName?String(g.lastName):void 0,firstName:g?.firstName?String(g.firstName):void 0,dob:g?.dob?String(g.dob):void 0,lga:g?.lga?String(g.lga):void 0,state:g?.state?String(g.state):void 0});break;case"plate.verify":t=await c.verifyPlateNumber({plateNumber:String(g?.plateNumber||"")});break;case"phone.verify_advanced":t=await c.verifyPhoneAdvanced({phoneNumber:String(g?.phoneNumber||"")});break;case"drivers_license.verify":t=await c.verifyDriversLicenseAdvanced({licenseNumber:g?.licenseNumber?String(g.licenseNumber):void 0,expiryDate:g?.expiryDate?String(g.expiryDate):void 0,firstName:g?.firstName?String(g.firstName):void 0,lastName:g?.lastName?String(g.lastName):void 0,dob:g?.dob?String(g.dob):void 0});break;default:return n.NextResponse.json({error:`Unsupported action: ${d}`},{status:400})}if(!t?.status)return n.NextResponse.json({error:t?.detail||t?.error||"Upstream verification failed"},{status:400});f=t?.data||t?.result||{}}f&&"object"==typeof f&&(f.data&&(f=f.data),f.nin_data&&(f=f.nin_data));let h={};if(d.startsWith("nin.")){let e=f||{},t=e.first_name||e.firstname||e.firstName||e.given_names||e.givenNames||e.given_name||"",a=e.last_name||e.lastname||e.lastName||e.surname||"",n=e.middle_name||e.middlename||e.middleName||e.other_names||e.otherNames||"",r=e.given_names||e.givenNames||[t,n].filter(Boolean).join(" "),i=e.sex||e.gender||"",s=e.gender||e.sex||"",o=e.nin||e.nin_number||e.ninNumber||"",l=e.address||e.residential_address||e.homeAddress||e.residentialAddress||"",g=e.tracking_id||e.trackingId||e.nimc_trackingId||"",p=e.phone_number||e.phoneNumber||e.msisdn||e.telephoneno||"",m=e.residence_state||e.stateOfResidence||e.residential_state||"",u=e.residence_town||e.residence_lga||e.lga||e.lgaOfResidence||"",c=e.birth_state||e.stateOfOrigin||e.state_of_origin||e.birthstate||"",b=e.birth_lga||e.lgaOfOrigin||e.lga_of_origin||e.birthlga||"",_=e.photo||e.photoUrl||e.image||e.imageUrl||e.base64Image||e.image_base64||e.imageBase64||e.photo_base64||e.photoBase64||"";_=("string"==typeof _?String(_):"").replace(/\s+/g,"").trim()||_;let v="string"==typeof _&&/^data:image\/(png|jpeg|jpg);base64,/i.test(String(_)),N="string"==typeof _&&/^(https?:\/\/|\/)/i.test(String(_));if("string"==typeof _&&!v&&!N&&/^[A-Za-z0-9+/=]+$/.test(String(_))&&String(_).length>30){let e=String(_),t=/^iVBOR/.test(e);/^\/9j\//.test(e),_=`data:${t?"image/png":"image/jpeg"};base64,${e}`}else if(!_&&"string"==typeof e.photo&&e.photo.length>30){let t=String(e.photo).replace(/\s+/g,"").trim(),a=/^iVBOR/.test(t);_=`data:${a?"image/png":"image/jpeg"};base64,${t}`}else if(!_&&"string"==typeof e.base64Image&&e.base64Image.length>30){let t=String(e.base64Image).replace(/\s+/g,"").trim(),a=/^iVBOR/.test(t);_=`data:${a?"image/png":"image/jpeg"};base64,${t}`}else if(!_&&"string"==typeof e.image_base64&&e.image_base64.length>30){let t=String(e.image_base64).replace(/\s+/g,"").trim(),a=/^iVBOR/.test(t);_=`data:${a?"image/png":"image/jpeg"};base64,${t}`}else if(!_&&"string"==typeof e.imageBase64&&e.imageBase64.length>30){let t=String(e.imageBase64).replace(/\s+/g,"").trim(),a=/^iVBOR/.test(t);_=`data:${a?"image/png":"image/jpeg"};base64,${t}`}if(!_){let t=e=>{let t="string"==typeof e?String(e).replace(/\s+/g,"").trim():"",a=/^data:image\/(png|jpeg|jpg);base64,/i.test(t),n=/^(https?:\/\/|\/)/i.test(t),r=!a&&!n&&/^[A-Za-z0-9+/=]+$/.test(t)&&t.length>30;if(a||n)return t;if(r){let e=/^iVBOR/.test(t);return`data:${e?"image/png":"image/jpeg"};base64,${t}`}return""};for(let[a,n]of Object.entries(e))if(!_&&"string"==typeof n&&/(image|photo|portrait)/i.test(a)){let e=t(n);if(e){_=e;break}}else if(!_&&n&&"object"==typeof n){for(let[e,a]of Object.entries(n))if("string"==typeof a&&/(image|photo|portrait|base64)/i.test(e)){let e=t(a);if(e){_=e;break}}}}let y=e.issue_date||e.issueDate||new Date().toISOString().slice(0,10),S=e.qr_code||e.qrCode||"",R=e.email||"",w=e.employmentstatus||e.employment_status||"",k=e.maritalstatus||e.marital_status||"",A=e.educationallevel||e.education_level||"",C=e.birthcountry||e.birth_country||"",O=e.heigth||e.height||"",$=e.pfirstname||e.parent_firstname||"",E=e.ospokenlang||e.spoken_language||"",x=e.centralID||e.central_id||"",U=e.nok_firstname||"",I=e.nok_middlename||"",j=e.nok_surname||"",B=e.nok_address1||"",D=e.nok_address2||"",T=e.nok_state||"",P=e.nok_town||e.nok_lga||"",M=e.nok_postalcode||"";h.surname=a,h.first_name=t,h.middle_name=n,h.given_names=r,h.sex=i,h.gender=s,h.nin=o;let q=e.birthdate||e.date_of_birth||e.dob||e.dateOfBirth||"",H=e=>{let t=String(e||"").trim();if(!t)return"";let a=null;if(/^\d{4}-\d{2}-\d{2}/.test(t))a=new Date(t);else if(/^\d{2}[\/-]\d{2}[\/-]\d{4}$/.test(t)){let[e,n,r]=t.split(/[\/-]/).map(Number);a=new Date(r,(n||1)-1,e)}else isNaN(Date.parse(t))||(a=new Date(Date.parse(t)));if(!a||isNaN(a.getTime()))return t;let n=String(a.getDate()).padStart(2,"0"),r=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][a.getMonth()]||"",i=a.getFullYear();return`${n} ${r} ${i}`};h.dob=H(q);let V=String(o||"").replace(/\D+/g,"");h.nin_spaced=11===V.length?`${V.slice(0,4)} ${V.slice(4,7)} ${V.slice(7)}`:o,h.address=l,h.image=_,h.photo="",h.imageUrl="",h.photoUrl="","string"==typeof _&&/^data:image\/(png|jpeg|jpg);base64,/i.test(String(_))?h.base64Image=_.replace(/^data:image\/(png|jpeg|jpg);base64,/i,"").replace(/\s+/g,""):"string"==typeof _&&/^[A-Za-z0-9+/=]+$/.test(String(_))&&String(_).length>50&&(h.base64Image=String(_).replace(/\s+/g,"").trim(),h.image=`data:image/jpeg;base64,${h.base64Image}`,h.photo="",h.imageUrl="",h.photoUrl="");try{"string"==typeof h.image&&h.image&&(f.image=h.image,f.photo=h.image,f.imageUrl=h.image,f.photoUrl=h.image)}catch{}if(h.tracking_id=g,h.trackingId=g,h.phone_number=p,h.phoneNumber=p,h.residence_state=m,h.residence_town=u,h.birth_state=c,h.birth_lga=b,h.issue_date=H(y),!S)try{let t=JSON.stringify({nin:o,surname:a,given_names:r,dob:h.dob||e.birthdate||e.date_of_birth||e.dob||e.dateOfBirth||"",issue_date:y}),n=`https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(t)}`,i=await fetch(n);if(i.ok){let e=Buffer.from(await i.arrayBuffer());S=`data:image/png;base64,${e.toString("base64")}`}}catch{}h.qr_code=S,h.email=R,h.employment_status=w,h.marital_status=k,h.educational_level=A,h.birth_country=C,h.height=O,h.parent_first_name=$,h.spoken_language=E,h.central_id=x,h.nok_firstname=U,h.nok_middlename=I,h.nok_surname=j,h.nok_address1=B,h.nok_address2=D,h.nok_state=T,h.nok_lga_town=P,h.nok_postalcode=M;try{let t=e.image||e.photo||e.imageUrl||e.photoUrl||e.base64Image||e.image_base64||e.imageBase64||e.photo_base64||e.photoBase64||"",a="string"==typeof t?t.slice(0,120):"",n="string"==typeof h.image?String(h.image).slice(0,120):"";console.log("[PDF] NIN debug",{action:d,hasData:!!f,dataKeys:Object.keys(e||{}),rawImagePreview:a,finalImagePreview:n,hasQr:!!h.qr_code})}catch{}}else if(d.startsWith("bvn.")){let e=f||{},t=e.first_name||e.firstName||"",a=e.last_name||e.lastName||"",n=e.middle_name||e.middleName||e.other_names||e.otherNames||e.middleName||"",r=e.full_name||e.fullName||[t,n,a].filter(Boolean).join(" "),i=e.bvn||e.number||e.bvn_number||"",s=e.date_of_birth||e.dob||e.birth_date||e.dateOfBirth||"",o=e.phone_number||e.phoneNumber||e.phoneNumber1||e.phoneNumber2||"",l=e.gender||e.sex||"",d=e.email||"",g=e.enrollment_bank||e.enrollmentBank||"",p=e.enrollment_branch||e.enrollmentBranch||"",m=e.registration_date||e.registrationDate||"",u=e.residential_address||e.residentialAddress||"",c=e.state_of_residence||e.stateOfResidence||"",b=e.nin||e.nin_number||e.ninNumber||"",_=e.photo||e.photoUrl||e.image||e.imageUrl||"";!_&&e.base64Image&&(_=`data:image/jpeg;base64,${String(e.base64Image)}`),h.first_name=t,h.middle_name=n,h.last_name=a,h.surname=a,h.full_name=r,h.bvn=i,h.nin=b,h.dob=s,h.phone_number=o,h.phoneNumber=o,h.gender=l,h.email=d,h.enrollment_bank=g,h.enrollment_branch=p,h.registration_date=m,h.residential_address=u,h.state_of_residence=c;let v=new Date;h.issue_date=`${v.getDate().toString().padStart(2,"0")}-${["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][v.getMonth()]}-${v.getFullYear()}`,h.image=_,h.base64Image=e.base64Image||"",h["data.bvn"]=i,h["data.nin"]=b,h["data.firstName"]=t,h["data.lastName"]=a,h["data.middleName"]=n,h["data.gender"]=l,h["data.email"]=d,h["data.enrollmentBank"]=g,h["data.enrollmentBranch"]=p,h["data.registrationDate"]=m,h["data.residentialAddress"]=u,h["data.stateOfResidence"]=c}else if(d.startsWith("voters.")){let e=f||{},t=e.first_name||e.firstName||"",a=e.last_name||e.lastName||"",n=e.full_name||`${t} ${a}`.trim(),r=e.number||e.votersCardNumber||e.vin||g?.number||g?.vin||"",i=e.dob||e.date_of_birth||e.dateOfBirth||"",s=e.gender||e.sex||"",o=e.state||e.residence_state||g?.state||"",l=e.lga||e.residence_town||e.residence_lga||g?.lga||"",d=e.address||e.residential_address||"";d||(d=[l,o].filter(Boolean).join(", "));let p=e.photo||e.photoUrl||e.image||e.imageUrl||"",m="string"==typeof p&&/^data:image\/(png|jpeg);base64,/i.test(String(p)),u="string"==typeof p&&/^(https?:\/\/|\/)/i.test(String(p));"string"==typeof p&&!m&&!u&&/^[A-Za-z0-9+/=]+$/.test(String(p).trim())&&String(p).length>100&&(p=`data:image/jpeg;base64,${String(p).trim()}`),h.first_name=t,h.last_name=a,h.full_name=n,h.vin=r,h.number=r,h.dob=i,h.gender=s,h.state=o,h.lga=l,h.address=d,h.photo=p}h.generated_at=new Date().toLocaleString();let b=u.templateContent;b=b.replace(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g,(e,t)=>{let a=String(t),n=a.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,f)??(void 0!==h[a]?h[a]:void 0);return null!=n?String(n):""});try{let t=e.nextUrl?.origin||"";t&&(b=(b=b.replace(/\\+/g,"/")).replace(/(<img\s+[^>]*src=["'])\/(?!\/)([^"']+)(["'][^>]*>)/gi,`$1${t}/$2$3`))}catch{}let _=await (0,s.renderHtmlToPdfBuffer)(b),v=(()=>{switch(String(d)){case"bvn.retrieval_phone":return"bvn-by-phone-printout";case"bvn.printout":return"bvn-printout";default:return`${d}-slip`}})(),N=(p&&"string"==typeof p?p:`${v}-${Date.now()}`).replace(/[^a-zA-Z0-9._-]+/g,"-"),y=_ instanceof Buffer?new Uint8Array(_):_;return new n.NextResponse(y,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${N}.pdf"`}})}catch(e){return n.NextResponse.json({error:"Failed to generate PDF",detail:String(e?.message||e)},{status:500})}}[s]=l.then?(await l)():l,e.s(["POST",()=>d]),a()}catch(e){a(e)}},!1),852556,e=>e.a(async(t,a)=>{try{var n=e.i(747909),r=e.i(174017),i=e.i(996250),s=e.i(759756),o=e.i(561916),l=e.i(114444),d=e.i(837092),g=e.i(869741),p=e.i(316795),m=e.i(487718),u=e.i(995169),c=e.i(47587),f=e.i(666012),h=e.i(570101),b=e.i(626937),_=e.i(10372),v=e.i(193695);e.i(52474);var N=e.i(600220),y=e.i(229840),S=t([y]);[y]=S.then?(await S)():S;let k=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/pdf/route",pathname:"/api/pdf",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/pdf/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:A,workUnitAsyncStorage:C,serverHooks:O}=k;function R(){return(0,i.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:C})}async function w(e,t,a){k.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/pdf/route";n=n.replace(/\/index$/,"")||"/";let i=await k.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:S,nextConfig:R,parsedUrl:w,isDraftMode:A,prerenderManifest:C,routerServerContext:O,isOnDemandRevalidate:$,revalidateOnlyGenerated:E,resolvedPathname:x,clientReferenceManifest:U,serverActionsManifest:I}=i,j=(0,g.normalizeAppPath)(n),B=!!(C.dynamicRoutes[j]||C.routes[x]),D=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,w,!1):t.end("This page could not be found"),null);if(B&&!A){let e=!!C.routes[x],t=C.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await D();throw new v.NoFallbackError}}let T=null;!B||k.isDev||A||(T=x,T="/index"===T?"/":T);let P=!0===k.isDev||!B,M=B&&!P;I&&U&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:U,serverActionsManifest:I,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:I})});let q=e.method||"GET",H=(0,o.getTracer)(),V=H.getActiveScopeSpan(),F={params:S,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:P,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>k.onRequestError(e,t,n,O)},sharedContext:{buildId:y}},K=new p.NodeNextRequest(e),L=new p.NodeNextResponse(t),z=m.NextRequestAdapter.fromNodeNextRequest(K,(0,m.signalFromNodeResponse)(t));try{let i=async e=>k.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${n}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var o,d;let g=async({previousCacheEntry:r})=>{try{if(!l&&$&&E&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let o=F.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let d=F.renderOpts.collectedTags;if(!B)return await (0,f.sendResponse)(K,L,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[_.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:N.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:$})},O),t}},p=await k.handleResponse({req:e,nextConfig:R,cacheKey:T,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:E,responseGenerator:g,waitUntil:a.waitUntil,isMinimalMode:l});if(!B)return null;if((null==p||null==(o=p.value)?void 0:o.kind)!==N.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",$?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&B||m.delete(_.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,b.getCacheControlHeader)(p.cacheControl)),await (0,f.sendResponse)(K,L,new Response(p.value.body,{headers:m,status:p.value.status||200})),null};V?await d(V):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:$})}),B)throw t;return await (0,f.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>w,"patchFetch",()=>R,"routeModule",()=>k,"serverHooks",()=>O,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>C]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_7d0f1892._.js.map