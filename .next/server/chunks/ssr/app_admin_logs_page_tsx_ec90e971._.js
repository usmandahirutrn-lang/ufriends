module.exports=[161061,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(703130),e=a.i(340695),f=a.i(205522),g=a.i(917171),h=a.i(887682),i=a.i(588237),j=a.i(254161),k=a.i(965733),l=a.i(546893),m=a.i(277687),n=a.i(571987),o=a.i(773320),p=a.i(633508),q=a.i(104720);function r({log:a,open:d,onOpenChange:i,onUpdate:j}){let[r,s]=(0,c.useState)(a.status),[t,u]=(0,c.useState)(a.adminNotes||""),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(a.evidence?.url||null),[z,A]=(0,c.useState)(!1),{toast:B}=(0,m.useToast)();return(0,b.jsx)(k.Dialog,{open:d,onOpenChange:i,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Activity Log Details"}),(0,b.jsx)(k.DialogDescription,{children:"View and update details of a user service activity."})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"User Name"}),(0,b.jsx)("p",{className:"mt-2 font-medium",children:a.user})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Email"}),(0,b.jsx)("p",{className:"mt-2 font-medium",children:a.userEmail})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Reference ID"}),(0,b.jsx)("p",{className:"mt-2 font-mono text-sm",children:a.refId})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Date & Time"}),(0,b.jsx)("p",{className:"mt-2 font-medium",children:a.date})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Category"}),(0,b.jsx)("p",{className:"mt-2 font-medium",children:a.category})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Sub-Service"}),(0,b.jsx)("p",{className:"mt-2 font-medium",children:a.subService})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Request Details"}),(0,b.jsx)("p",{className:"mt-2 rounded-lg border bg-muted p-3 whitespace-pre-wrap font-mono text-sm",children:a.details})]}),a.photo&&(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Uploaded Photo"}),(0,b.jsx)("div",{className:"mt-2 rounded-lg border p-4",children:(0,b.jsx)(n.default,{src:a.photo||"/placeholder.svg",alt:"Uploaded document",width:200,height:200,className:"rounded-lg object-cover"})})]}),"Manual"===a.type&&(0,b.jsxs)("div",{className:"rounded-lg border border-primary/20 bg-primary/5 p-4",children:[(0,b.jsx)(g.Label,{className:"text-base font-semibold",children:"Completion Evidence"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Upload proof of completion (image or PDF)"}),x?(0,b.jsx)("div",{className:"mt-3 rounded-lg border bg-background p-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[v?.type.startsWith("image/")?(0,b.jsx)(n.default,{src:x||"/placeholder.svg",alt:"Evidence preview",width:80,height:80,className:"rounded-lg object-cover"}):(0,b.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-lg bg-muted",children:(0,b.jsx)(q.FileText,{className:"h-8 w-8 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:v?.name||a.evidence?.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:v?`${(v.size/1024).toFixed(2)} KB`:"Previously uploaded"})]})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{x&&x.startsWith("blob:")&&URL.revokeObjectURL(x),w(null),y(null)},className:"text-destructive hover:text-destructive",children:(0,b.jsx)(p.X,{className:"h-4 w-4"})})]})}):(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("label",{htmlFor:"evidence-upload",className:"flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-primary/30 bg-background p-6 transition-colors hover:border-primary/50 hover:bg-primary/5",children:[(0,b.jsx)(o.Upload,{className:"h-10 w-10 text-primary/60"}),(0,b.jsx)("p",{className:"mt-2 text-sm font-medium",children:"Click to upload evidence"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"JPG, PNG, or PDF (max 5MB)"})]}),(0,b.jsx)(f.Input,{id:"evidence-upload",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:a=>{let b=a.target.files?.[0];b&&(["image/jpeg","image/jpg","image/png","application/pdf"].includes(b.type)?b.size>5242880?B({title:"File Too Large",description:"Please upload a file smaller than 5MB.",variant:"destructive"}):(w(b),y(URL.createObjectURL(b))):B({title:"Invalid File Type",description:"Please upload a JPG, PNG, or PDF file.",variant:"destructive"}))},className:"hidden"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Status"}),(0,b.jsxs)(h.Select,{value:r,onValueChange:a=>s(a),children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"completed",children:"Completed"}),(0,b.jsx)(h.SelectItem,{value:"pending",children:"Pending"}),(0,b.jsx)(h.SelectItem,{value:"processing",children:"Processing"}),(0,b.jsx)(h.SelectItem,{value:"failed",children:"Failed"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Admin Notes"}),(0,b.jsx)(l.Textarea,{placeholder:"Add notes about this request...",value:t,onChange:a=>u(a.target.value),className:"mt-2",rows:4})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:["Manual"===a.type?(0,b.jsx)(e.Button,{onClick:()=>{"Manual"!==a.type||x||a.evidence?(A(!0),setTimeout(()=>{let b=v?{url:x,name:v.name,uploadedAt:new Date().toISOString()}:a.evidence;j({...a,status:"completed",evidence:b,adminNotes:t}),A(!1),B({title:"Service Marked as Completed",description:"Manual"===a.type?"Evidence uploaded successfully.":"Service completed."}),i(!1)},1e3)):B({title:"Evidence Required",description:"Please upload evidence before marking as completed.",variant:"destructive"})},className:"bg-green-600 hover:bg-green-700",disabled:z,children:z?"Uploading...":"Mark as Completed"}):(0,b.jsx)(e.Button,{onClick:()=>{j({...a,status:"completed",adminNotes:t}),B({title:"Request Approved",description:`${a.subService} request has been approved.`}),i(!1)},className:"bg-green-600 hover:bg-green-700",children:"Approve"}),(0,b.jsx)(e.Button,{variant:"destructive",onClick:()=>{j({...a,status:"failed",adminNotes:t}),B({title:"Request Rejected",description:`${a.subService} request has been rejected.`,variant:"destructive"}),i(!1)},children:"Reject"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{j({...a,status:"processing",adminNotes:t}),B({title:"Retry Initiated",description:`Retrying ${a.subService} request...`}),i(!1)},children:"Retry"}),(0,b.jsx)(e.Button,{variant:"secondary",onClick:()=>{j({...a,status:r,adminNotes:t}),B({title:"Log Updated",description:"Activity log has been updated successfully."}),i(!1)},children:"Save Changes"}),(0,b.jsx)(e.Button,{variant:"ghost",onClick:()=>i(!1),children:"Close"})]})]})]})})}var s=a.i(587532);let t=(0,a.i(170106).default)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);var u=a.i(677050),v=a.i(497895);function w(){let[a,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(""),[w,x]=(0,c.useState)("all"),[y,z]=(0,c.useState)("all"),[A,B]=(0,c.useState)(1),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null);(0,c.useEffect)(()=>{(0,u.authFetch)("/api/admin/audit-logs?take=200").then(a=>a.json().catch(()=>({}))).then(a=>{a?.ok&&Array.isArray(a.logs)&&k(a.logs.map(a=>({id:a.id,date:new Date(a.createdAt).toISOString().slice(0,16).replace("T"," "),user:a.actorId||"system",userEmail:"",category:"Transaction"===a.resourceType?a.diffJson?.serviceId||"Transaction":a.resourceType||"Audit",subService:a.diffJson?.subServiceId||a.diffJson?.action||a.action||"",details:(()=>{if(!a.diffJson)return"";let{params:b,amount:c,...d}=a.diffJson,e=[];if(c&&e.push(`Amount: ₦${c}`),b)for(let[a,c]of Object.entries(b))e.push(`${a}: ${c}`);return(d.error||d.reason)&&e.push(`Error: ${d.error||d.reason}`),e.join("\n")})(),status:"completed",refId:a.resourceId||a.id,type:"Automated"})))}).catch(()=>{}),(0,u.authFetch)("/api/admin/audit-logs?action=WALLET_ADMIN_ADJUST&take=100").then(a=>a.json().catch(()=>({}))).then(a=>{a?.ok&&Array.isArray(a.logs)&&D(a.logs)}).catch(()=>{})},[]);let K=async()=>{let a=E.trim();if(a){H(!0),J(null);try{let b=await (0,u.authFetch)(`/api/admin/service/logs/${encodeURIComponent(a)}`),c=await b.json().catch(()=>({}));b.ok&&c?.ok?J({transaction:c.transaction,auditLogs:c.auditLogs||[]}):J(null)}catch{J(null)}finally{H(!1)}}},L=a.filter(a=>{let b=a.user.toLowerCase().includes(p.toLowerCase())||a.subService.toLowerCase().includes(p.toLowerCase())||a.refId.toLowerCase().includes(p.toLowerCase()),c="all"===w||a.category===w,d="all"===y||a.status===y;return b&&c&&d}),M=Math.ceil(L.length/10),N=(A-1)*10,O=L.slice(N,N+10);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Service Activity Logs"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Track and manage all user service requests."})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Filters"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Search"}),(0,b.jsxs)("div",{className:"relative mt-2",children:[(0,b.jsx)(s.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"User, service, or ref ID...",value:p,onChange:a=>q(a.target.value),className:"pl-10"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Category"}),(0,b.jsxs)(h.Select,{value:w,onValueChange:x,children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Categories"}),(0,b.jsx)(h.SelectItem,{value:"BVN",children:"BVN"}),(0,b.jsx)(h.SelectItem,{value:"NIN",children:"NIN"}),(0,b.jsx)(h.SelectItem,{value:"CAC",children:"CAC"}),(0,b.jsx)(h.SelectItem,{value:"VTU",children:"VTU"}),(0,b.jsx)(h.SelectItem,{value:"Bills",children:"Bills"}),(0,b.jsx)(h.SelectItem,{value:"Verification",children:"Verification"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Status"}),(0,b.jsxs)(h.Select,{value:y,onValueChange:z,children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Statuses"}),(0,b.jsx)(h.SelectItem,{value:"completed",children:"Completed"}),(0,b.jsx)(h.SelectItem,{value:"pending",children:"Pending"}),(0,b.jsx)(h.SelectItem,{value:"processing",children:"Processing"}),(0,b.jsx)(h.SelectItem,{value:"failed",children:"Failed"})]})]})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{q(""),x("all"),z("all")},className:"w-full",children:"Clear Filters"})})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Wallet Adjustments"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Date"}),(0,b.jsx)(i.TableHead,{children:"User ID"}),(0,b.jsx)(i.TableHead,{children:"Amount"}),(0,b.jsx)(i.TableHead,{children:"Reason"}),(0,b.jsx)(i.TableHead,{children:"Admin"})]})}),(0,b.jsx)(i.TableBody,{children:C.filter(a=>!p||(a.resourceId||"").toLowerCase().includes(p.toLowerCase())).map(a=>{let c=Number(a?.diffJson?.delta??0),d=String(a?.diffJson?.reason??"");return(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"text-sm",children:new Date(a.createdAt).toLocaleString()}),(0,b.jsx)(i.TableCell,{className:"text-sm font-mono",children:a.resourceId}),(0,b.jsxs)(i.TableCell,{className:"text-sm font-semibold",children:["₦",c.toLocaleString()]}),(0,b.jsx)(i.TableCell,{className:"text-sm",children:d||"—"}),(0,b.jsx)(i.TableCell,{className:"text-sm font-mono",children:a.actorId||"—"})]},a.id)})})]})})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Lookup by Reference"})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 items-end",children:[(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)(g.Label,{children:"Transaction Reference"}),(0,b.jsx)(f.Input,{value:E,onChange:a=>F(a.target.value),placeholder:"Enter reference (e.g., TXR-12345)",className:"mt-2 font-mono"})]}),(0,b.jsx)("div",{children:(0,b.jsx)(e.Button,{onClick:K,disabled:G||!E.trim(),className:"w-full",children:G?"Searching...":"Search"})})]}),I&&(0,b.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Reference"}),(0,b.jsx)("p",{className:"mt-2 font-mono text-sm",children:I.transaction.reference})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Status"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(j.Badge,{variant:"SUCCESS"===I.transaction.status?"default":"PENDING"===I.transaction.status?"secondary":"PROCESSING"===I.transaction.status?"outline":"destructive",children:I.transaction.status})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Amount"}),(0,b.jsxs)("p",{className:"mt-2 font-semibold",children:["₦",Number(I.transaction.amount||0).toLocaleString()]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"User ID"}),(0,b.jsx)("p",{className:"mt-2 font-mono text-sm",children:I.transaction.userId})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Provider"}),(0,b.jsx)("p",{className:"mt-2",children:I.transaction.provider?`${I.transaction.provider.name} (${I.transaction.provider.category})`:"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Created"}),(0,b.jsx)("p",{className:"mt-2",children:new Date(I.transaction.createdAt).toLocaleString()})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Metadata"}),(0,b.jsx)("p",{className:"mt-2 rounded-lg border bg-muted p-3 text-xs overflow-auto",children:JSON.stringify(I.transaction.meta||{},null,2)})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Date"}),(0,b.jsx)(i.TableHead,{children:"Action"}),(0,b.jsx)(i.TableHead,{children:"Resource"}),(0,b.jsx)(i.TableHead,{children:"Details"})]})}),(0,b.jsx)(i.TableBody,{children:(I.auditLogs||[]).map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"text-sm",children:new Date(a.createdAt).toLocaleString()}),(0,b.jsx)(i.TableCell,{className:"text-sm",children:a.action}),(0,b.jsxs)(i.TableCell,{className:"text-sm",children:[a.resourceType,":",a.resourceId]}),(0,b.jsx)(i.TableCell,{className:"text-xs max-w-md truncate",children:JSON.stringify(a.diffJson||{})})]},a.id))})]})})]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{children:["Activity Logs (",L.length," results)"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Date"}),(0,b.jsx)(i.TableHead,{children:"User"}),(0,b.jsx)(i.TableHead,{children:"Category"}),(0,b.jsx)(i.TableHead,{children:"Sub-Service"}),(0,b.jsx)(i.TableHead,{children:"Details"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Evidence"}),(0,b.jsx)(i.TableHead,{children:"Action"})]})}),(0,b.jsx)(i.TableBody,{children:O.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.date}),(0,b.jsx)(i.TableCell,{children:a.user}),(0,b.jsx)(i.TableCell,{children:a.category}),(0,b.jsx)(i.TableCell,{children:a.subService}),(0,b.jsx)(i.TableCell,{className:"max-w-xs truncate",children:a.details}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(j.Badge,{variant:"completed"===a.status?"default":"pending"===a.status?"secondary":"processing"===a.status?"outline":"destructive",children:a.status})}),(0,b.jsx)(i.TableCell,{children:a.evidence?(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.evidence,void window.open((0,v.ensureAbsoluteUrl)(b.url),"_blank")},className:"gap-1",children:[(0,b.jsx)(t,{className:"h-4 w-4"}),"View"]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>{m(a),o(!0)},children:"View"})})]},a.id))})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing ",N+1," to ",Math.min(N+10,L.length)," of"," ",L.length," results"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.max(1,a-1)),disabled:1===A,children:"Previous"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.min(M,a+1)),disabled:A===M,children:"Next"})]})]})]})]}),l&&(0,b.jsx)(r,{log:l,open:n,onOpenChange:o,onUpdate:b=>{k(a.map(a=>a.id===b.id?b:a))}})]})}a.s(["default",()=>w],161061)}];

//# sourceMappingURL=app_admin_logs_page_tsx_ec90e971._.js.map