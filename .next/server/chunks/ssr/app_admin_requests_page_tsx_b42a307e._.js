module.exports=[910306,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(587532),e=a.i(581464),f=a.i(167453),g=a.i(862722),h=a.i(641710),i=a.i(170106);let j=(0,i.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),k=(0,i.default)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);var l=a.i(292e3),m=a.i(177156),n=a.i(340695),o=a.i(205522),p=a.i(703130),q=a.i(588237),r=a.i(676504),s=a.i(965733),t=a.i(917171),u=a.i(546893),v=a.i(277687),w=a.i(254161);function x(){var a;let[i,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)("all"),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(!1),S=(0,c.useRef)(null),{toast:T}=(0,v.useToast)(),U=async()=>{z(!0);try{let a=new URLSearchParams;"all"!==C&&a.append("status",C);let b=await fetch(`/api/admin/requests?${a.toString()}`),c=await b.json();c.data&&x(c.data)}catch(a){T({title:"Error",description:"Failed to load requests",variant:"destructive"})}finally{z(!1)}};(0,c.useEffect)(()=>{U()},[C]);let V=async()=>{if(E&&I){P(!0);try{let a=await fetch("/api/admin/requests",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:E.id,status:I,adminNotes:K,proofUrl:M})});if(a.ok)T({title:"Success",description:`Request updated to ${I}`}),H(!1),U();else{let b=await a.json();throw Error(b.error||"Failed to update")}}catch(a){T({title:"Error",description:a.message,variant:"destructive"})}finally{P(!1)}}},W=async a=>{let b=a.target.files?.[0];if(b){R(!0);try{let a=new FormData;a.append("file",b);let c=await fetch("/api/admin/requests/upload",{method:"POST",body:a}),d=await c.json();c.ok?(N(d.fileUrl),T({title:"Success",description:`File uploaded: ${d.fileName}`})):T({title:"Error",description:d.error||"Upload failed",variant:"destructive"})}catch(a){T({title:"Error",description:"Failed to upload file",variant:"destructive"})}finally{R(!1)}}},X=i.filter(a=>a.reference.toLowerCase().includes(A.toLowerCase())||a.user.email.toLowerCase().includes(A.toLowerCase())||a.category.toLowerCase().includes(A.toLowerCase()));return(0,b.jsxs)("div",{className:"p-6 space-y-8 min-h-screen bg-[#F9F7F3]",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-[#3457D5]",children:"Service Requests"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage and track manual service executions"})]}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsx)(n.Button,{onClick:U,variant:"outline",className:"bg-white",children:"Refresh"})})]}),(0,b.jsxs)(p.Card,{className:"border-[#CCCCFF]/30 shadow-md",children:[(0,b.jsx)(p.CardHeader,{className:"bg-gradient-to-r from-[#3457D5]/5 to-transparent border-b",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-4",children:[(0,b.jsxs)("div",{className:"relative w-full md:w-96",children:[(0,b.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(o.Input,{placeholder:"Search by reference, email, or service...",className:"pl-9 bg-white",value:A,onChange:a=>B(a.target.value)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[(0,b.jsx)(e.Filter,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("select",{className:"bg-white border rounded-md h-10 px-3 text-sm focus:ring-2 ring-[#3457D5]/20 outline-none",value:C,onChange:a=>D(a.target.value),children:[(0,b.jsx)("option",{value:"all",children:"All Statuses"}),(0,b.jsx)("option",{value:"SUBMITTED",children:"Submitted"}),(0,b.jsx)("option",{value:"ONGOING",children:"Ongoing"}),(0,b.jsx)("option",{value:"SUCCESS",children:"Completed"}),(0,b.jsx)("option",{value:"REJECTED",children:"Rejected"}),(0,b.jsx)("option",{value:"CANCELLED",children:"Cancelled"})]})]})]})}),(0,b.jsx)(p.CardContent,{className:"p-0",children:(0,b.jsxs)(q.Table,{children:[(0,b.jsx)(q.TableHeader,{children:(0,b.jsxs)(q.TableRow,{className:"hover:bg-transparent",children:[(0,b.jsx)(q.TableHead,{className:"w-[150px]",children:"Date & Ref"}),(0,b.jsx)(q.TableHead,{children:"User / Email"}),(0,b.jsx)(q.TableHead,{children:"Service"}),(0,b.jsx)(q.TableHead,{children:"Amount"}),(0,b.jsx)(q.TableHead,{children:"Status"}),(0,b.jsx)(q.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(q.TableBody,{children:y?(0,b.jsx)(q.TableRow,{children:(0,b.jsx)(q.TableCell,{colSpan:6,className:"text-center py-10",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)(h.Clock,{className:"h-8 w-8 text-[#3457D5] animate-spin"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Loading requests..."})]})})}):0===X.length?(0,b.jsx)(q.TableRow,{children:(0,b.jsx)(q.TableCell,{colSpan:6,className:"text-center py-10",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)(l.AlertCircle,{className:"h-8 w-8 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"No requests found"})]})})}):X.map(a=>(0,b.jsxs)(q.TableRow,{children:[(0,b.jsxs)(q.TableCell,{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:new Date(a.createdAt).toLocaleDateString()}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground font-mono",children:a.reference})]}),(0,b.jsxs)(q.TableCell,{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:a.user.profile?.name||"No name"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.user.email})]}),(0,b.jsxs)(q.TableCell,{children:[(0,b.jsx)("div",{className:"text-sm font-medium uppercase",children:a.category}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.subservice||"N/A"})]}),(0,b.jsxs)(q.TableCell,{className:"font-semibold",children:["₦",a.amount.toLocaleString()]}),(0,b.jsx)(q.TableCell,{children:(a=>{switch(a){case"SUBMITTED":return(0,b.jsx)(w.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Submitted"});case"ONGOING":return(0,b.jsx)(w.Badge,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Ongoing"});case"SUCCESS":return(0,b.jsx)(w.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Completed"});case"REJECTED":return(0,b.jsx)(w.Badge,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:"Rejected"});case"CANCELLED":return(0,b.jsx)(w.Badge,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:"Cancelled"});default:return(0,b.jsx)(w.Badge,{variant:"outline",children:a})}})(a.status)}),(0,b.jsx)(q.TableCell,{className:"text-right",children:(0,b.jsxs)(r.DropdownMenu,{children:[(0,b.jsx)(r.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,b.jsx)(j,{className:"h-4 w-4"})})}),(0,b.jsxs)(r.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,b.jsxs)(r.DropdownMenuItem,{onClick:()=>{F(a),J("ONGOING"),L(a.adminNotes||""),N(a.proofUrl||""),H(!0)},children:[(0,b.jsx)(h.Clock,{className:"mr-2 h-4 w-4"})," Start Working"]}),(0,b.jsxs)(r.DropdownMenuItem,{className:"text-green-600",onClick:()=>{F(a),J("SUCCESS"),L(a.adminNotes||""),N(a.proofUrl||""),H(!0)},children:[(0,b.jsx)(f.CheckCircle2,{className:"mr-2 h-4 w-4"})," Mark Complete"]}),(0,b.jsx)(r.DropdownMenuSeparator,{}),(0,b.jsxs)(r.DropdownMenuItem,{className:"text-red-600",onClick:()=>{F(a),J("REJECTED"),L(a.adminNotes||""),N(""),H(!0)},children:[(0,b.jsx)(g.XCircle,{className:"mr-2 h-4 w-4"})," Reject"]}),(0,b.jsxs)(r.DropdownMenuItem,{className:"text-gray-600",onClick:()=>{F(a),J("CANCELLED"),L(a.adminNotes||""),N(""),H(!0)},children:[(0,b.jsx)(g.XCircle,{className:"mr-2 h-4 w-4"})," Cancel"]})]})]})})]},a.id))})]})})]}),(0,b.jsx)(s.Dialog,{open:G,onOpenChange:H,children:(0,b.jsxs)(s.DialogContent,{children:[(0,b.jsxs)(s.DialogHeader,{children:[(0,b.jsxs)(s.DialogTitle,{children:["ONGOING"===I&&"Start Processing Request","SUCCESS"===I&&"Complete Request","REJECTED"===I&&"Reject Request","CANCELLED"===I&&"Cancel Request"]}),(0,b.jsxs)(s.DialogDescription,{children:["Action for reference: ",(0,b.jsx)("span",{className:"font-mono font-bold",children:E?.reference})]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto pr-2",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Eye,{className:"h-4 w-4 text-[#3457D5]"}),(0,b.jsx)("h3",{className:"text-sm font-bold text-foreground font-sans",children:"User Submitted Details"})]}),(a=E?.meta?.params)?(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 p-3 bg-muted/30 rounded-lg border border-border/50",children:Object.entries(a).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-wider",children:a.replace(/([A-Z])/g," $1").trim()}),(0,b.jsx)("p",{className:"text-sm font-medium break-all",children:String(c)})]},a))}):(0,b.jsx)("span",{className:"text-muted-foreground italic text-xs",children:"No parameters provided"})]}),(0,b.jsx)(r.DropdownMenuSeparator,{className:"my-4"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"notes",children:"Admin Notes"}),(0,b.jsx)(u.Textarea,{id:"notes",placeholder:"Message to the user...",value:K,onChange:a=>L(a.target.value)}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground italic",children:"Admin notes are visible to the user."})]}),"SUCCESS"===I&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{children:"Proof of Completion"}),(0,b.jsx)("input",{ref:S,type:"file",accept:"image/*,application/pdf,.doc,.docx,.xls,.xlsx",onChange:W,className:"hidden"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(o.Input,{id:"proof",placeholder:"https://... or upload a file",value:M,onChange:a=>N(a.target.value)}),(0,b.jsx)(n.Button,{size:"icon",variant:"outline",title:"Upload file",onClick:()=>S.current?.click(),disabled:Q,children:Q?(0,b.jsx)(h.Clock,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(k,{className:"h-4 w-4"})})]}),M&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-green-600 bg-green-50 p-2 rounded",children:[(0,b.jsx)(f.CheckCircle2,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"truncate",children:M})]}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Enter a link OR upload image/PDF/Word/Excel file (max 10MB)."})]}),("REJECTED"===I||"CANCELLED"===I)&&(0,b.jsxs)("div",{className:"p-3 bg-red-50 border border-red-100 rounded-md flex gap-2",children:[(0,b.jsx)(l.AlertCircle,{className:"h-5 w-5 text-red-600 shrink-0"}),(0,b.jsxs)("p",{className:"text-xs text-red-700",children:["This will refund ₦",E?.amount.toLocaleString()," back to the user's wallet."]})]})]}),(0,b.jsxs)(s.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),(0,b.jsx)(n.Button,{onClick:V,disabled:O,className:"SUCCESS"===I?"bg-green-600 hover:bg-green-700":"REJECTED"===I?"bg-red-600 hover:bg-red-700":"bg-[#3457D5]",children:O?"Saving...":"Confirm Action"})]})]})})]})}a.s(["default",()=>x],910306)}];

//# sourceMappingURL=app_admin_requests_page_tsx_b42a307e._.js.map