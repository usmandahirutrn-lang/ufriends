module.exports=[642192,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(703130),e=a.i(340695),f=a.i(205522),g=a.i(917171),h=a.i(887682),i=a.i(588237),j=a.i(254161),k=a.i(277687),l=a.i(669520),m=a.i(677050);function n(){let{toast:a}=(0,k.useToast)(),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)({basePrice:0,userPrice:0,marketerPrice:0}),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)({}),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),N={"airtime.vtu":{network:["mtn","airtel","glo","9mobile"]},"airtime.airtime-2-cash":{network:["mtn","airtel","glo","9mobile"]},"airtime.share-n-sell":{network:["mtn","airtel","glo","9mobile"]},"data.sme":{network:["mtn","airtel","glo","9mobile"],size:["500mb","1gb","2gb","3gb","4gb","5gb","10gb"]},"data.gift":{network:["mtn","airtel","glo","9mobile"],size:["500mb","1gb","2gb","3gb","4gb","5gb","10gb"]},"data.corporate":{network:["mtn","airtel","glo","9mobile"],size:["1gb","2gb","3gb","4gb","5gb","10gb","25gb","50gb"]},"bvn.retrieval":{method:["phone","bank"]},"voters-card.basic":{slipType:["basic","full"]},"voters-card.full":{slipType:["basic","full"]},"tin.basic":{slipType:["basic","certificate"]},"tin.certificate":{slipType:["basic","certificate"]},"nin.slip":{slipType:["standard","premium","regular"]},"nin.advanced":{slipType:["basic","standard","regular","premium"]},"cac.info":{companyType:["RC","BN","IT"]},"cac.status":{companyType:["RC","BN","IT"]},"cac.retrieval":{companyType:["RC","BN","IT"]},"cac.status report":{companyType:["RC","BN","IT"]},"cac.status-report":{companyType:["RC","BN","IT"]},"bills.electricity":{serviceProvider:["ikeja","eko","abuja","ibadan","enugu","portharcourt","jos","kano"]},"education.waec":{serviceType:["waec-pin","gce-registration-pin"]},"education.neco":{serviceType:["neco-pin","gce-registration-pin"]},"education.nabteb":{serviceType:["nabteb-pin","gce-registration-pin"]},"education.nbais":{serviceType:["nbais-pin","gce-registration-pin"]},"education.jamb":{serviceType:["profile-code","print-admission-letter","original-result","olevel-upload","check-admission-status","acceptance"]},"education.nysc":{requestType:["verification","reprint","call-up-letter","certificate-retrieval"]}},O=(a,b,c)=>{let d=(a||"").trim().toLowerCase(),e=(b||"").trim().toLowerCase(),f=(c||"").trim().toLowerCase();return f?`${d}.${e}.${f}`:`${d}.${e}`};(0,c.useEffect)(()=>{let b=!0;return q(!0),(0,m.authFetch)("/api/service-catalog").then(async a=>{if(!a.ok)throw Error("Failed to load catalog");let c=await a.json();b&&o(c)}).catch(b=>{a({title:"Error",description:String(b),variant:"destructive"})}).finally(()=>b&&q(!1)),()=>{b=!1}},[a]),(0,c.useMemo)(()=>Array.from(new Set(n.map(a=>a.category))),[n]);let P=["data"],Q={data:["sme","corporate","gift"]},R=(0,c.useMemo)(()=>Array.from(new Set([...Array.from(new Set(n.map(a=>a.category))),...P])),[n]),S=(0,c.useMemo)(()=>Array.from(new Set([...Array.from(new Set(n.filter(a=>a.category===t).map(a=>a.subservice))),...Q[t]||[]])),[n,t]),T=(0,c.useMemo)(()=>Array.from(new Set(n.filter(a=>a.category===t&&a.subservice===v).map(a=>a.variant&&a.variant.trim()?a.variant.trim():"__NONE__"))),[n,t,v]);(0,c.useEffect)(()=>{w(""),y(""),A(null),E({}),G({}),I([])},[t]),(0,c.useEffect)(()=>{y(""),A(null),E({}),G({}),I([])},[v]),(0,c.useEffect)(()=>{if(!(t&&v))return;let a=x||"",b=O(t,v,a),c=O(t,v,""),d=N[b]||{},e=N[c]||{},f={};for(let[a,b]of Object.entries({...e,...d})){let c=Array.from(new Set((b||[]).map(a=>String(a).toLowerCase())));f[a]=c}(0,m.authFetch)(`/api/pricing/parameters?category=${encodeURIComponent(t)}&subservice=${encodeURIComponent(v)}&variant=${encodeURIComponent(a)}`).then(async a=>{let b=await a.json();if(!a.ok||b.error)return;let c=b.options||{},d={};for(let a of new Set([...Object.keys(f),...Object.keys(c||{})]).values()){let b=Array.from(new Set([...f[a]||[],...c&&c[a]||[]].map(a=>String(a).toLowerCase()))).sort();b.length&&(d[a]=b)}E(d),H.length||I(Object.keys(d).map(a=>({key:a,value:""})))}).catch(()=>{});let g=new URLSearchParams({category:t,subservice:v,variant:a,role:"user"});Object.entries(F).forEach(([a,b])=>g.append(a,String(b))),(0,m.authFetch)(`/api/pricing?${g.toString()}`).then(async a=>{let b=await a.json();if(!a.ok||b.error){A(null),C({basePrice:0,userPrice:0,marketerPrice:0});return}let c={basePrice:Number(b.pricing?.basePrice??0),userPrice:Number(b.pricing?.userPrice??0),marketerPrice:Number(b.pricing?.marketerPrice??0)};A(c),C(c)}).catch(()=>{A(null),C({basePrice:0,userPrice:0,marketerPrice:0})})},[t,v,x,F,H.length]);let U=(0,c.useMemo)(()=>B.basePrice?Number(((B.userPrice-B.basePrice)/B.basePrice*100).toFixed(2)):0,[B]),V=(0,c.useMemo)(()=>B.basePrice?Number(((B.marketerPrice-B.basePrice)/B.basePrice*100).toFixed(2)):0,[B]),W=async()=>{if(!t||!v)return void a({title:"Select a catalog entry",description:"Choose category, subservice, and variant.",variant:"destructive"});s(!0);try{let b=await (0,m.authFetch)("/api/admin/pricing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:t,subservice:v,variant:x||"",basePrice:Number(B.basePrice),userPrice:Number(B.userPrice),marketerPrice:Number(B.marketerPrice),parameters:Object.fromEntries(H.map(a=>[a.key.trim(),a.value]).filter(([a,b])=>!!a&&void 0!==b&&String(b).length>0))})}),c=await b.json();if(!b.ok||c.error)throw Error(c.error||"Failed to save pricing");a({title:"Pricing saved",description:"Catalog pricing updated successfully."}),A({...B})}catch(b){a({title:"Save failed",description:String(b),variant:"destructive"})}finally{s(!1)}};return(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{children:"Pricing & Profit Manager"}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{q(!0),(0,m.authFetch)("/api/service-catalog").then(async a=>o(await a.json())).finally(()=>q(!1))},children:[(0,b.jsx)(l.RefreshCw,{className:"mr-2 h-4 w-4"})," Reload"]})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Category"}),(0,b.jsxs)(h.Select,{value:t,onValueChange:a=>u(a),children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select category"})}),(0,b.jsx)(h.SelectContent,{children:R.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Subservice"}),(0,b.jsxs)(h.Select,{value:v,onValueChange:a=>w(a),disabled:!t,children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select subservice"})}),(0,b.jsx)(h.SelectContent,{children:S.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{children:"Variant"}),(0,b.jsxs)(h.Select,{value:x,onValueChange:a=>y("__NONE__"===a?"":a),disabled:!v,children:[(0,b.jsx)(h.SelectTrigger,{className:"mt-2",children:(0,b.jsx)(h.SelectValue,{placeholder:"Optional variant"})}),(0,b.jsx)(h.SelectContent,{children:T.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:"__NONE__"===a?"—":a},a))})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(g.Label,{children:"Parameters"}),(0,b.jsxs)("div",{className:"space-y-2",children:[H.map((a,c)=>{let d=a.key&&D[a.key]?D[a.key]:[];return(0,b.jsxs)("div",{className:"grid gap-2 md:grid-cols-3 items-center",children:[(0,b.jsx)(f.Input,{placeholder:"Parameter name (e.g., network)",value:a.key,onChange:b=>{let d=[...H];d[c]={...a,key:b.target.value},I(d)}}),d&&d.length>0?(0,b.jsxs)(h.Select,{value:a.value,onValueChange:b=>{let d=[...H];d[c]={...a,value:b},I(d),G(c=>({...c,[a.key]:b}))},children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select value"})}),(0,b.jsx)(h.SelectContent,{children:d.map(a=>(0,b.jsx)(h.SelectItem,{value:a,children:a},a))})]}):(0,b.jsx)(f.Input,{placeholder:"Value (e.g., MTN)",value:a.value,onChange:b=>{let d=b.target.value,e=[...H];e[c]={...a,value:d},I(e),a.key&&G(b=>({...b,[a.key]:d}))}}),(0,b.jsx)(e.Button,{variant:"ghost",onClick:()=>{let a=[...H],b=a.splice(c,1);I(a),G(a=>{let c={...a};return b[0]?.key&&delete c[b[0].key],c})},children:"Remove"})]},`${a.key}-${c}`)}),(0,b.jsxs)("div",{className:"grid gap-2 md:grid-cols-3 items-center",children:[(0,b.jsx)(f.Input,{placeholder:"New parameter name",value:J,onChange:a=>K(a.target.value)}),(0,b.jsx)(f.Input,{placeholder:"New parameter value",value:L,onChange:a=>M(a.target.value)}),(0,b.jsx)(e.Button,{variant:"secondary",onClick:()=>{let a=J.trim();a&&(I(b=>[...b,{key:a,value:L}]),G(b=>({...b,[a]:L})),K(""),M(""))},disabled:!J.trim(),children:"Add Parameter"})]})]})]}),(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Type"}),(0,b.jsx)(i.TableHead,{children:"Amount"}),(0,b.jsx)(i.TableHead,{children:"Margin %"})]})}),(0,b.jsxs)(i.TableBody,{children:[(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(j.Badge,{variant:"secondary",children:"Base"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(f.Input,{type:"number",value:B.basePrice,onChange:a=>C({...B,basePrice:Number(a.target.value)})})}),(0,b.jsx)(i.TableCell,{className:"text-muted-foreground",children:"—"})]}),(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(j.Badge,{children:"User"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(f.Input,{type:"number",value:B.userPrice,onChange:a=>C({...B,userPrice:Number(a.target.value)})})}),(0,b.jsxs)(i.TableCell,{className:U>=0?"text-green-600":"text-red-600",children:[U,"%"]})]}),(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(j.Badge,{children:"Marketer"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(f.Input,{type:"number",value:B.marketerPrice,onChange:a=>C({...B,marketerPrice:Number(a.target.value)})})}),(0,b.jsxs)(i.TableCell,{className:V>=0?"text-green-600":"text-red-600",children:[V,"%"]})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(e.Button,{onClick:W,disabled:r||!t||!v,children:r?"Saving...":"Save Pricing"}),z&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground self-center",children:["Last saved: Base ₦",z.basePrice," • User ₦",z.userPrice," • Marketer ₦",z.marketerPrice]})]})]})]})})}a.s(["default",()=>n])}];

//# sourceMappingURL=app_admin_pricing_page_tsx_554348d5._.js.map