module.exports=[167453,a=>{"use strict";let b=(0,a.i(170106).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);a.s(["CheckCircle2",()=>b],167453)},370975,a=>{"use strict";var b=a.i(572131),c=a.i(677050);function d(a){try{let b=String(a?.role||"").toLowerCase(),c=Array.isArray(a?.roles)?a.roles.map(a=>String(a).toLowerCase()):[];return b.includes("marketer")||c.includes("marketer")||a?.isMarketer===!0?"marketer":"user"}catch{return"user"}}async function e(){try{let a=await fetch("/api/me");if(!a.ok)return"user";let b=await a.json().catch(()=>null);return d(b?.user||b)}catch{return"user"}}function f(a,f,g,h,i){let[j,k]=(0,b.useState)(()=>d(i)),[l,m]=(0,b.useState)(null),[n,o]=(0,b.useState)(!1),[p,q]=(0,b.useState)(null),[r,s]=(0,b.useState)(void 0),t=(0,b.useMemo)(()=>({category:String(a||"").trim(),subservice:String(f||"").trim(),variant:String(g||"").trim()}),[a,f,g]),u=(0,b.useMemo)(()=>{if(!h||"object"!=typeof h)return"";let a=Object.entries(h).filter(([a,b])=>null!=b);return a.length?(a.sort(([a],[b])=>a.localeCompare(b)),a.map(([a,b])=>`${a}=${String(b)}`).join("|")):""},[h]);return(0,b.useEffect)(()=>{let a=!1;return(async()=>{o(!0),q(null);try{let b=i?d(i):await e();a||k(b);let c=[["category",t.category],["subservice",t.subservice],["variant",t.variant],["role",b]];if(h&&"object"==typeof h){let a=Object.entries(h).filter(([a,b])=>null!=b);for(let[b,d]of(a.sort(([a],[b])=>a.localeCompare(b)),a))c.push([b,String(d)])}let f=new URLSearchParams(c),g=await fetch(`/api/pricing?${f.toString()}`,{cache:"no-store"}),j=await g.json().catch(()=>null);if(!g.ok)throw Error(String(j?.error||"Failed to load pricing"));let l=j?.price;m("number"==typeof l?l:null)}catch(a){q(a?.message||"Failed to fetch pricing"),m(null)}finally{a||o(!1)}})(),()=>{a=!0}},[t.category,t.subservice,t.variant,u,i]),{price:l,isLoading:n,error:p,reference:r,submitService:(0,b.useCallback)(async a=>{try{let b={amount:Number(a.amount),idempotencyKey:"string"==typeof a.idempotencyKey?a.idempotencyKey:void 0,params:{...a||{}},subServiceId:t.variant||void 0,action:function(a,b){let c=a.trim().toLowerCase(),d=b.trim().toLowerCase();if("nin"===c){if("slip"===d)return"nin.slip";if("printout"===d)return"nin.printout";if("advanced"===d||"verification"===d)return"nin.advanced"}if("bvn"===c){if("printout"===d)return"bvn.printout";if("retrieval"===d||"retrieval_phone"===d)return"bvn.retrieval_phone";if("advanced"===d||"verification"===d)return"bvn.advanced"}if("cac"===c){if("info"===d)return"cac.info";if("status"===d)return"cac.status"}return"passport"===c&&("verify"===d||"verification"===d||"basic"===d)?"passport.verify":"phone"===c&&("advanced"===d||"verification"===d||"basic"===d)?"phone.verify_advanced":("driver-license"===c||"drivers_license"===c)&&("basic"===d||"verification"===d)?"drivers_license.verify":("voters-card"===c||"voters"===c)&&("basic"===d||"full"===d||"verification"===d)?"voters.verify":("plate-number"===c||"plate"===c)&&("basic"===d||"verification"===d)?"plate.verify":"tin"===c&&("basic"===d||"certificate"===d||"verification"===d)?"tin.verify":null}(t.category,t.subservice)||void 0,pin:a.pin},d=await (0,c.authFetch)(`/api/service/${encodeURIComponent(t.category)}/${encodeURIComponent(t.subservice)}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(b)}),e=await d.json().catch(()=>null);if(!d.ok)return{ok:!1,error:String(e?.error||`Service failed (${d.status})`),message:String(e?.message||"Failed"),data:e};return s(String(e?.reference||"")),{ok:!0,reference:String(e?.reference||""),message:String(e?.message||""),data:e}}catch(a){return{ok:!1,error:String(a?.message||a)}}},[t.category,t.subservice,t.variant])}}a.s(["default",0,f,"useDynamicPricing",()=>f])},464286,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(965733),e=a.i(340695),f=a.i(205522),g=a.i(917171),h=a.i(823292);function i({isOpen:a,onClose:i,onConfirm:j,isLoading:k}){let[l,m]=(0,c.useState)(""),n=()=>{4!==l.length?h.toast.error("Please enter a 4-digit PIN"):(j(l),m(""))};return(0,b.jsx)(d.Dialog,{open:a,onOpenChange:a=>!a&&i(),children:(0,b.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(d.DialogHeader,{children:[(0,b.jsx)(d.DialogTitle,{children:"Enter Transaction PIN"}),(0,b.jsx)(d.DialogDescription,{children:"Please enter your 4-digit transaction PIN to authorize this request."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"pin",className:"text-center block",children:"PIN"}),(0,b.jsx)(f.Input,{id:"pin",type:"password",inputMode:"numeric",maxLength:4,value:l,onChange:a=>m(a.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-[1em]",placeholder:"••••",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&n()}})]})}),(0,b.jsxs)(d.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:i,disabled:k,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:n,disabled:k||4!==l.length,className:"bg-[#3457D5]",children:k?"Verifying...":"Confirm PIN"})]})]})})}a.s(["PinPrompt",()=>i])},487228,a=>{"use strict";function b(a,c,d="Error"){c({title:d,description:a.error||a.message||"An unexpected error occurred",variant:"destructive"})}a.s(["handleServiceError",()=>b])},790166,a=>{"use strict";let b=(0,a.i(170106).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);a.s(["DollarSign",()=>b],790166)},611602,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(370975),e=a.i(703130),f=a.i(340695),g=a.i(205522),h=a.i(917171),i=a.i(887682),j=a.i(965733),k=a.i(277687),l=a.i(790166),m=a.i(167453),n=a.i(464286),o=a.i(487228);function p(){var a;let p,[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),{toast:K}=(0,k.useToast)(),{price:L,isLoading:M,error:N,submitService:O}=(0,d.default)("airtime","airtime-2-cash","",q?{network:({MTN:"mtn",GLO:"glo",AIRTEL:"airtel","9MOBILE":"9mobile"})[a=String(q)]||a.toLowerCase()}:void 0);(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/me"),b=a.ok?await a.json():null,c=b?.user?.role||b?.role||"",d=b?.user?.roles||[],e=/MARKETER/i.test(c)||d.includes("MARKETER");z(!!e)}catch{z(!1)}})()},[]);let{payout:P,mode:Q}=(p=Number(u)||0,"number"==typeof L?L>0&&L<=1.5?{payout:Math.round(p*L),mode:`Rate x${L}`}:{payout:Math.max(0,Math.round(p-L)),mode:`Fee ₦${L}`}:{payout:0,mode:"Pricing unavailable"}),R=async a=>{(a.preventDefault(),q&&s&&u)?11!==String(s).replace(/\D/g,"").length?K({title:"Invalid Number",description:"Phone number must be 11 digits",variant:"destructive"}):50>Number(u)?K({title:"Amount Too Low",description:"Minimum amount is ₦50",variant:"destructive"}):"number"!=typeof L?K({title:"Pricing Unavailable",description:"Live pricing could not be fetched.",variant:"destructive"}):(J({amount:Number(u),phone:s,network:q,idempotencyKey:crypto.randomUUID(),category:"airtime",action:"airtime-2-cash"}),H(!0)):K({title:"Missing Information",description:"Please fill in all fields",variant:"destructive"})},S=async a=>{H(!1),x(!0);try{let b=await O({...I,pin:a});if(!b?.ok)return void(0,o.handleServiceError)(b,K,"Submission Failed");F(b?.reference||`ATC-${Date.now()}`),D(!0),K({title:"Request Submitted",description:`Airtime to cash request submitted for ₦${u}`}),r(""),t(""),v(0)}catch(a){K({title:"Submission Failed",description:a?.message||"Unable to submit request",variant:"destructive"})}finally{x(!1)}};return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"p-2 bg-primary/10 rounded-lg",children:(0,b.jsx)(l.DollarSign,{className:"h-6 w-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Airtime 2 Cash"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Convert airtime to cash with role-based pricing"})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Sell Airtime"}),(0,b.jsx)(e.CardDescription,{children:"Enter phone, network and amount"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsxs)("form",{className:"space-y-4",onSubmit:R,children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Network"}),(0,b.jsxs)(i.Select,{value:q,onValueChange:a=>r(a),children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{placeholder:"Select network"})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"MTN",children:"MTN"}),(0,b.jsx)(i.SelectItem,{value:"GLO",children:"GLO"}),(0,b.jsx)(i.SelectItem,{value:"AIRTEL",children:"AIRTEL"}),(0,b.jsx)(i.SelectItem,{value:"9MOBILE",children:"9MOBILE"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Phone Number"}),(0,b.jsx)(g.Input,{value:s,onChange:a=>t(a.target.value.replace(/\D/g,"").slice(0,11)),placeholder:"08012345678"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Amount (₦)"}),(0,b.jsx)(g.Input,{type:"number",value:u,onChange:a=>v(Number(a.target.value)),placeholder:"100"})]}),q?(0,b.jsxs)("div",{className:"bg-[#CCCCFF]/20 p-3 rounded-lg text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Pricing"}),(0,b.jsx)("span",{children:A||M?"Loading...":Q})]}),(0,b.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,b.jsx)("span",{children:"You Receive"}),(0,b.jsxs)("span",{children:["₦",P.toLocaleString()]})]})]}):null,(0,b.jsx)(f.Button,{className:"w-full",type:"submit",disabled:w,children:w?"Submitting...":"Submit Request"})]}),C&&(0,b.jsx)(j.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)("div",{className:"flex justify-center mb-4",children:(0,b.jsx)("div",{className:"rounded-full bg-green-100 p-3",children:(0,b.jsx)(m.CheckCircle2,{className:"h-12 w-12 text-green-600"})})}),(0,b.jsx)(j.DialogTitle,{className:"text-center",children:"Request Received"}),(0,b.jsxs)(j.DialogDescription,{className:"text-center space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Reference"}),(0,b.jsx)("span",{className:"font-semibold",children:E})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Network"}),(0,b.jsx)("span",{className:"font-semibold",children:q})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Amount"}),(0,b.jsxs)("span",{className:"font-semibold",children:["₦",Number(u).toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"You Receive"}),(0,b.jsxs)("span",{className:"font-semibold",children:["₦",P.toLocaleString()]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"We will confirm and credit your wallet shortly."})]})]}),(0,b.jsx)(f.Button,{onClick:()=>D(!1),className:"w-full",children:"Make Another Request"})]})})]})]}),(0,b.jsxs)(e.Card,{className:"border-[#CCCCFF]/20",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"How It Works"}),(0,b.jsx)(e.CardDescription,{children:"Simple steps to convert airtime to cash"})]}),(0,b.jsxs)(e.CardContent,{className:"text-sm space-y-2",children:[(0,b.jsx)("p",{children:"• Enter your phone, select network and amount."}),(0,b.jsx)("p",{children:"• We apply role-based pricing using live DB or legacy rates."}),(0,b.jsx)("p",{children:"• We process your request and credit your wallet."})]})]})]}),(0,b.jsx)(n.PinPrompt,{isOpen:G,onClose:()=>H(!1),onConfirm:S,isLoading:w})]})}a.s(["default",()=>p])}];

//# sourceMappingURL=_dd85394e._.js.map