{"version":3,"sources":["turbopack:///[project]/app/admin/catalog/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\n\r\ntype CatalogItem = {\r\n  id: number\r\n  category: string\r\n  subservice: string\r\n  variant: string\r\n  description?: string | null\r\n  createdAt: string\r\n  updatedAt: string\r\n}\r\n\r\nexport default function AdminCatalogPage() {\r\n  const router = useRouter()\r\n  const [items, setItems] = useState<CatalogItem[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [filter, setFilter] = useState<string>(\"\")\r\n  const [dialogOpen, setDialogOpen] = useState(false)\r\n  const [editing, setEditing] = useState<CatalogItem | null>(null)\r\n  const [form, setForm] = useState({ category: \"\", subservice: \"\", variant: \"\", description: \"\" })\r\n\r\n  async function load() {\r\n    try {\r\n      setLoading(true)\r\n      const url = filter ? `/api/service-catalog?category=${encodeURIComponent(filter)}` : \"/api/service-catalog\"\r\n      const res = await fetch(url)\r\n      if (!res.ok) throw new Error(`Failed: ${res.status}`)\r\n      const data = await res.json()\r\n      setItems(data)\r\n      setError(null)\r\n    } catch (e: any) {\r\n      setError(e?.message || \"Failed to load catalog\")\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => { load() }, [filter])\r\n\r\n  const categories = useMemo(() => Array.from(new Set(items.map(i => i.category))).sort(), [items])\r\n\r\n  function openNew() {\r\n    setEditing(null)\r\n    setForm({ category: \"\", subservice: \"\", variant: \"\", description: \"\" })\r\n    setDialogOpen(true)\r\n  }\r\n  function openEdit(item: CatalogItem) {\r\n    setEditing(item)\r\n    setForm({\r\n      category: item.category,\r\n      subservice: item.subservice,\r\n      variant: item.variant || \"\",\r\n      description: item.description || \"\",\r\n    })\r\n    setDialogOpen(true)\r\n  }\r\n  function closeDialog() { setDialogOpen(false) }\r\n\r\n  async function save() {\r\n    const payload = {\r\n      category: form.category.trim(),\r\n      subservice: form.subservice.trim(),\r\n      variant: (form.variant || \"\").trim(),\r\n      description: form.description?.trim() || undefined,\r\n    }\r\n    const url = editing ? `/api/admin/catalog/${editing.id}` : \"/api/admin/catalog\"\r\n    const method = editing ? \"PUT\" : \"POST\"\r\n    const res = await fetch(url, { method, headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(payload) })\r\n    if (!res.ok) {\r\n      const data = await res.json().catch(() => ({}))\r\n      alert(data.error || `Request failed (${res.status})`)\r\n      return\r\n    }\r\n    closeDialog()\r\n    await load()\r\n    // Notify pricing page (if any) to refresh dropdowns\r\n    try {\r\n      window.dispatchEvent(new CustomEvent(\"ufriends_catalog_updated\"))\r\n      localStorage.setItem(\"ufriends_service_catalog\", JSON.stringify(items))\r\n    } catch {}\r\n  }\r\n\r\n  async function remove(item: CatalogItem) {\r\n    if (!confirm(`Delete ${item.category} / ${item.subservice} / ${item.variant || \"(no variant)\"}?`)) return\r\n    const res = await fetch(`/api/admin/catalog/${item.id}`, { method: \"DELETE\" })\r\n    if (!res.ok) {\r\n      const data = await res.json().catch(() => ({}))\r\n      alert(data.error || `Delete failed (${res.status})`)\r\n      return\r\n    }\r\n    await load()\r\n    try {\r\n      window.dispatchEvent(new CustomEvent(\"ufriends_catalog_updated\"))\r\n      localStorage.setItem(\"ufriends_service_catalog\", JSON.stringify(items))\r\n    } catch {}\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h1 className=\"text-xl font-semibold\">Service Catalog</h1>\r\n        <div className=\"flex items-center gap-2\">\r\n          <select className=\"border rounded px-2 py-1\" value={filter} onChange={(e) => setFilter(e.target.value)}>\r\n            <option value=\"\">All Categories</option>\r\n            {categories.map(c => <option key={c} value={c}>{c}</option>)}\r\n          </select>\r\n          <button className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded\" onClick={openNew}>Add</button>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"space-y-2\">\r\n          {[...Array(6)].map((_, i) => (\r\n            <div key={i} className=\"h-10 bg-gray-100 animate-pulse rounded\" />\r\n          ))}\r\n        </div>\r\n      ) : error ? (\r\n        <div className=\"text-red-600\">{error}</div>\r\n      ) : (\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full border\">\r\n            <thead>\r\n              <tr className=\"bg-gray-50\">\r\n                <th className=\"text-left p-2 border\">Category</th>\r\n                <th className=\"text-left p-2 border\">Subservice</th>\r\n                <th className=\"text-left p-2 border\">Variant</th>\r\n                <th className=\"text-left p-2 border\">Description</th>\r\n                <th className=\"text-left p-2 border\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {items.map(item => (\r\n                <tr key={item.id} className=\"hover:bg-gray-50\">\r\n                  <td className=\"p-2 border\">{item.category}</td>\r\n                  <td className=\"p-2 border\">{item.subservice}</td>\r\n                  <td className=\"p-2 border\">{item.variant || \"\"}</td>\r\n                  <td className=\"p-2 border\">{item.description || \"\"}</td>\r\n                  <td className=\"p-2 border\">\r\n                    <button className=\"text-blue-700 mr-3\" onClick={() => openEdit(item)}>Edit</button>\r\n                    <button className=\"text-red-700\" onClick={() => remove(item)}>Delete</button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      {dialogOpen && (\r\n        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center\">\r\n          <div className=\"bg-white rounded shadow-lg p-4 w-[480px]\">\r\n            <h2 className=\"text-lg font-semibold mb-3\">{editing ? \"Edit Entry\" : \"New Entry\"}</h2>\r\n            <div className=\"space-y-3\">\r\n              <div>\r\n                <label className=\"block text-sm mb-1\">Category</label>\r\n                <input className=\"w-full border rounded px-2 py-1\" value={form.category} onChange={e => setForm({ ...form, category: e.target.value })} />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm mb-1\">Subservice</label>\r\n                <input className=\"w-full border rounded px-2 py-1\" value={form.subservice} onChange={e => setForm({ ...form, subservice: e.target.value })} />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm mb-1\">Variant (optional)</label>\r\n                <input className=\"w-full border rounded px-2 py-1\" value={form.variant} onChange={e => setForm({ ...form, variant: e.target.value })} />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm mb-1\">Description (optional)</label>\r\n                <textarea className=\"w-full border rounded px-2 py-1\" rows={3} value={form.description} onChange={e => setForm({ ...form, description: e.target.value })} />\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4 flex items-center justify-end gap-2\">\r\n              <button className=\"px-3 py-1 rounded border\" onClick={closeDialog}>Cancel</button>\r\n              <button className=\"px-3 py-1 rounded bg-blue-600 text-white\" onClick={save}>Save</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}