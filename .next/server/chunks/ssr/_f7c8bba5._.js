module.exports=[370975,a=>{"use strict";var b=a.i(572131),c=a.i(677050);function d(a){try{let b=String(a?.role||"").toLowerCase(),c=Array.isArray(a?.roles)?a.roles.map(a=>String(a).toLowerCase()):[];return b.includes("marketer")||c.includes("marketer")||a?.isMarketer===!0?"marketer":"user"}catch{return"user"}}async function e(){try{let a=await fetch("/api/me");if(!a.ok)return"user";let b=await a.json().catch(()=>null);return d(b?.user||b)}catch{return"user"}}function f(a,f,g,h,i){let[j,k]=(0,b.useState)(()=>d(i)),[l,m]=(0,b.useState)(null),[n,o]=(0,b.useState)(!1),[p,q]=(0,b.useState)(null),[r,s]=(0,b.useState)(void 0),t=(0,b.useMemo)(()=>({category:String(a||"").trim(),subservice:String(f||"").trim(),variant:String(g||"").trim()}),[a,f,g]),u=(0,b.useMemo)(()=>{if(!h||"object"!=typeof h)return"";let a=Object.entries(h).filter(([a,b])=>null!=b);return a.length?(a.sort(([a],[b])=>a.localeCompare(b)),a.map(([a,b])=>`${a}=${String(b)}`).join("|")):""},[h]);return(0,b.useEffect)(()=>{let a=!1;return(async()=>{o(!0),q(null);try{let b=i?d(i):await e();a||k(b);let c=[["category",t.category],["subservice",t.subservice],["variant",t.variant],["role",b]];if(h&&"object"==typeof h){let a=Object.entries(h).filter(([a,b])=>null!=b);for(let[b,d]of(a.sort(([a],[b])=>a.localeCompare(b)),a))c.push([b,String(d)])}let f=new URLSearchParams(c),g=await fetch(`/api/pricing?${f.toString()}`,{cache:"no-store"}),j=await g.json().catch(()=>null);if(!g.ok)throw Error(String(j?.error||"Failed to load pricing"));let l=j?.price;m("number"==typeof l?l:null)}catch(a){q(a?.message||"Failed to fetch pricing"),m(null)}finally{a||o(!1)}})(),()=>{a=!0}},[t.category,t.subservice,t.variant,u,i]),{price:l,isLoading:n,error:p,reference:r,submitService:(0,b.useCallback)(async a=>{try{let b={amount:Number(a.amount),idempotencyKey:"string"==typeof a.idempotencyKey?a.idempotencyKey:void 0,params:{...a||{}},subServiceId:t.variant||void 0,action:function(a,b){let c=a.trim().toLowerCase(),d=b.trim().toLowerCase();if("nin"===c){if("slip"===d)return"nin.slip";if("printout"===d)return"nin.printout";if("advanced"===d||"verification"===d)return"nin.advanced"}if("bvn"===c){if("printout"===d)return"bvn.printout";if("retrieval"===d||"retrieval_phone"===d)return"bvn.retrieval_phone";if("advanced"===d||"verification"===d)return"bvn.advanced"}if("cac"===c){if("info"===d)return"cac.info";if("status"===d)return"cac.status"}return"passport"===c&&("verify"===d||"verification"===d||"basic"===d)?"passport.verify":"phone"===c&&("advanced"===d||"verification"===d||"basic"===d)?"phone.verify_advanced":("driver-license"===c||"drivers_license"===c)&&("basic"===d||"verification"===d)?"drivers_license.verify":("voters-card"===c||"voters"===c)&&("basic"===d||"full"===d||"verification"===d)?"voters.verify":("plate-number"===c||"plate"===c)&&("basic"===d||"verification"===d)?"plate.verify":"tin"===c&&("basic"===d||"certificate"===d||"verification"===d)?"tin.verify":null}(t.category,t.subservice)||void 0,pin:a.pin},d=await (0,c.authFetch)(`/api/service/${encodeURIComponent(t.category)}/${encodeURIComponent(t.subservice)}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(b)}),e=await d.json().catch(()=>null);if(!d.ok)return{ok:!1,error:String(e?.error||`Service failed (${d.status})`),message:String(e?.message||"Failed"),data:e};return s(String(e?.reference||"")),{ok:!0,reference:String(e?.reference||""),message:String(e?.message||""),data:e}}catch(a){return{ok:!1,error:String(a?.message||a)}}},[t.category,t.subservice,t.variant])}}a.s(["default",0,f,"useDynamicPricing",()=>f])},464286,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(965733),e=a.i(340695),f=a.i(205522),g=a.i(917171),h=a.i(823292);function i({isOpen:a,onClose:i,onConfirm:j,isLoading:k}){let[l,m]=(0,c.useState)(""),n=()=>{4!==l.length?h.toast.error("Please enter a 4-digit PIN"):(j(l),m(""))};return(0,b.jsx)(d.Dialog,{open:a,onOpenChange:a=>!a&&i(),children:(0,b.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(d.DialogHeader,{children:[(0,b.jsx)(d.DialogTitle,{children:"Enter Transaction PIN"}),(0,b.jsx)(d.DialogDescription,{children:"Please enter your 4-digit transaction PIN to authorize this request."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"pin",className:"text-center block",children:"PIN"}),(0,b.jsx)(f.Input,{id:"pin",type:"password",inputMode:"numeric",maxLength:4,value:l,onChange:a=>m(a.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-[1em]",placeholder:"••••",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&n()}})]})}),(0,b.jsxs)(d.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:i,disabled:k,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:n,disabled:k||4!==l.length,className:"bg-[#3457D5]",children:k?"Verifying...":"Confirm PIN"})]})]})})}a.s(["PinPrompt",()=>i])},167453,a=>{"use strict";let b=(0,a.i(170106).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);a.s(["CheckCircle2",()=>b],167453)},501027,a=>{"use strict";let b=(0,a.i(170106).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);a.s(["Zap",()=>b],501027)},32968,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(346271),e=a.i(703130),f=a.i(340695),g=a.i(205522),h=a.i(917171),i=a.i(887682),j=a.i(501027),k=a.i(167453),l=a.i(277687),m=a.i(370975),n=a.i(464286);function o(){let[a,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(null),{toast:D}=(0,l.useToast)(),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),{price:I,isLoading:J,error:K,submitService:L}=(0,m.default)("bills","electricity",a?({IKEJA:"ikeja",EKO:"eko",IBADAN:"ibadan",ABUJA:"abuja",KANO:"kano","PORT-HARCOURT":"port.harcourt",ENUGU:"enugu",JOS:"jos"})[a]||a.toLowerCase():""),M=async b=>{if(b.preventDefault(),!a||!p||!r||0>=Number(r))return void D({title:"Missing details",description:"Fill provider, meter and amount",variant:"destructive"});w(!0);try{C({amount:Number(r),meterNumber:p,serviceProvider:a,customerName:t}),A(!0)}finally{w(!1)}},N=async a=>{A(!1),w(!0),y(null);try{if(!B)throw Error("No pending payment details found.");let b=await L({...B,pin:a});if(!b.ok)throw Error(b.error||"Electricity bill payment failed");y({reference:String(b.reference||b.data?.reference||""),token:b.data?.token,units:b.data?.units}),D({title:"Electricity paid",description:`Ref: ${String(b.reference||b.data?.reference||"")}`}),o(""),q(""),s(""),u(""),C(null)}catch(a){!function(a,b="Service Error"){let c=a?.message||String(a),d=a?.code||(c.includes("ERR2")?c.match(/ERR2\d{2}/)?.[0]:null);if(d){let a=function(a){switch(a){case"INVALID_USERNAME":case"ERR200":return{title:"Authentication Error",description:"Provider username is missing or invalid. Please contact support."};case"INVALID_CREDENTIALS":case"ERR201":return{title:"Authentication Error",description:"Invalid provider credentials. Please contact support."};case"INSUFFICIENT_BALANCE":case"ERR203":return{title:"Insufficient Balance",description:"Your account balance is insufficient to complete this transaction."};case"TRANSACTION_FAILED":case"ERR206":return{title:"Transaction Failed",description:"Your transaction could not be processed. Please try again later."};case"INVALID_PHONE":case"ERR202":return{title:"Invalid Phone Number",description:"The phone number provided is invalid. Please check and try again."};case"INVALID_NETWORK":case"ERR204":return{title:"Invalid Network",description:"The selected network provider is not supported or invalid."};case"INVALID_PLAN":case"ERR207":return{title:"Invalid Plan",description:"The selected data plan is invalid or unavailable."};case"INVALID_METER":case"ERR208":return{title:"Invalid Meter Number",description:"The meter number provided is invalid. Please check and try again."};case"INVALID_DISCO":case"ERR209":return{title:"Invalid Provider",description:"The selected electricity provider is invalid or not supported."};case"INVALID_AMOUNT":case"ERR210":return{title:"Invalid Amount",description:"The amount specified is invalid for this transaction."};case"INVALID_EDU_TYPE":return{title:"Invalid Education Type",description:"The selected education service type is invalid or not supported."};case"MISSING_CONFIG":return{title:"Configuration Error",description:"Provider configuration is missing. Please contact support."};case"BAD_INPUT":return{title:"Invalid Input",description:"Some required information is missing or invalid. Please check your inputs."};case"NETWORK_ERROR":return{title:"Network Error",description:"Unable to connect to the service provider. Please check your internet connection and try again."};case"NO_REFERENCE":return{title:"Transaction Reference Error",description:"Transaction completed but no reference was generated. Please contact support."};default:return{title:"Service Error",description:"An error occurred with the service provider. Please try again later or contact support."}}}(d);(0,l.toast)({title:a.title,description:a.description,variant:"destructive"})}else(0,l.toast)({title:b,description:c,variant:"destructive"})}(a,"Electricity Payment Failed")}finally{w(!1)}};return(0,c.useEffect)(()=>{(H(J),a)?F("number"==typeof I?I:null):F(null)},[a,I,J]),(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"p-2 bg-[#3457D5]/10 rounded-lg",children:(0,b.jsx)(j.Zap,{className:"h-6 w-6 text-[#3457D5]"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Electricity Bill"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Pay for electricity across all DISCOs"})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,b.jsxs)(e.Card,{className:"border-[#3457D5]/20 shadow-lg",children:[(0,b.jsxs)(e.CardHeader,{className:"bg-gradient-to-r from-[#3457D5]/5 to-[#CCCCFF]/10",children:[(0,b.jsx)(e.CardTitle,{className:"text-[#3457D5]",children:"Pay Electricity"}),(0,b.jsx)(e.CardDescription,{children:"Enter meter details and amount"})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"DISCO Provider"}),(0,b.jsxs)(i.Select,{value:a,onValueChange:o,children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{placeholder:"Select provider"})}),(0,b.jsx)(i.SelectContent,{children:[{value:"IKEJA",label:"Ikeja Electric"},{value:"EKO",label:"Eko Electric"},{value:"IBADAN",label:"Ibadan Electric"},{value:"ABUJA",label:"Abuja Electric"},{value:"KANO",label:"Kano Electric"},{value:"PORT-HARCOURT",label:"Port Harcourt Electric"},{value:"ENUGU",label:"Enugu Electric"},{value:"JOS",label:"Jos Electric"}].map(a=>(0,b.jsx)(i.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Meter Number"}),(0,b.jsx)(g.Input,{value:p,onChange:a=>q(a.target.value),placeholder:"1234567890"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Amount (₦)"}),(0,b.jsx)(g.Input,{type:"number",value:r,onChange:a=>s(Number(a.target.value)),placeholder:"500"})]}),a?(0,b.jsxs)("div",{className:"bg-[#CCCCFF]/20 p-3 rounded-lg text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Service Fee"}),(0,b.jsx)("span",{children:G?"Loading...":`₦${(E??0).toLocaleString()}`})]}),(0,b.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,b.jsx)("span",{children:"Total Payable"}),(0,b.jsxs)("span",{children:["₦",((Number(r)||0)+(E||0)).toLocaleString()]})]})]}):null,(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Customer Name (optional)"}),(0,b.jsx)(g.Input,{value:t,onChange:a=>u(a.target.value),placeholder:"John Doe"})]}),(0,b.jsx)(f.Button,{className:"w-full",type:"submit",disabled:v||J,children:v||J?"Processing...":"Pay Electricity"})]}),x&&(0,b.jsxs)("div",{className:"mt-6 p-3 rounded-lg bg-green-50 border border-green-200 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 font-medium text-green-700",children:[(0,b.jsx)(k.CheckCircle2,{className:"h-5 w-5"})," Payment successful"]}),(0,b.jsxs)("div",{className:"mt-1 text-green-700",children:["Reference: ",x.reference]}),x.token?(0,b.jsxs)("div",{className:"text-green-700",children:["Token: ",x.token]}):null,x.units?(0,b.jsxs)("div",{className:"text-green-700",children:["Units: ",x.units]}):null]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Tips"}),(0,b.jsx)(e.CardDescription,{children:"Prepaid meters return tokens on success"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-2",children:[(0,b.jsx)("li",{children:"Confirm DISCO provider matches your meter."}),(0,b.jsx)("li",{children:"Double-check meter number before paying."}),(0,b.jsx)("li",{children:"Your wallet will be debited after success."})]})})]})]}),(0,b.jsx)(n.PinPrompt,{isOpen:z,onClose:()=>A(!1),onConfirm:N,isLoading:v})]})}a.s(["default",()=>o],32968)}];

//# sourceMappingURL=_f7c8bba5._.js.map